import{r as l,s as b,j as e,v as _,x as A}from"./index-BwkpV__w.js";import{F as H}from"./FinanceLayout-CjQnoYoi.js";import{R as y}from"./refresh-cw-BOylv9iS.js";import{A as p}from"./alert-triangle-7C2TF2Jt.js";import{A as k}from"./alert-circle-CPMvE-2H.js";import{c as X}from"./createLucideIcon-Br99KG2k.js";import{C as G}from"./check-circle-dmQidnzw.js";import{E as J}from"./eye-tZOdn9BK.js";import{C as K}from"./chevron-left-B_vkcqje.js";import{C as Q}from"./chevron-right-CdUgtJnl.js";import{X as U}from"./x-SOWQ9pA1.js";import{S as V}from"./shield-Cs7TMsYu.js";import"./menu-SfYPTgzA.js";import"./calculator-nKkh06Wm.js";import"./layout-dashboard-D5Mf8n7V.js";import"./wallet-zRcUviwm.js";import"./credit-card-BxGZxUT_.js";import"./file-text-Du91DJD5.js";import"./bar-chart-3-NLzj-RlB.js";import"./building-2-Dlcl3Cjy.js";import"./users-C-5fSS9v.js";import"./settings-CR5Ev8rB.js";import"./log-out-bEHVpLxn.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=X("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);function je(){const[d,D]=l.useState([]),[R,j]=l.useState(!0),[m,q]=l.useState("all"),[x,F]=l.useState("all"),[u,M]=l.useState("all"),[r,i]=l.useState(null),[a,n]=l.useState(1),[g,T]=l.useState(0),o=15;l.useEffect(()=>{c()},[a,m,x,u]);const c=async()=>{j(!0);try{let s=b.from("finance_alerts").select("*",{count:"exact"});m!=="all"&&(s=s.eq("status",m)),x!=="all"&&(s=s.eq("severity",x)),u!=="all"&&(s=s.eq("alert_type",u));const{data:t,error:S,count:B}=await s.order("created_at",{ascending:!1}).range((a-1)*o,a*o-1);if(S)throw S;D(t||[]),T(B||0)}catch(s){console.error("Error fetching alerts:",s)}finally{j(!1)}},f=async s=>{try{const{error:t}=await b.from("finance_alerts").update({status:"resolved",resolved_at:new Date().toISOString()}).eq("id",s);if(t)throw t;c(),i(null)}catch(t){console.error("Error resolving alert:",t)}},L=async s=>{try{const{error:t}=await b.from("finance_alerts").update({status:"dismissed",resolved_at:new Date().toISOString()}).eq("id",s);if(t)throw t;c(),i(null)}catch(t){console.error("Error dismissing alert:",t)}},N=s=>{switch(s){case"critical":return e.jsx(k,{className:"w-5 h-5 text-red-500"});case"high":return e.jsx(p,{className:"w-5 h-5 text-orange-500"});case"medium":return e.jsx(v,{className:"w-5 h-5 text-yellow-500"});case"low":return e.jsx(V,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(v,{className:"w-5 h-5 text-gray-500"})}},w=s=>{switch(s){case"critical":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},C=s=>{switch(s){case"open":return"bg-red-100 text-red-800";case"acknowledged":return"bg-yellow-100 text-yellow-800";case"resolved":return"bg-green-100 text-green-800";case"dismissed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},E=[{value:"all",label:"Tous les types"},{value:"discrepancy",label:"Écart"},{value:"threshold",label:"Seuil Dépassé"},{value:"overdue",label:"Retard"},{value:"missing",label:"Données Manquantes"},{value:"duplicate",label:"Doublon"},{value:"anomaly",label:"Anomalie"}],$=[{value:"all",label:"Toutes les sévérités"},{value:"critical",label:"Critique"},{value:"high",label:"Haute"},{value:"medium",label:"Moyenne"},{value:"low",label:"Basse"}],I=[{value:"all",label:"Tous les statuts"},{value:"open",label:"Ouvert"},{value:"acknowledged",label:"Reconnu"},{value:"resolved",label:"Résolu"},{value:"dismissed",label:"Ignoré"}],h=Math.ceil(g/o),O=d.filter(s=>s.status==="open").length,P=d.filter(s=>s.severity==="critical"&&s.status==="open").length,z=d.filter(s=>s.severity==="high"&&s.status==="open").length;return e.jsxs(H,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Alertes"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Surveillance et détection d'anomalies"})]}),e.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsx(y,{className:"w-4 h-4"}),"Actualiser"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(p,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Alertes Ouvertes"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:O})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Critiques"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:P})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(p,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Haute Priorité"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:z})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsx("select",{value:u,onChange:s=>{M(s.target.value),n(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:E.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx("div",{children:e.jsx("select",{value:x,onChange:s=>{F(s.target.value),n(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:$.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx("div",{children:e.jsx("select",{value:m,onChange:s=>{q(s.target.value),n(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:I.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx("div",{children:e.jsxs("button",{onClick:c,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsx(y,{className:"w-4 h-4"}),"Actualiser"]})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[R?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(y,{className:"w-8 h-8 text-emerald-500 animate-spin"})}):d.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 text-green-500"}),e.jsx("p",{className:"text-gray-500",children:"Aucune alerte trouvée"})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:d.map(s=>e.jsx("div",{className:`p-4 hover:bg-gray-50 cursor-pointer border-l-4 ${s.severity==="critical"?"border-l-red-500":s.severity==="high"?"border-l-orange-500":s.severity==="medium"?"border-l-yellow-500":"border-l-blue-500"}`,onClick:()=>i(s),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.severity==="critical"?"bg-red-100":s.severity==="high"?"bg-orange-100":s.severity==="medium"?"bg-yellow-100":"bg-blue-100"}`,children:N(s.severity)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${w(s.severity)}`,children:_[s.severity]||s.severity}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${C(s.status)}`,children:A[s.status]||s.status})]}),e.jsx("h3",{className:"font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:s.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),i(s)},className:"p-2 text-gray-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",children:e.jsx(J,{className:"w-5 h-5"})})]})},s.id))}),h>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Affichage ",(a-1)*o+1," - ",Math.min(a*o,g)," sur ",g]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(Math.max(1,a-1)),disabled:a===1,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",a," / ",h]}),e.jsx("button",{onClick:()=>n(Math.min(h,a+1)),disabled:a===h,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Q,{className:"w-5 h-5"})})]})]})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full overflow-hidden",children:[e.jsx("div",{className:`p-6 border-b ${r.severity==="critical"?"bg-red-50 border-red-100":r.severity==="high"?"bg-orange-50 border-orange-100":r.severity==="medium"?"bg-yellow-50 border-yellow-100":"bg-blue-50 border-blue-100"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[N(r.severity),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${w(r.severity)}`,children:_[r.severity]||r.severity}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${C(r.status)}`,children:A[r.status]||r.status})]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mt-1",children:r.title})]})]}),e.jsx("button",{onClick:()=>i(null),className:"p-2 hover:bg-white/50 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-gray-500"})})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-4 rounded-lg",children:r.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Type"}),e.jsx("p",{className:"text-gray-900 capitalize",children:r.alert_type==="discrepancy"?"Écart":r.alert_type==="threshold"?"Seuil Dépassé":r.alert_type==="overdue"?"Retard":r.alert_type==="missing"?"Données Manquantes":r.alert_type==="duplicate"?"Doublon":r.alert_type==="anomaly"?"Anomalie":r.alert_type})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Créé le"}),e.jsx("p",{className:"text-gray-900",children:new Date(r.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),r.resolved_at&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Résolu le"}),e.jsx("p",{className:"text-green-600",children:new Date(r.resolved_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),r.resolution_notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Notes de Résolution"}),e.jsx("p",{className:"text-gray-900 bg-green-50 p-4 rounded-lg",children:r.resolution_notes})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 flex justify-end gap-3",children:[r.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>L(r.id),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Ignorer"}),e.jsx("button",{onClick:()=>f(r.id),className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600",children:"Marquer Résolu"})]}),r.status==="acknowledged"&&e.jsx("button",{onClick:()=>f(r.id),className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600",children:"Marquer Résolu"}),e.jsx("button",{onClick:()=>i(null),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Fermer"})]})]})})]})}export{je as default};
