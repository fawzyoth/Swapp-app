import{s as g,j as e,S as z}from"./index-hp3Tfpax.js";import{h as G,u as J,r as n,L as w}from"./react-vendor-CTUriZ5h.js";import{M as u}from"./MerchantLayout-C6R0JEpM.js";import{A as y}from"./alert-circle-_Iqic_ih.js";import{A as K}from"./arrow-left-CxjwE-xR.js";import{A as O}from"./award-zis7GU39.js";import{P as Q}from"./phone-BNQXnIac.js";import{M as W}from"./mail-8XdLpMtJ.js";import{C as Y}from"./calendar-upMk3ayk.js";import{M as p}from"./message-square-B53yKzw3.js";import{P as k}from"./package-ChDCFdB3.js";import{T as Z}from"./trending-up-9gPHMyOx.js";import{C as E}from"./check-circle-CyNeZd0p.js";import{C as S}from"./clock-Dhxn45-3.js";import{B as C}from"./bar-chart-3-DdlwYHtY.js";import{S as ee}from"./star-Cw7sdsKF.js";import{E as se}from"./eye-B0fj8J_e.js";import{U as _}from"./user-DEx4Ce9L.js";import{X as te}from"./x-circle-D3f66Y07.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./store-B-5iV_wL.js";import"./layout-dashboard-CqNl1jWq.js";import"./truck-CgEV9F53.js";import"./users-4zMWxYqH.js";import"./banknote-JI0QWWz-.js";import"./video-Cwp6uQ4V.js";import"./log-out-BX30H4-p.js";function $e(){const{phone:c}=G(),o=J(),[s,D]=n.useState(null),[b,M]=n.useState([]),[m,A]=n.useState([]),[L,$]=n.useState(!0),[r,x]=n.useState("overview");n.useEffect(()=>{R(),c&&F(decodeURIComponent(c))},[c]);const R=async()=>{const{data:{session:t}}=await g.auth.getSession();t||o("/merchant/login")},F=async t=>{try{const{data:a}=await g.from("exchanges").select("id, exchange_code, client_name, client_phone, reason, status, created_at").eq("client_phone",t).order("created_at",{ascending:!1});if(a&&a.length>0){M(a);const d=a.filter(l=>l.status==="validated"||l.status==="completed").length,I=a.filter(l=>l.status==="pending").length,U=a.filter(l=>l.status==="rejected").length,h=a.length,q=h>0?Math.round(d/h*100):0,i=a[a.length-1],N=a[0],P=Math.floor((Date.now()-new Date(i.created_at).getTime())/(1e3*60*60*24)),v=Math.floor((Date.now()-new Date(N.created_at).getTime())/(1e3*60*60*24)),j=new Map;a.forEach(l=>{j.set(l.reason,(j.get(l.reason)||0)+1)});const V=Array.from(j.entries()).sort((l,X)=>X[1]-l[1]).slice(0,3);D({name:i.client_name,phone:t,email:`${i.client_name.toLowerCase().replace(/\s/g,"")}@example.com`,firstExchange:i.created_at,lastExchange:N.created_at,daysSinceFirst:P,daysSinceLast:v,totalExchanges:h,validated:d,pending:I,rejected:U,acceptanceRate:q,isActive:v<=30,topReasons:V});const B=a.map(l=>l.id),{data:H}=await g.from("messages").select("*").in("exchange_id",B).order("created_at",{ascending:!1});A(H||[])}}catch(a){console.error("Error fetching client:",a)}finally{$(!1)}},T=t=>{switch(t){case"pending":return e.jsx(S,{className:"w-4 h-4 text-amber-600"});case"validated":case"completed":return e.jsx(E,{className:"w-4 h-4 text-emerald-600"});case"rejected":return e.jsx(te,{className:"w-4 h-4 text-red-600"});default:return e.jsx(y,{className:"w-4 h-4 text-slate-600"})}},f=t=>{switch(t){case"pending":return"bg-amber-100 text-amber-800 border-amber-200";case"validated":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-slate-100 text-slate-800 border-slate-200"}};return L?e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):s?e.jsx(u,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>o("/merchant/clients"),className:"flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors mb-6",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Retour aux clients"})]}),e.jsx("div",{className:"bg-gradient-to-r from-sky-50 to-blue-50 rounded-2xl border border-sky-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-sky-400 to-blue-500 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-lg",children:e.jsx("span",{className:"text-3xl font-bold text-white",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:s.name}),s.isActive&&e.jsx("span",{className:"px-3 py-1 bg-emerald-100 text-emerald-700 text-sm font-medium rounded-full border border-emerald-200",children:"Client actif"}),s.totalExchanges>5&&e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-amber-100 text-amber-700 text-sm font-medium rounded-full border border-amber-200",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Client fidèle"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(Q,{className:"w-4 h-4 text-sky-600"}),e.jsx("a",{href:`tel:${s.phone}`,className:"hover:text-sky-600",children:s.phone})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(W,{className:"w-4 h-4 text-sky-600"}),e.jsx("a",{href:`mailto:${s.email}`,className:"hover:text-sky-600",children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(Y,{className:"w-4 h-4 text-sky-600"}),e.jsxs("span",{children:["Client depuis"," ",new Date(s.firstExchange).toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]})]})]}),e.jsxs(w,{to:"/merchant/chat",className:"px-5 py-2.5 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors font-medium flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),"Envoyer un message"]})]})}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-sky-100 rounded-lg",children:e.jsx(k,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:s.totalExchanges}),e.jsx("div",{className:"text-xs text-slate-600",children:"Échanges totaux"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(Z,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:[s.acceptanceRate,"%"]}),e.jsx("div",{className:"text-xs text-slate-600",children:"Taux acceptation"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(E,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:s.validated}),e.jsx("div",{className:"text-xs text-slate-600",children:"Validés"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(S,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:s.pending}),e.jsx("div",{className:"text-xs text-slate-600",children:"En attente"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 mb-6",children:[e.jsx("div",{className:"border-b border-slate-200",children:e.jsxs("div",{className:"flex gap-1 p-2",children:[e.jsx("button",{onClick:()=>x("overview"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="overview"?"bg-sky-100 text-sky-700":"text-slate-600 hover:bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:"Vue d'ensemble"})]})}),e.jsx("button",{onClick:()=>x("exchanges"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="exchanges"?"bg-sky-100 text-sky-700":"text-slate-600 hover:bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsxs("span",{children:["Historique (",b.length,")"]})]})}),e.jsx("button",{onClick:()=>x("messages"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="messages"?"bg-sky-100 text-sky-700":"text-slate-600 hover:bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsxs("span",{children:["Messages (",m.length,")"]})]})})]})}),e.jsxs("div",{className:"p-6",children:[r==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Statistiques comportementales"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:"Répartition des statuts"}),e.jsx(C,{className:"w-5 h-5 text-slate-400"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-600",children:"Validés"}),e.jsxs("span",{className:"font-semibold text-emerald-600",children:[s.validated," (",Math.round(s.validated/s.totalExchanges*100),"%)"]})]}),e.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${s.validated/s.totalExchanges*100}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-600",children:"En attente"}),e.jsxs("span",{className:"font-semibold text-amber-600",children:[s.pending," (",Math.round(s.pending/s.totalExchanges*100),"%)"]})]}),e.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:`${s.pending/s.totalExchanges*100}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-600",children:"Refusés"}),e.jsxs("span",{className:"font-semibold text-red-600",children:[s.rejected," (",Math.round(s.rejected/s.totalExchanges*100),"%)"]})]}),e.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500 rounded-full",style:{width:`${s.rejected/s.totalExchanges*100}%`}})})]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:"Motifs d'échange principaux"}),e.jsx(ee,{className:"w-5 h-5 text-slate-400"})]}),e.jsx("div",{className:"space-y-3",children:s.topReasons.map(([t,a],d)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-700 truncate",children:t}),e.jsxs("span",{className:"font-semibold text-slate-900",children:[a,"x"]})]}),e.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-sky-500 rounded-full",style:{width:`${a/s.totalExchanges*100}%`}})})]},d))})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Informations temporelles"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-5 border border-slate-200",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Premier échange"}),e.jsx("div",{className:"font-semibold text-slate-900",children:new Date(s.firstExchange).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Il y a ",s.daysSinceFirst," jours"]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-5 border border-slate-200",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Dernier échange"}),e.jsx("div",{className:"font-semibold text-slate-900",children:new Date(s.lastExchange).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:s.daysSinceLast===0?"Aujourd'hui":s.daysSinceLast===1?"Hier":`Il y a ${s.daysSinceLast} jours`})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-5 border border-slate-200",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Fréquence moyenne"}),e.jsx("div",{className:"font-semibold text-slate-900",children:s.totalExchanges>1?`${Math.round(s.daysSinceFirst/(s.totalExchanges-1))} jours`:"N/A"}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Entre les échanges"})]})]})]})]}),r==="exchanges"&&e.jsx("div",{className:"space-y-3",children:b.map(t=>e.jsx(w,{to:`/merchant/exchange/${t.id}`,className:"block bg-slate-50 rounded-xl p-4 hover:bg-slate-100 transition-colors border border-slate-200 group",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:`p-2 rounded-lg border ${f(t.status)}`,children:T(t.status)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:t.exchange_code}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${f(t.status)}`,children:z[t.status]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:[e.jsx("span",{className:"truncate",children:t.reason}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString("fr-FR")})]})]})]}),e.jsx(se,{className:"w-5 h-5 text-slate-400 group-hover:text-sky-600 transition-colors flex-shrink-0"})]})},t.id))}),r==="messages"&&e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Aucun message"}),e.jsx("p",{className:"text-slate-600",children:"Aucune conversation avec ce client pour le moment"})]}):m.map(t=>e.jsx("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.sender_type==="merchant"?"bg-sky-100":"bg-emerald-100"}`,children:t.sender_type==="merchant"?e.jsx(_,{className:"w-4 h-4 text-sky-600"}):e.jsx(_,{className:"w-4 h-4 text-emerald-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-slate-900",children:t.sender_type==="merchant"?"Vous":s.name}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-slate-700",children:t.message})]})]})},t.id))})]})]})]})}):e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Client non trouvé"}),e.jsx("button",{onClick:()=>o("/merchant/clients"),className:"mt-4 px-6 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700",children:"Retour aux clients"})]})})})}export{$e as default};
