import{s as j,j as e}from"./index-CYPRHEJa.js";import{u as D,r as d,L as P}from"./react-vendor-CTUriZ5h.js";import{M as f}from"./MerchantLayout-CJmgIMDC.js";import{U as v}from"./users-4zMWxYqH.js";import{T as U}from"./trending-up-9gPHMyOx.js";import{A as b}from"./award-zis7GU39.js";import{P as N}from"./package-ChDCFdB3.js";import{S as $}from"./search-CPbK6Y1N.js";import{F}from"./filter-Cp7rfch8.js";import{P as I}from"./phone-BNQXnIac.js";import{M as B}from"./mail-8XdLpMtJ.js";import{C as q}from"./clock-Dhxn45-3.js";import{C as z}from"./chevron-right-DAoz1ith.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./store-B-5iV_wL.js";import"./layout-dashboard-CqNl1jWq.js";import"./message-square-B53yKzw3.js";import"./log-out-BX30H4-p.js";function oe(){const w=D(),[l,y]=d.useState([]),[E,k]=d.useState(!0),[o,C]=d.useState(""),[p,S]=d.useState("exchanges"),[x,A]=d.useState("all");d.useEffect(()=>{L(),R()},[]);const L=async()=>{const{data:{session:s}}=await j.auth.getSession();s||w("/merchant/login")},R=async()=>{try{const{data:s}=await j.from("exchanges").select("*").order("created_at",{ascending:!1});if(s){const a=new Map;s.forEach(t=>{const n=t.client_phone;a.has(n)||a.set(n,{name:t.client_name,phone:t.client_phone,email:`${t.client_name.toLowerCase().replace(/\s/g,"")}@example.com`,exchanges:[],firstExchange:t.created_at,lastExchange:t.created_at});const c=a.get(n);c.exchanges.push(t),new Date(t.created_at)<new Date(c.firstExchange)&&(c.firstExchange=t.created_at),new Date(t.created_at)>new Date(c.lastExchange)&&(c.lastExchange=t.created_at)});const m=Array.from(a.values()).map(t=>{const n=t.exchanges.filter(i=>i.status==="validated"||i.status==="completed").length,c=t.exchanges.filter(i=>i.status==="pending").length,M=t.exchanges.filter(i=>i.status==="rejected").length,h=t.exchanges.length,_=h>0?Math.round(n/h*100):0,u=Math.floor((Date.now()-new Date(t.lastExchange).getTime())/(1e3*60*60*24)),T=u<=30;return{...t,totalExchanges:h,acceptanceRate:_,validated:n,pending:c,rejected:M,daysSinceLastExchange:u,isActive:T}});y(m)}}catch(s){console.error("Error fetching clients:",s)}finally{k(!1)}},g=l.filter(s=>{const a=s.name.toLowerCase().includes(o.toLowerCase())||s.phone.includes(o)||s.email.toLowerCase().includes(o.toLowerCase()),m=x==="all"?!0:x==="active"?s.isActive:!s.isActive;return a&&m}).sort((s,a)=>{switch(p){case"exchanges":return a.totalExchanges-s.totalExchanges;case"rate":return a.acceptanceRate-s.acceptanceRate;case"recent":return new Date(a.lastExchange).getTime()-new Date(s.lastExchange).getTime();default:return 0}}),r={total:l.length,active:l.filter(s=>s.isActive).length,avgRate:l.length>0?Math.round(l.reduce((s,a)=>s+a.acceptanceRate,0)/l.length):0,recurring:l.filter(s=>s.totalExchanges>1).length,totalExchanges:l.reduce((s,a)=>s+a.totalExchanges,0)};return E?e.jsx(f,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(f,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Gestion des Clients"}),e.jsx("p",{className:"text-slate-600",children:"Vue d'ensemble de vos clients et de leur activité"})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-sky-100 rounded-lg",children:e.jsx(v,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:r.total}),e.jsx("div",{className:"text-xs text-slate-600",children:"Clients uniques"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:r.active}),e.jsx("div",{className:"text-xs text-slate-600",children:"Clients actifs"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(b,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:[r.avgRate,"%"]}),e.jsx("div",{className:"text-xs text-slate-600",children:"Taux d'acceptation"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-5",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:r.totalExchanges}),e.jsx("div",{className:"text-xs text-slate-600",children:"Échanges totaux"})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par nom, téléphone ou email...",value:o,onChange:s=>C(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Statut:"})]}),e.jsxs("select",{value:x,onChange:s=>A(s.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[e.jsxs("option",{value:"all",children:["Tous (",r.total,")"]}),e.jsxs("option",{value:"active",children:["Actifs (",r.active,")"]}),e.jsxs("option",{value:"inactive",children:["Inactifs (",r.total-r.active,")"]})]}),e.jsxs("select",{value:p,onChange:s=>S(s.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[e.jsx("option",{value:"exchanges",children:"Plus d'échanges"}),e.jsx("option",{value:"rate",children:"Meilleur taux"}),e.jsx("option",{value:"recent",children:"Plus récents"})]})]})]})}),g.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx(v,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Aucun client trouvé"}),e.jsx("p",{className:"text-slate-600",children:o?"Essayez de modifier votre recherche":"Les clients apparaîtront ici après leur premier échange"})]}):e.jsx("div",{className:"space-y-3",children:g.map((s,a)=>e.jsx(P,{to:`/merchant/client/${encodeURIComponent(s.phone)}`,className:"block bg-white rounded-xl shadow-sm border border-slate-200 hover:shadow-md hover:border-sky-200 transition-all p-5 group",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-sky-100 to-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-sky-700",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 text-lg truncate",children:s.name}),s.isActive&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 text-xs font-medium rounded-full",children:"Actif"}),s.totalExchanges>5&&e.jsx(b,{className:"w-4 h-4 text-amber-500"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"truncate",children:s.email})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 pl-15",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Échanges"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-sky-600"}),e.jsx("span",{className:"font-semibold text-slate-900",children:s.totalExchanges})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Taux acceptation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-1.5 max-w-[60px]",children:e.jsx("div",{className:`h-1.5 rounded-full ${s.acceptanceRate>=80?"bg-emerald-500":s.acceptanceRate>=50?"bg-amber-500":"bg-red-500"}`,style:{width:`${s.acceptanceRate}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:[s.acceptanceRate,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Statuts"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.pending>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-amber-100 text-amber-700 rounded",children:[s.pending," en attente"]}),s.validated>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded",children:[s.validated," validés"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Dernière activité"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-700",children:[e.jsx(q,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:s.daysSinceLastExchange===0?"Aujourd'hui":s.daysSinceLastExchange===1?"Hier":`Il y a ${s.daysSinceLastExchange}j`})]})]})]})]}),e.jsx(z,{className:"w-5 h-5 text-slate-400 group-hover:text-sky-600 transition-colors flex-shrink-0"})]})},a))})]})})}export{oe as default};
