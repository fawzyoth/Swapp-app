import{s as i,j as e}from"./index-zDZ3Lj_p.js";import{u as q,r as c,L as m}from"./react-vendor-CTUriZ5h.js";import{M as j}from"./MerchantLayout-B4VsQmsY.js";import{P as p}from"./package-ChDCFdB3.js";import{C as A}from"./clock-Dhxn45-3.js";import{C as u}from"./check-circle-CyNeZd0p.js";import{X as L}from"./x-circle-D3f66Y07.js";import{B as g}from"./bar-chart-3-DdlwYHtY.js";import{U as V}from"./users-4zMWxYqH.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./store-B-5iV_wL.js";import"./layout-dashboard-CqNl1jWq.js";import"./printer-B3I1m1op.js";import"./message-square-B53yKzw3.js";import"./log-out-BX30H4-p.js";function Y(){const f=q(),[a,N]=c.useState({total:0,pending:0,validated:0,rejected:0,completed:0,validationRate:0}),[x,b]=c.useState([]),[v,w]=c.useState(!0);c.useEffect(()=>{y(),S()},[]);const y=async()=>{const{data:{session:t}}=await i.auth.getSession();t||f("/merchant/login")},S=async()=>{try{const{data:{session:t}}=await i.auth.getSession();if(!t)return;const{data:n}=await i.from("merchants").select("id").eq("email",t.user.email).maybeSingle();if(!n)return;const{data:l}=await i.from("exchanges").select("status, reason").eq("merchant_id",n.id);if(l){const d=l.length,C=l.filter(s=>s.status==="pending").length,h=l.filter(s=>s.status==="validated"||s.status==="preparing"||s.status==="in_transit"||s.status==="completed").length,R=l.filter(s=>s.status==="rejected").length,k=l.filter(s=>s.status==="completed").length,E=d>0?Math.round(h/d*100):0;N({total:d,pending:C,validated:h,rejected:R,completed:k,validationRate:E});const r={};l.forEach(s=>{r[s.reason]=(r[s.reason]||0)+1});const M=Object.entries(r).map(([s,o])=>({reason:s,count:o})).sort((s,o)=>o.count-s.count).slice(0,5);b(M)}}catch(t){console.error("Error fetching stats:",t)}finally{w(!1)}};return v?e.jsx(j,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(j,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Vue d'ensemble"}),e.jsx("p",{className:"text-slate-600",children:"Statistiques et métriques de vos échanges"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(p,{className:"w-6 h-6 text-blue-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.total})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Total des échanges"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-yellow-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.pending})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"En attente"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-emerald-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.validated})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Validés"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(L,{className:"w-6 h-6 text-red-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.rejected})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Rejetés"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Taux de validation"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-4",children:e.jsx("div",{className:"bg-emerald-600 h-4 rounded-full transition-all",style:{width:`${a.validationRate}%`}})})}),e.jsxs("span",{className:"text-2xl font-bold text-slate-900",children:[a.validationRate,"%"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Échanges complétés"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{className:"w-12 h-12 text-green-600"}),e.jsx("span",{className:"text-3xl font-bold text-slate-900",children:a.completed})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"Raisons d'échange principales"]}),x.length>0?e.jsx("div",{className:"space-y-3",children:x.map((t,n)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-700",children:t.reason}),e.jsx("span",{className:"font-medium text-slate-900",children:t.count})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-sky-600 h-2 rounded-full",style:{width:`${t.count/a.total*100}%`}})})]},n))}):e.jsx("p",{className:"text-slate-600 text-center py-8",children:"Aucune donnée disponible"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Accès rapide"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(m,{to:"/merchant/exchanges",className:"flex items-center gap-3 p-4 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(p,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Gérer les échanges"})]}),e.jsxs(m,{to:"/merchant/clients",className:"flex items-center gap-3 p-4 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(V,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Voir les clients"})]}),e.jsxs(m,{to:"/merchant/simulation",className:"flex items-center gap-3 p-4 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(g,{className:"w-5 h-5 text-slate-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Mode simulation"})]})]})]})]})]})})}export{Y as default};
