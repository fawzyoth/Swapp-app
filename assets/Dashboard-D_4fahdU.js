import{r,s,j as e}from"./index-BwkpV__w.js";import{F as y}from"./FinanceLayout-CjQnoYoi.js";import{R as f}from"./refresh-cw-BOylv9iS.js";import{W as N}from"./wallet-zRcUviwm.js";import{T as V}from"./trending-up-BjseU-dt.js";import{C as X}from"./clock-BPjCS67I.js";import{A as u}from"./alert-triangle-7C2TF2Jt.js";import{C as g}from"./check-circle-dmQidnzw.js";import{A as B,a as w}from"./arrow-up-right-DKvJORgi.js";import"./x-SOWQ9pA1.js";import"./createLucideIcon-Br99KG2k.js";import"./menu-SfYPTgzA.js";import"./calculator-nKkh06Wm.js";import"./layout-dashboard-D5Mf8n7V.js";import"./credit-card-BxGZxUT_.js";import"./file-text-Du91DJD5.js";import"./bar-chart-3-NLzj-RlB.js";import"./building-2-Dlcl3Cjy.js";import"./users-C-5fSS9v.js";import"./settings-CR5Ev8rB.js";import"./log-out-bEHVpLxn.js";function ne(){const[a,n]=r.useState({totalWalletBalance:0,pendingReconciliation:0,pendingPayouts:0,activeAlerts:0,todayTransactions:0,todayVolume:0}),[h,i]=r.useState([]),[p,c]=r.useState([]),[v,l]=r.useState(!0);r.useEffect(()=>{b()},[]);const b=async()=>{l(!0);try{const{data:t,error:j}=await s.from("finance_wallets").select("balance").eq("is_active",!0);if(j){console.log("Using demo data - finance tables not created yet"),n({totalWalletBalance:45680.5,pendingReconciliation:3,pendingPayouts:5,activeAlerts:2,todayTransactions:24,todayVolume:8750}),i([{id:"1",transaction_number:"TXN-2025-000124",transaction_type:"client_collection",amount:35,created_at:new Date().toISOString()},{id:"2",transaction_number:"TXN-2025-000123",transaction_type:"swapp_fee",amount:-9,created_at:new Date(Date.now()-36e5).toISOString()},{id:"3",transaction_number:"TXN-2025-000122",transaction_type:"merchant_credit",amount:26,created_at:new Date(Date.now()-72e5).toISOString()},{id:"4",transaction_number:"TXN-2025-000121",transaction_type:"client_collection",amount:50,created_at:new Date(Date.now()-108e5).toISOString()},{id:"5",transaction_number:"TXN-2025-000120",transaction_type:"merchant_payout",amount:-156,created_at:new Date(Date.now()-144e5).toISOString()},{id:"6",transaction_number:"TXN-2025-000119",transaction_type:"dp_to_company",amount:450,created_at:new Date(Date.now()-18e6).toISOString()}]),c([{id:"1",severity:"high",title:"Écart de réconciliation détecté",description:"Différence de 45 TND sur la période du 10-15 Décembre"},{id:"2",severity:"medium",title:"Paiement marchand en retard",description:"TechStore - paiement de 289 TND en attente depuis 3 jours"}]),l(!1);return}const D=(t==null?void 0:t.reduce((m,x)=>m+Number(x.balance),0))||0,{count:T}=await s.from("finance_reconciliations").select("*",{count:"exact",head:!0}).eq("status","pending"),{count:A}=await s.from("finance_payouts").select("*",{count:"exact",head:!0}).in("status",["pending","approved"]),{count:R}=await s.from("finance_alerts").select("*",{count:"exact",head:!0}).eq("status","open"),C=new Date().toISOString().split("T")[0],{data:d,count:P}=await s.from("finance_transactions").select("amount",{count:"exact"}).gte("created_at",C),I=(d==null?void 0:d.reduce((m,x)=>m+Math.abs(Number(x.amount)),0))||0,{data:W}=await s.from("finance_transactions").select("*").order("created_at",{ascending:!1}).limit(10),{data:O}=await s.from("finance_alerts").select("*").eq("status","open").order("created_at",{ascending:!1}).limit(5);n({totalWalletBalance:D,pendingReconciliation:T||0,pendingPayouts:A||0,activeAlerts:R||0,todayTransactions:P||0,todayVolume:I}),i(W||[]),c(O||[])}catch(t){console.error("Error fetching dashboard data:",t),n({totalWalletBalance:45680.5,pendingReconciliation:3,pendingPayouts:5,activeAlerts:2,todayTransactions:24,todayVolume:8750}),i([{id:"1",transaction_number:"TXN-2025-000124",transaction_type:"client_collection",amount:35,created_at:new Date().toISOString()},{id:"2",transaction_number:"TXN-2025-000123",transaction_type:"swapp_fee",amount:-9,created_at:new Date(Date.now()-36e5).toISOString()},{id:"3",transaction_number:"TXN-2025-000122",transaction_type:"merchant_credit",amount:26,created_at:new Date(Date.now()-72e5).toISOString()}]),c([{id:"1",severity:"high",title:"Écart de réconciliation",description:"Différence détectée"}])}finally{l(!1)}},o=t=>new Intl.NumberFormat("fr-TN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)+" TND",_=t=>({client_collection:"Encaissement Client",swapp_fee:"Commission SWAPP",merchant_credit:"Crédit Marchand",dp_to_company:"Livreur → Société",company_to_swapp:"Société → SWAPP",merchant_payout:"Paiement Marchand",adjustment:"Ajustement",refund:"Remboursement"})[t]||t,S=t=>{switch(t){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}};return v?e.jsx(y,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(f,{className:"w-8 h-8 text-emerald-500 animate-spin"})})}):e.jsx(y,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tableau de Bord"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Vue d'ensemble financière"})]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(f,{className:"w-4 h-4"}),"Actualiser"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Solde Total Wallets"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:o(a.totalWalletBalance)})]}),e.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center",children:e.jsx(N,{className:"w-6 h-6 text-emerald-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Volume Aujourd'hui"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:o(a.todayVolume)}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[a.todayTransactions," transactions"]})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(V,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Réconciliations en Attente"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:a.pendingReconciliation})]}),e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Alertes Actives"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:a.activeAlerts})]}),e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${a.activeAlerts>0?"bg-red-100":"bg-green-100"}`,children:a.activeAlerts>0?e.jsx(u,{className:"w-6 h-6 text-red-600"}):e.jsx(g,{className:"w-6 h-6 text-green-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Transactions Récentes"})}),e.jsx("div",{className:"divide-y divide-gray-100",children:h.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Aucune transaction récente"}):h.map(t=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${Number(t.amount)>=0?"bg-green-100":"bg-red-100"}`,children:Number(t.amount)>=0?e.jsx(B,{className:"w-5 h-5 text-green-600"}):e.jsx(w,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:_(t.transaction_type)}),e.jsx("p",{className:"text-sm text-gray-500",children:t.transaction_number||t.id.slice(0,8)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-semibold ${Number(t.amount)>=0?"text-green-600":"text-red-600"}`,children:[Number(t.amount)>=0?"+":"",o(Number(t.amount))]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(t.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]})]},t.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Alertes en Cours"})}),e.jsx("div",{className:"divide-y divide-gray-100",children:p.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(g,{className:"w-12 h-12 text-green-500 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Aucune alerte active"})]}):p.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(u,{className:"w-5 h-5 text-orange-500 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${S(t.severity)}`,children:t.severity})}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-1",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:t.description})]})]})},t.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions Rapides"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-lg border border-gray-200 hover:border-emerald-300 hover:bg-emerald-50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-emerald-600"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Réconcilier"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-blue-600"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nouveau Paiement"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-lg border border-gray-200 hover:border-purple-300 hover:bg-purple-50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-purple-600"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Voir Wallets"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-lg border border-gray-200 hover:border-orange-300 hover:bg-orange-50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(u,{className:"w-5 h-5 text-orange-600"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Voir Alertes"})]})]})]})]})})}export{ne as default};
