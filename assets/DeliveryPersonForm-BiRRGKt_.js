import{s as l,j as e}from"./index-DGuJxBT7.js";import{u as N,h as E,r as i}from"./react-vendor-CTUriZ5h.js";import{A as b}from"./AdminLayout-DehZTjR5.js";import{A as S}from"./arrow-left-CxjwE-xR.js";import{T as C}from"./truck-CgEV9F53.js";import{S as q}from"./save-DeLrZxpc.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./shield-BNgLrtrc.js";import"./layout-dashboard-CqNl1jWq.js";import"./users-4zMWxYqH.js";import"./banknote-JI0QWWz-.js";import"./wallet-CVOcG8S4.js";import"./store-B-5iV_wL.js";import"./file-text-B3Ewreww.js";import"./clock-Dhxn45-3.js";import"./home-9mW_oZwz.js";function K(){const n=N(),{id:d}=E(),a=!!d,[r,o]=i.useState({name:"",email:"",phone:"",password:""}),[m,c]=i.useState(!1),[g,v]=i.useState(a),[u,p]=i.useState("");i.useEffect(()=>{a&&j()},[d]);const j=async()=>{try{const{data:s,error:t}=await l.from("delivery_persons").select("*").eq("id",d).single();if(t)throw t;s&&o({name:s.name,email:s.email,phone:s.phone,password:""})}catch(s){console.error("Error fetching delivery person:",s),n("/admin/delivery-persons")}finally{v(!1)}},w=async s=>{s.preventDefault(),c(!0),p("");try{if(a){const{error:t}=await l.from("delivery_persons").update({name:r.name,email:r.email,phone:r.phone}).eq("id",d);if(t)throw t}else{const{data:t}=await l.from("delivery_persons").select("id").eq("email",r.email).maybeSingle();if(t)throw new Error("Un livreur avec cet email existe déjà");const{data:y}=await l.from("merchants").select("id").eq("email",r.email).maybeSingle();if(y)throw new Error("Cet email est déjà utilisé par un compte e-commerçant. Veuillez utiliser un autre email.");const{data:x,error:h}=await l.auth.signUp({email:r.email,password:r.password,options:{data:{name:r.name,phone:r.phone,role:"delivery_person"}}});if(h)throw h;if(!x.user)throw new Error("Erreur lors de la création du compte");const{error:f}=await l.from("delivery_persons").insert({id:x.user.id,email:r.email,name:r.name,phone:r.phone});if(f)throw f}n("/admin/delivery-persons")}catch(t){console.error("Error saving delivery person:",t),p(t.message||"Erreur lors de l'enregistrement")}finally{c(!1)}};return g?e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})})}):e.jsx(b,{children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>n("/admin/delivery-persons"),className:"flex items-center gap-2 text-slate-600 hover:text-slate-900 mb-6",children:[e.jsx(S,{className:"w-5 h-5"}),"Retour aux livreurs"]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center",children:e.jsx(C,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:a?"Modifier le livreur":"Ajouter un livreur"}),e.jsx("p",{className:"text-slate-600",children:a?"Modifiez les informations du livreur":"Créez un nouveau compte livreur"})]})]}),u&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:u}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nom complet *"}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:s=>o({...r,name:s.target.value}),placeholder:"Nom du livreur",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:r.email,onChange:s=>o({...r,email:s.target.value}),placeholder:"email@exemple.com",disabled:a,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 disabled:bg-slate-100 disabled:cursor-not-allowed"}),a&&e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"L'email ne peut pas être modifié"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Téléphone *"}),e.jsx("input",{type:"tel",required:!0,value:r.phone,onChange:s=>o({...r,phone:s.target.value}),placeholder:"+216 XX XXX XXX",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),!a&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mot de passe *"}),e.jsx("input",{type:"password",required:!0,value:r.password,onChange:s=>o({...r,password:s.target.value}),placeholder:"Minimum 6 caractères",minLength:6,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>n("/admin/delivery-persons"),className:"flex-1 px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition-colors",children:"Annuler"}),e.jsxs("button",{type:"submit",disabled:m,className:"flex-1 px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),m?"Enregistrement...":a?"Enregistrer":"Créer le livreur"]})]})]})]})]})})}export{K as default};
