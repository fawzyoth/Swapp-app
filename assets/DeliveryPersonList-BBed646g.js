import{u as E,r as l,s as c,j as e}from"./index-4fl_mEjj.js";import{A as v}from"./AdminLayout-Dxtdv1zb.js";import{P as _}from"./plus-BvSv4BW2.js";import{S as L}from"./search-CM_gKEFn.js";import{T as b}from"./truck-COZlEb6f.js";import{M as T}from"./mail-B7OxAxMr.js";import{P as A}from"./phone-DBRcCnSf.js";import{C as M}from"./check-circle-Bjxp17BA.js";import{X as q}from"./x-circle-BLGSGex5.js";import{E as z}from"./eye-XKHKh-5H.js";import{S as R}from"./square-pen-BBHLGXT9.js";import{T as F}from"./trash-2-BOJNO1kd.js";import"./x-B8X7lZOY.js";import"./createLucideIcon-DGm6Wim6.js";import"./menu-5lsVQnXG.js";import"./shield-BIjdbTUJ.js";import"./layout-dashboard-CUFDpKip.js";import"./users-BterXDAZ.js";import"./banknote-uCNahxc1.js";import"./wallet-DRWcPQQN.js";import"./store-DNK-TsLt.js";import"./file-text-CZNKAXPz.js";import"./clock-T1Grp3ls.js";import"./home-Dlzpkrth.js";function ne(){const o=E(),[n,N]=l.useState([]),[u,f]=l.useState([]),[g,y]=l.useState(!0),[a,w]=l.useState(""),[C,d]=l.useState(!1),[i,m]=l.useState(null),[S,P]=l.useState({});l.useEffect(()=>{j()},[]),l.useEffect(()=>{D()},[a,n]);const j=async()=>{try{const{data:s,error:t}=await c.from("delivery_persons").select("*").order("created_at",{ascending:!1});if(t)throw t;if(N(s||[]),s&&s.length>0){const r={};for(const x of s){const{data:p}=await c.from("delivery_verifications").select("status").eq("delivery_person_id",x.id);p?r[x.id]={accepted:p.filter(h=>h.status==="accepted").length,rejected:p.filter(h=>h.status==="rejected").length}:r[x.id]={accepted:0,rejected:0}}P(r)}}catch(s){console.error("Error fetching delivery persons:",s)}finally{y(!1)}},D=()=>{if(!a){f(n);return}const s=a.toLowerCase(),t=n.filter(r=>r.name.toLowerCase().includes(s)||r.email.toLowerCase().includes(s)||r.phone.includes(s));f(t)},k=async()=>{if(i)try{await c.from("delivery_verifications").delete().eq("delivery_person_id",i.id);const{error:s}=await c.from("delivery_persons").delete().eq("id",i.id);if(s)throw s;d(!1),m(null),j()}catch(s){console.error("Error deleting delivery person:",s),alert("Erreur lors de la suppression du livreur")}};return g?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})})}):e.jsx(v,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Livreurs"}),e.jsx("p",{className:"text-slate-600",children:"Gérez les comptes des livreurs"})]}),e.jsxs("button",{onClick:()=>o("/admin/delivery-person/new"),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors",children:[e.jsx(_,{className:"w-5 h-5"}),"Ajouter un livreur"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par nom, email ou téléphone...",value:a,onChange:s=>w(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:u.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(b,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Aucun livreur trouvé"}),e.jsx("p",{className:"text-slate-600 mb-4",children:a?"Essayez de modifier votre recherche":"Commencez par ajouter un livreur"}),!a&&e.jsx("button",{onClick:()=>o("/admin/delivery-person/new"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Ajouter un livreur"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-slate-700",children:"Livreur"}),e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-slate-700",children:"Contact"}),e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-slate-700",children:"Vérifications"}),e.jsx("th",{className:"text-right py-4 px-6 font-semibold text-slate-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:u.map(s=>{const t=S[s.id]||{accepted:0,rejected:0},r=t.accepted+t.rejected;return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Inscrit le ",new Date(s.created_at).toLocaleDateString("fr-FR")]})]})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(T,{className:"w-4 h-4"}),s.email]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(A,{className:"w-4 h-4"}),s.phone]})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-900",children:r}),e.jsx("span",{className:"text-slate-500",children:"total"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-emerald-600",children:[e.jsx(M,{className:"w-4 h-4"}),t.accepted]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-red-600",children:[e.jsx(q,{className:"w-4 h-4"}),t.rejected]})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>o(`/admin/delivery-person/${s.id}`),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Voir",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>o(`/admin/delivery-person/${s.id}/edit`),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Modifier",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{m(s),d(!0)},className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Supprimer",children:e.jsx(F,{className:"w-5 h-5"})})]})})]},s.id)})})]})}),C&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-4",children:"Confirmer la suppression"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["Êtes-vous sûr de vouloir supprimer le livreur ",e.jsx("strong",{children:i.name})," ? Cette action est irréversible."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d(!1),m(null)},className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Annuler"}),e.jsx("button",{onClick:k,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Supprimer"})]})]})})]})})}export{ne as default};
