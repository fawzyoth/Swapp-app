import{u as _e,s as h,j as e}from"./index-C-n_DeK3.js";import{f as Be,u as Re,r as s}from"./react-vendor-CTUriZ5h.js";import{L as de}from"./LanguageSwitcher-DO_1CkQy.js";import{S as le}from"./store-B-5iV_wL.js";import{A as ze}from"./arrow-left-CxjwE-xR.js";import{C as q}from"./check-Cm21nyZb.js";import{M as Ae}from"./map-pin-DUtVdt2Q.js";import{V}from"./video-Cwp6uQ4V.js";import{c as De}from"./createLucideIcon-CMjKDoEE.js";import{X as Te}from"./x-D4qrk5Qy.js";import"./supabase-Bl4YWSQ9.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=De("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),J=[{id:1,name:"Tunis",delegations:[{id:1,name:"Tunis Ville"},{id:2,name:"Le Bardo"},{id:3,name:"Le Kram"},{id:4,name:"La Goulette"},{id:5,name:"Carthage"},{id:6,name:"Sidi Bou Said"},{id:7,name:"La Marsa"},{id:8,name:"Sidi Hassine"},{id:9,name:"El Ouardia"},{id:10,name:"El Kabaria"},{id:11,name:"Ezzouhour"},{id:12,name:"El Hrairia"},{id:13,name:"Bab El Bhar"},{id:14,name:"Bab Souika"},{id:15,name:"El Omrane"},{id:16,name:"El Omrane Superieur"},{id:17,name:"Ettahrir"},{id:18,name:"El Menzah"},{id:19,name:"Cite El Khadra"},{id:20,name:"El Manar"},{id:21,name:"Djebel Jelloud"}]},{id:2,name:"Ariana",delegations:[{id:1,name:"Ariana Ville"},{id:2,name:"La Soukra"},{id:3,name:"Raoued"},{id:4,name:"Kalaat El Andalous"},{id:5,name:"Sidi Thabet"},{id:6,name:"Ettadhamen"},{id:7,name:"Mnihla"}]},{id:3,name:"Ben Arous",delegations:[{id:1,name:"Ben Arous"},{id:2,name:"La Nouvelle Medina"},{id:3,name:"El Mourouj"},{id:4,name:"Hammam Lif"},{id:5,name:"Hammam Chott"},{id:6,name:"Bou Mhel El Bassatine"},{id:7,name:"Ezzahra"},{id:8,name:"Rades"},{id:9,name:"Megrine"},{id:10,name:"Mohamedia"},{id:11,name:"Fouchana"},{id:12,name:"Mornag"}]},{id:4,name:"Manouba",delegations:[{id:1,name:"Manouba"},{id:2,name:"Den Den"},{id:3,name:"Douar Hicher"},{id:4,name:"Oued Ellil"},{id:5,name:"Mornaguia"},{id:6,name:"Borj El Amri"},{id:7,name:"Djedeida"},{id:8,name:"Tebourba"},{id:9,name:"El Battan"}]},{id:5,name:"Bizerte",delegations:[{id:1,name:"Bizerte Nord"},{id:2,name:"Bizerte Sud"},{id:3,name:"Sejnane"},{id:4,name:"Joumine"},{id:5,name:"Mateur"},{id:6,name:"Ghezala"},{id:7,name:"Menzel Bourguiba"},{id:8,name:"Tinja"},{id:9,name:"Utique"},{id:10,name:"Ghar El Melh"},{id:11,name:"Menzel Jemil"},{id:12,name:"El Alia"},{id:13,name:"Ras Jebel"},{id:14,name:"Rafraf"}]},{id:6,name:"Beja",delegations:[{id:1,name:"Beja Nord"},{id:2,name:"Beja Sud"},{id:3,name:"Amdoun"},{id:4,name:"Nefza"},{id:5,name:"Teboursouk"},{id:6,name:"Testour"},{id:7,name:"Goubellat"},{id:8,name:"Mejez El Bab"},{id:9,name:"Thibar"}]},{id:7,name:"Jendouba",delegations:[{id:1,name:"Jendouba"},{id:2,name:"Jendouba Nord"},{id:3,name:"Bou Salem"},{id:4,name:"Tabarka"},{id:5,name:"Ain Draham"},{id:6,name:"Fernana"},{id:7,name:"Ghardimaou"},{id:8,name:"Oued Meliz"},{id:9,name:"Balta Bou Aouane"}]},{id:8,name:"Le Kef",delegations:[{id:1,name:"Le Kef Ouest"},{id:2,name:"Le Kef Est"},{id:3,name:"Nebeur"},{id:4,name:"Sakiet Sidi Youssef"},{id:5,name:"Tajerouine"},{id:6,name:"Kalaat Senan"},{id:7,name:"Kalaat Khasba"},{id:8,name:"Djerissa"},{id:9,name:"El Ksour"},{id:10,name:"Dahmani"},{id:11,name:"Sers"}]},{id:9,name:"Siliana",delegations:[{id:1,name:"Siliana Nord"},{id:2,name:"Siliana Sud"},{id:3,name:"Bou Arada"},{id:4,name:"Gaafour"},{id:5,name:"El Krib"},{id:6,name:"Sidi Bou Rouis"},{id:7,name:"Maktar"},{id:8,name:"Rouhia"},{id:9,name:"Kesra"},{id:10,name:"Bargou"},{id:11,name:"El Aroussa"}]},{id:10,name:"Nabeul",delegations:[{id:1,name:"Nabeul"},{id:2,name:"Dar Chaabane El Fehri"},{id:3,name:"Beni Khiar"},{id:4,name:"El Mida"},{id:5,name:"Korba"},{id:6,name:"Menzel Temime"},{id:7,name:"El Haouaria"},{id:8,name:"Takelsa"},{id:9,name:"Soliman"},{id:10,name:"Menzel Bouzelfa"},{id:11,name:"Beni Khalled"},{id:12,name:"Grombalia"},{id:13,name:"Bouargoub"},{id:14,name:"Hammamet"},{id:15,name:"Kelibia"},{id:16,name:"Hammam Ghezaz"}]},{id:11,name:"Zaghouan",delegations:[{id:1,name:"Zaghouan"},{id:2,name:"Zriba"},{id:3,name:"Bir Mcherga"},{id:4,name:"Djebel El Oust"},{id:5,name:"El Fahs"},{id:6,name:"Nadhour"}]},{id:12,name:"Sousse",delegations:[{id:1,name:"Sousse Ville"},{id:2,name:"Sousse Jawhara"},{id:3,name:"Sousse Riadh"},{id:4,name:"Sousse Sidi Abdelhamid"},{id:5,name:"Hammam Sousse"},{id:6,name:"Akouda"},{id:7,name:"Kalaa Kebira"},{id:8,name:"Sidi Bou Ali"},{id:9,name:"Hergla"},{id:10,name:"Enfidha"},{id:11,name:"Bouficha"},{id:12,name:"Kondar"},{id:13,name:"Sidi El Heni"},{id:14,name:"Msaken"},{id:15,name:"Kalaa Sghira"}]},{id:13,name:"Monastir",delegations:[{id:1,name:"Monastir"},{id:2,name:"Ouerdanine"},{id:3,name:"Sahline"},{id:4,name:"Zeramdine"},{id:5,name:"Beni Hassen"},{id:6,name:"Jemmal"},{id:7,name:"Bembla"},{id:8,name:"Moknine"},{id:9,name:"Bekalta"},{id:10,name:"Teboulba"},{id:11,name:"Ksar Hellal"},{id:12,name:"Ksibet El Mediouni"},{id:13,name:"Sayada Lamta Bou Hjar"}]},{id:14,name:"Mahdia",delegations:[{id:1,name:"Mahdia"},{id:2,name:"Bou Merdes"},{id:3,name:"Ouled Chamekh"},{id:4,name:"Chorbane"},{id:5,name:"Hebira"},{id:6,name:"Essouassi"},{id:7,name:"El Jem"},{id:8,name:"Chebba"},{id:9,name:"Melloulech"},{id:10,name:"Sidi Alouane"},{id:11,name:"Ksour Essef"}]},{id:15,name:"Sfax",delegations:[{id:1,name:"Sfax Ville"},{id:2,name:"Sfax Ouest"},{id:3,name:"Sfax Sud"},{id:4,name:"Sakiet Ezzit"},{id:5,name:"Sakiet Eddaier"},{id:6,name:"Thyna"},{id:7,name:"El Amra"},{id:8,name:"Agareb"},{id:9,name:"Jebeniana"},{id:10,name:"El Hencha"},{id:11,name:"Menzel Chaker"},{id:12,name:"Ghraiba"},{id:13,name:"Bir Ali Ben Khalifa"},{id:14,name:"Skhira"},{id:15,name:"Mahares"},{id:16,name:"Kerkennah"}]},{id:16,name:"Kairouan",delegations:[{id:1,name:"Kairouan Nord"},{id:2,name:"Kairouan Sud"},{id:3,name:"Chebika"},{id:4,name:"Sbikha"},{id:5,name:"Haffouz"},{id:6,name:"Ala"},{id:7,name:"Hajeb El Ayoun"},{id:8,name:"Nasrallah"},{id:9,name:"Chrarda"},{id:10,name:"Bouhajla"},{id:11,name:"El Oueslatia"}]},{id:17,name:"Kasserine",delegations:[{id:1,name:"Kasserine Nord"},{id:2,name:"Kasserine Sud"},{id:3,name:"Ezzouhour"},{id:4,name:"Hassi El Ferid"},{id:5,name:"Sbeitla"},{id:6,name:"Sbiba"},{id:7,name:"Djedeliane"},{id:8,name:"El Ayoun"},{id:9,name:"Thala"},{id:10,name:"Hidra"},{id:11,name:"Foussana"},{id:12,name:"Feriana"},{id:13,name:"Majel Bel Abbes"}]},{id:18,name:"Sidi Bouzid",delegations:[{id:1,name:"Sidi Bouzid Ouest"},{id:2,name:"Sidi Bouzid Est"},{id:3,name:"Jilma"},{id:4,name:"Cebbala Ouled Asker"},{id:5,name:"Bir El Hafey"},{id:6,name:"Sidi Ali Ben Aoun"},{id:7,name:"Menzel Bouzaiane"},{id:8,name:"Meknassy"},{id:9,name:"Souk Jedid"},{id:10,name:"Mezzouna"},{id:11,name:"Regueb"},{id:12,name:"Ouled Haffouz"}]},{id:19,name:"Gabes",delegations:[{id:1,name:"Gabes Ville"},{id:2,name:"Gabes Ouest"},{id:3,name:"Gabes Sud"},{id:4,name:"Ghannouch"},{id:5,name:"Metouia"},{id:6,name:"Menzel El Habib"},{id:7,name:"El Hamma"},{id:8,name:"Matmata"},{id:9,name:"Nouvelle Matmata"},{id:10,name:"Mareth"}]},{id:20,name:"Medenine",delegations:[{id:1,name:"Medenine Nord"},{id:2,name:"Medenine Sud"},{id:3,name:"Beni Khedache"},{id:4,name:"Ben Guerdane"},{id:5,name:"Zarzis"},{id:6,name:"Houmt Souk"},{id:7,name:"Midoun"},{id:8,name:"Ajim"},{id:9,name:"Sidi Makhlouf"}]},{id:21,name:"Tataouine",delegations:[{id:1,name:"Tataouine Nord"},{id:2,name:"Tataouine Sud"},{id:3,name:"Smar"},{id:4,name:"Bir Lahmar"},{id:5,name:"Ghomrassen"},{id:6,name:"Dhehiba"},{id:7,name:"Remada"}]},{id:22,name:"Gafsa",delegations:[{id:1,name:"Gafsa Nord"},{id:2,name:"Gafsa Sud"},{id:3,name:"Sidi Aich"},{id:4,name:"El Ksar"},{id:5,name:"Oum El Araies"},{id:6,name:"Redeyef"},{id:7,name:"Metlaoui"},{id:8,name:"Mdhila"},{id:9,name:"El Guettar"},{id:10,name:"Belkhir"},{id:11,name:"Sned"}]},{id:23,name:"Tozeur",delegations:[{id:1,name:"Tozeur"},{id:2,name:"Degache"},{id:3,name:"Tameghza"},{id:4,name:"Nefta"},{id:5,name:"Hazoua"}]},{id:24,name:"Kebili",delegations:[{id:1,name:"Kebili Nord"},{id:2,name:"Kebili Sud"},{id:3,name:"Souk El Ahad"},{id:4,name:"Douz Nord"},{id:5,name:"Douz Sud"},{id:6,name:"Faouar"}]}],Ke=E=>J.find(m=>m.id===E),oe=E=>{const m=Ke(E);return(m==null?void 0:m.delegations)||[]};function Ze(){const[E]=Be(),m=Re(),{t,lang:l,dir:T}=_e(),x=E.get("merchant")||"",g=E.get("bordereau")||"",me=[{key:"incorrectSize",fr:"Taille incorrecte",ar:"Ù…Ù‚Ø§Ø³ ØºÙŠØ± ØµØ­ÙŠØ­"},{key:"wrongColor",fr:"Couleur non conforme",ar:"Ù„ÙˆÙ† ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚"},{key:"defectiveProduct",fr:"Produit dÃ©fectueux",ar:"Ù…Ù†ØªØ¬ Ù…Ø¹ÙŠØ¨"},{key:"damagedProduct",fr:"Produit endommagÃ©",ar:"Ù…Ù†ØªØ¬ ØªØ§Ù„Ù"},{key:"notAsDescribed",fr:"Ne correspond pas Ã  la description",ar:"Ù„Ø§ ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„ÙˆØµÙ"},{key:"changedMind",fr:"Changement d'avis",ar:"ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø£ÙŠ"},{key:"other",fr:"Autre",ar:"Ø£Ø®Ø±Ù‰"}],[c,$]=s.useState(null),[i,b]=s.useState({clientName:"",clientPhone:"",clientAddress:"",clientGovernorateId:0,clientDelegation:"",clientCountry:"Tunisia",productName:"",reason:""}),[I,X]=s.useState([]),[C,U]=s.useState(null),[f,Z]=s.useState([]),[Q,W]=s.useState(!1),[ce,_]=s.useState(!0),[ue,Y]=s.useState(!1),[K,p]=s.useState(""),[he,xe]=s.useState(!1),[ge,be]=s.useState(!0),[R,G]=s.useState(!1),[H,ee]=s.useState(!1),[fe,ae]=s.useState(!1),[z,P]=s.useState(0),[Ge,pe]=s.useState(""),M=s.useRef(null),F=s.useRef(null),L=s.useRef([]),j=s.useRef(null),O=s.useRef(null),v=s.useRef(null),N=s.useRef([]),y=s.useRef(null),A=60;s.useEffect(()=>{console.log("ExchangeForm - merchantId:",x,"bordereauCode:",g),g?je():x?ve():(_(!1),p(t("noMerchantSpecified")))},[x,g]);const je=async()=>{try{const{data:a,error:n}=await h.from("merchant_bordereaux").select("*, merchants(*)").eq("bordereau_code",g).single();if(n||!a){p("Bordereau non trouve"),_(!1);return}if(a.status!=="available"){if(a.exchange_id){const{data:o}=await h.from("exchanges").select("exchange_code").eq("id",a.exchange_id).single();if(o&&o.exchange_code){m(`/client/tracking/${o.exchange_code}`);return}}const{data:r}=await h.from("exchanges").select("exchange_code").eq("bordereau_code",g).maybeSingle();if(r&&r.exchange_code){m(`/client/tracking/${r.exchange_code}`);return}p("Ce bordereau a deja ete utilise"),_(!1);return}$(a.merchants)}catch(a){console.error("Error loading bordereau:",a),p("Erreur lors du chargement du bordereau")}finally{_(!1)}};s.useEffect(()=>{const a=localStorage.getItem("lastClientPhone");a&&ne(a)},[]);const ve=async()=>{console.log("Loading merchant with ID:",x);try{const{data:a,error:n}=await h.from("merchants").select("*").eq("id",x).single();if(console.log("Merchant query result:",{data:a,error:n}),n)throw n;$(a)}catch(a){console.error("Error loading merchant:",a),p(t("merchantNotFound"))}finally{_(!1)}},ne=async a=>{Y(!0);try{const{data:n}=await h.from("exchanges").select("*").eq("client_phone",a).order("created_at",{ascending:!1}).limit(1);if(n&&n.length>0){const r=n[0],o=r.client_governorate_id||0;b({clientName:r.client_name||"",clientPhone:a,clientAddress:r.client_address||"",clientGovernorateId:o,clientDelegation:r.client_delegation||"",clientCountry:r.client_country||"Tunisia",productName:"",reason:""}),o>0&&X(oe(o)),xe(!0)}}catch(n){console.error("Error loading previous data:",n)}finally{Y(!1)}},Ne=async a=>{b({...i,clientPhone:a}),a.length>=8&&ne(a)},ye=a=>{b({...i,clientGovernorateId:a,clientDelegation:""}),X(oe(a))},Se=async()=>{try{const a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});j.current=a,ee(!0)}catch(a){console.error("Error accessing camera:",a),p(t("cameraAccessError"))}};s.useEffect(()=>{H&&M.current&&j.current&&(M.current.srcObject=j.current,M.current.play().catch(a=>{console.error("Error playing video:",a)}))},[H]);const re=()=>{v.current&&(clearInterval(v.current),v.current=null),y.current&&(clearInterval(y.current),y.current=null),j.current&&(j.current.getTracks().forEach(a=>a.stop()),j.current=null),ee(!1),G(!1),P(0)},te=()=>{if(!M.current||!O.current)return null;const a=M.current,n=O.current,r=n.getContext("2d");return r?(n.width=a.videoWidth||640,n.height=a.videoHeight||480,r.drawImage(a,0,0,n.width,n.height),n.toDataURL("image/jpeg",.8)):null},we=async a=>new Promise(n=>{const r=document.createElement("video");r.src=a,r.muted=!0,r.playsInline=!0;const o=[],d=document.createElement("canvas"),S=d.getContext("2d");r.onloadedmetadata=()=>{const k=r.duration;d.width=r.videoWidth||640,d.height=r.videoHeight||480;const w=[.1,k*.33,k*.66,k-.1].filter(D=>D>0&&D<k);let u=0;const B=()=>{if(u>=w.length){r.remove(),n(o);return}r.currentTime=w[u]};r.onseeked=()=>{if(S){S.drawImage(r,0,0,d.width,d.height);const D=d.toDataURL("image/jpeg",.8);o.push(D)}u++,B()},B()},r.onerror=()=>{n(o)},setTimeout(()=>{o.length===0&&n(N.current)},1e4)}),Ee=()=>{if(!j.current)return;L.current=[],N.current=[];const a=new MediaRecorder(j.current,{mimeType:"video/webm"});a.ondataavailable=n=>{n.data.size>0&&L.current.push(n.data)},a.onstop=async()=>{v.current&&(clearInterval(v.current),v.current=null);const n=new Blob(L.current,{type:"video/webm"}),r=new FileReader;r.onloadend=async()=>{const o=r.result;U(o),ae(!0);let d=await we(o);if(d.length===0&&N.current.length>0&&(d=N.current),d.length>4){const S=Math.floor(d.length/4);d=[d[0],d[S],d[S*2],d[d.length-1]]}Z(d),ae(!1)},r.readAsDataURL(n),re()},F.current=a,a.start(),G(!0),P(0),pe(""),y.current=setInterval(()=>{P(n=>{const r=n+1;return r>=A&&ie(),r})},1e3),setTimeout(()=>{const n=te();n&&N.current.push(n)},100),v.current=setInterval(()=>{const n=te();n&&N.current.push(n)},2e3)},ie=()=>{y.current&&(clearInterval(y.current),y.current=null),F.current&&R&&(F.current.stop(),G(!1))},se=a=>{const n=Math.floor(a/60),r=a%60;return`${n}:${r.toString().padStart(2,"0")}`},Me=()=>{U(null),Z([]),N.current=[]},ke=()=>{const a=Date.now().toString(36).toUpperCase(),n=Math.random().toString(36).substring(2,6).toUpperCase();return`EXC-${a}-${n}`},Ce=async a=>{a.preventDefault(),W(!0),p("");try{const n=ke();let r=null,o=null;const d=J.find(u=>u.id===i.clientGovernorateId),S={exchange_code:n,merchant_id:(c==null?void 0:c.id)||x,client_name:i.clientName,client_phone:i.clientPhone,client_address:i.clientAddress,client_governorate_id:i.clientGovernorateId,client_city:(d==null?void 0:d.name)||"",client_delegation:i.clientDelegation,client_country:i.clientCountry,product_name:i.productName,reason:i.reason,video:C,images:f.length>0?f:null,status:"pending",payment_status:"pending",payment_amount:0,bordereau_code:g||null},k={exchange_code:n,merchant_id:(c==null?void 0:c.id)||x,client_name:i.clientName,client_phone:i.clientPhone,client_address:i.clientAddress,client_city:(d==null?void 0:d.name)||"",client_postal_code:i.clientDelegation,client_country:i.clientCountry,product_name:i.productName,reason:i.reason,video:C,images:f.length>0?f:null,status:"pending",payment_status:"pending",payment_amount:0},w=await h.from("exchanges").insert(S).select().single();if(w.error){const u=w.error.message||"";if(u.includes("client_governorate_id")||u.includes("client_delegation")||u.includes("bordereau_code")){console.log("Using fallback insert without new columns");const B=await h.from("exchanges").insert(k).select().single();r=B.data,o=B.error}else o=w.error}else r=w.data;if(o)throw o;await h.from("status_history").insert({exchange_id:r.id,status:"pending"}),g&&await h.from("merchant_bordereaux").update({status:"assigned",exchange_id:r.id,assigned_at:new Date().toISOString()}).eq("bordereau_code",g),localStorage.setItem("lastClientPhone",i.clientPhone),m(`/client/success/${n}`)}catch(n){console.error("Error submitting exchange:",n),p(t("submissionError"))}finally{W(!1)}};return ce?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600"})}):c?ge?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 to-sky-50 flex items-center justify-center p-4",dir:T,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4",children:e.jsx(le,{className:"w-8 h-8 text-emerald-600"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:l==="ar"?"Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ØŸ":"Que souhaitez-vous faire ?"}),c&&e.jsx("p",{className:"text-slate-600 mt-2",children:c.store_name})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("button",{onClick:()=>be(!1),className:"flex items-center gap-4 p-4 bg-emerald-50 border-2 border-emerald-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-100 transition-all text-left",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center",children:e.jsx(Package,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:l==="ar"?"Ø·Ù„Ø¨ Ø§Ø³ØªØ¨Ø¯Ø§Ù„":"Demander un echange"}),e.jsx("p",{className:"text-sm text-slate-600",children:l==="ar"?"Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù…Ù†ØªØ¬Ùƒ":"Echanger votre produit"})]})]}),e.jsxs("button",{onClick:()=>m("/client/review/new?merchant="+x),className:"flex items-center gap-4 p-4 bg-amber-50 border-2 border-amber-200 rounded-xl hover:border-amber-500 hover:bg-amber-100 transition-all text-left",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center",children:e.jsx(Star,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:l==="ar"?"ØªØ±Ùƒ ØªÙ‚ÙŠÙŠÙ…":"Laisser un avis"}),e.jsx("p",{className:"text-sm text-slate-600",children:l==="ar"?"Ø´Ø§Ø±Ùƒ ØªØ¬Ø±Ø¨ØªÙƒ":"Partagez votre experience"})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-slate-50",dir:T,children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>m("/client/scan"),className:"flex items-center text-slate-600 hover:text-slate-900 transition-colors",children:[e.jsx(ze,{className:"w-5 h-5 me-2"}),e.jsx("span",{className:"font-medium",children:t("back")})]}),e.jsx(de,{})]}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:t("exchangeRequest")}),e.jsx("p",{className:"text-slate-600",children:t("fillFormToSubmit")})]}),e.jsx("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-900",children:c.name}),e.jsx("p",{className:"text-sm text-purple-600",children:t("merchant")})]})]})}),he&&e.jsxs("div",{className:"mb-6 bg-emerald-50 border border-emerald-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:t("infoFound")})]}),e.jsx("p",{className:"text-sm text-emerald-600 mt-1",children:t("infoFoundDescription")})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[K&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:K}),e.jsxs("form",{onSubmit:Ce,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:t("yourInformation")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[t("fullName")," *"]}),e.jsx("input",{type:"text",required:!0,value:i.clientName,onChange:a=>b({...i,clientName:a.target.value}),placeholder:t("yourName"),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[t("phone")," *"]}),e.jsx("input",{type:"tel",required:!0,value:i.clientPhone,onChange:a=>Ne(a.target.value),placeholder:"+216 XX XXX XXX",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",dir:"ltr"}),ue&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:t("searchingInfo")})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ae,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:t("deliveryAddress")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[t("address")," *"]}),e.jsx("input",{type:"text",required:!0,value:i.clientAddress,onChange:a=>b({...i,clientAddress:a.target.value}),placeholder:t("streetNumber"),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[l==="ar"?"Ø§Ù„ÙˆÙ„Ø§ÙŠØ©":"Gouvernorat"," *"]}),e.jsxs("select",{required:!0,value:i.clientGovernorateId,onChange:a=>ye(parseInt(a.target.value)),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:0,children:l==="ar"?"Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©":"SÃ©lectionner le gouvernorat"}),J.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[l==="ar"?"Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠØ©":"DÃ©lÃ©gation"," *"]}),e.jsxs("select",{required:!0,value:i.clientDelegation,onChange:a=>b({...i,clientDelegation:a.target.value}),disabled:I.length===0,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:bg-slate-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:I.length===0?l==="ar"?"Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹":"SÃ©lectionner d'abord le gouvernorat":l==="ar"?"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠØ©":"SÃ©lectionner la dÃ©lÃ©gation"}),I.map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[t("country")," *"]}),e.jsx("input",{type:"text",required:!0,readOnly:!0,value:i.clientCountry,className:"w-full px-4 py-3 border border-slate-300 rounded-lg bg-slate-50 cursor-not-allowed"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:t("productDetails")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[t("productName")," *"]}),e.jsx("input",{type:"text",required:!0,value:i.productName,onChange:a=>b({...i,productName:a.target.value}),placeholder:t("productNamePlaceholder"),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[t("exchangeReason")," *"]}),e.jsxs("select",{required:!0,value:i.reason,onChange:a=>b({...i,reason:a.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"",children:t("selectReason")}),me.map(a=>e.jsx("option",{value:a.fr,children:l==="ar"?a.ar:a.fr},a.key))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[t("productVideo")," *"]}),e.jsx("p",{className:"text-xs text-slate-600 mb-3",children:t("videoDescription")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("canvas",{ref:O,className:"hidden"}),H?e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:M,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-64 object-cover rounded-lg border border-slate-200 bg-black"}),R&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 bg-red-600 text-white px-3 py-1.5 rounded-full shadow-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsxs("span",{className:"font-mono font-bold",children:[se(z)," /"," ",se(A)]})]}),R&&z>=50&&e.jsx("div",{className:"absolute top-3 right-3 bg-amber-500 text-white px-3 py-1.5 rounded-full text-sm shadow-lg",children:l==="ar"?`${A-z} Ø«Ø§Ù†ÙŠØ© Ù…ØªØ¨Ù‚ÙŠØ©`:`${A-z}s restantes`}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-4",children:[R?e.jsxs("button",{type:"button",onClick:ie,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors shadow-lg animate-pulse",children:[e.jsx(Ie,{className:"w-5 h-5"}),t("stop")]}):e.jsxs("button",{type:"button",onClick:Ee,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg",children:[e.jsx(V,{className:"w-5 h-5"}),t("record")]}),e.jsxs("button",{type:"button",onClick:re,className:"flex items-center gap-2 px-4 py-2 bg-slate-500 text-white rounded-full hover:bg-slate-600 transition-colors shadow-lg",children:[e.jsx(Te,{className:"w-5 h-5"}),t("cancel")]})]})]}):C?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("video",{src:C,controls:!0,className:"w-full h-64 object-cover rounded-lg border border-slate-200"}),e.jsx("div",{className:"absolute top-2 right-2 flex gap-2",children:e.jsxs("button",{type:"button",onClick:Me,className:"flex items-center gap-1 px-3 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors shadow-lg text-sm",children:[e.jsx(V,{className:"w-4 h-4"}),l==="ar"?"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„":"RÃ©-enregistrer"]})})]}),e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-emerald-800",children:l==="ar"?"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!":"VidÃ©o enregistrÃ©e avec succÃ¨s !"}),e.jsx("p",{className:"text-xs text-emerald-600 mt-0.5",children:l==="ar"?"Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£ØªØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØªØ³Ø¬ÙŠÙ„Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰":"Si vous avez fait une erreur, vous pouvez supprimer et rÃ©-enregistrer"})]})]}),fe?e.jsxs("div",{className:"flex items-center justify-center p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-emerald-600 mr-3"}),e.jsx("span",{className:"text-sm text-slate-600",children:l==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ±...":"Extraction des images..."})]}):f.length>0?e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(q,{className:"w-5 h-5 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-emerald-700",children:l==="ar"?`ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${f.length} ØµÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`:`${f.length} images extraites automatiquement`})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:f.map((a,n)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:a,alt:`Frame ${n+1}`,className:"w-full h-full object-cover rounded-lg border border-emerald-300"}),e.jsx("span",{className:"absolute bottom-1 right-1 bg-black/50 text-white text-xs px-1.5 py-0.5 rounded",children:n+1})]},n))})]}):null]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:Se,className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-300 rounded-lg cursor-pointer hover:border-emerald-500 transition-colors",children:[e.jsx(V,{className:"w-8 h-8 text-slate-400 mb-2"}),e.jsx("span",{className:"text-sm text-slate-500",children:t("clickToRecord")})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium mb-1",children:l==="ar"?"ðŸ“¹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„:":"ðŸ“¹ Instructions d'enregistrement :"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsxs("li",{children:["â€¢"," ",l==="ar"?"Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ØªØ³Ø¬ÙŠÙ„: Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© (60 Ø«Ø§Ù†ÙŠØ©)":"DurÃ©e maximale : 1 minute (60 secondes)"]}),e.jsxs("li",{children:["â€¢"," ",l==="ar"?"Ø£Ø¸Ù‡Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¨ÙˆØ¶ÙˆØ­ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙˆØ§ÙŠØ§":"Montrez clairement le produit sous tous les angles"]}),e.jsxs("li",{children:["â€¢"," ",l==="ar"?"ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£Øª":"Vous pouvez rÃ©-enregistrer en cas d'erreur"]})]})]})]})]})]})]})]}),e.jsx("button",{type:"submit",disabled:Q||!C,className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-colors shadow-sm",children:t(Q?"submitting":"submitRequest")})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-slate-50",dir:T,children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx(de,{})}),e.jsx("div",{className:"max-w-md mx-auto text-center",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6",children:[e.jsx("p",{className:"text-red-700 mb-4",children:K||t("merchantNotFound")}),e.jsx("button",{onClick:()=>m("/client/scan"),className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:t("scanQRCode")})]})})]})})}export{Ze as default};
