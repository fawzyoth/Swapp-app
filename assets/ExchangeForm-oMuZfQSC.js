import{u as Me,s as u,j as e}from"./index-BvuTS9li.js";import{f as ke,u as _e,r as s}from"./react-vendor-CTUriZ5h.js";import{L as de}from"./LanguageSwitcher-BaK7ikWx.js";import{A as Be}from"./arrow-left-CxjwE-xR.js";import{S as Ce}from"./store-B-5iV_wL.js";import{C as O}from"./check-Cm21nyZb.js";import{M as Re}from"./map-pin-DUtVdt2Q.js";import{V as q}from"./video-Cwp6uQ4V.js";import{c as Ae}from"./createLucideIcon-CMjKDoEE.js";import{X as ze}from"./x-D4qrk5Qy.js";import"./supabase-Bl4YWSQ9.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=Ae("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),V=[{id:1,name:"Tunis",delegations:[{id:1,name:"Tunis Ville"},{id:2,name:"Le Bardo"},{id:3,name:"Le Kram"},{id:4,name:"La Goulette"},{id:5,name:"Carthage"},{id:6,name:"Sidi Bou Said"},{id:7,name:"La Marsa"},{id:8,name:"Sidi Hassine"},{id:9,name:"El Ouardia"},{id:10,name:"El Kabaria"},{id:11,name:"Ezzouhour"},{id:12,name:"El Hrairia"},{id:13,name:"Bab El Bhar"},{id:14,name:"Bab Souika"},{id:15,name:"El Omrane"},{id:16,name:"El Omrane Superieur"},{id:17,name:"Ettahrir"},{id:18,name:"El Menzah"},{id:19,name:"Cite El Khadra"},{id:20,name:"El Manar"},{id:21,name:"Djebel Jelloud"}]},{id:2,name:"Ariana",delegations:[{id:1,name:"Ariana Ville"},{id:2,name:"La Soukra"},{id:3,name:"Raoued"},{id:4,name:"Kalaat El Andalous"},{id:5,name:"Sidi Thabet"},{id:6,name:"Ettadhamen"},{id:7,name:"Mnihla"}]},{id:3,name:"Ben Arous",delegations:[{id:1,name:"Ben Arous"},{id:2,name:"La Nouvelle Medina"},{id:3,name:"El Mourouj"},{id:4,name:"Hammam Lif"},{id:5,name:"Hammam Chott"},{id:6,name:"Bou Mhel El Bassatine"},{id:7,name:"Ezzahra"},{id:8,name:"Rades"},{id:9,name:"Megrine"},{id:10,name:"Mohamedia"},{id:11,name:"Fouchana"},{id:12,name:"Mornag"}]},{id:4,name:"Manouba",delegations:[{id:1,name:"Manouba"},{id:2,name:"Den Den"},{id:3,name:"Douar Hicher"},{id:4,name:"Oued Ellil"},{id:5,name:"Mornaguia"},{id:6,name:"Borj El Amri"},{id:7,name:"Djedeida"},{id:8,name:"Tebourba"},{id:9,name:"El Battan"}]},{id:5,name:"Bizerte",delegations:[{id:1,name:"Bizerte Nord"},{id:2,name:"Bizerte Sud"},{id:3,name:"Sejnane"},{id:4,name:"Joumine"},{id:5,name:"Mateur"},{id:6,name:"Ghezala"},{id:7,name:"Menzel Bourguiba"},{id:8,name:"Tinja"},{id:9,name:"Utique"},{id:10,name:"Ghar El Melh"},{id:11,name:"Menzel Jemil"},{id:12,name:"El Alia"},{id:13,name:"Ras Jebel"},{id:14,name:"Rafraf"}]},{id:6,name:"Beja",delegations:[{id:1,name:"Beja Nord"},{id:2,name:"Beja Sud"},{id:3,name:"Amdoun"},{id:4,name:"Nefza"},{id:5,name:"Teboursouk"},{id:6,name:"Testour"},{id:7,name:"Goubellat"},{id:8,name:"Mejez El Bab"},{id:9,name:"Thibar"}]},{id:7,name:"Jendouba",delegations:[{id:1,name:"Jendouba"},{id:2,name:"Jendouba Nord"},{id:3,name:"Bou Salem"},{id:4,name:"Tabarka"},{id:5,name:"Ain Draham"},{id:6,name:"Fernana"},{id:7,name:"Ghardimaou"},{id:8,name:"Oued Meliz"},{id:9,name:"Balta Bou Aouane"}]},{id:8,name:"Le Kef",delegations:[{id:1,name:"Le Kef Ouest"},{id:2,name:"Le Kef Est"},{id:3,name:"Nebeur"},{id:4,name:"Sakiet Sidi Youssef"},{id:5,name:"Tajerouine"},{id:6,name:"Kalaat Senan"},{id:7,name:"Kalaat Khasba"},{id:8,name:"Djerissa"},{id:9,name:"El Ksour"},{id:10,name:"Dahmani"},{id:11,name:"Sers"}]},{id:9,name:"Siliana",delegations:[{id:1,name:"Siliana Nord"},{id:2,name:"Siliana Sud"},{id:3,name:"Bou Arada"},{id:4,name:"Gaafour"},{id:5,name:"El Krib"},{id:6,name:"Sidi Bou Rouis"},{id:7,name:"Maktar"},{id:8,name:"Rouhia"},{id:9,name:"Kesra"},{id:10,name:"Bargou"},{id:11,name:"El Aroussa"}]},{id:10,name:"Nabeul",delegations:[{id:1,name:"Nabeul"},{id:2,name:"Dar Chaabane El Fehri"},{id:3,name:"Beni Khiar"},{id:4,name:"El Mida"},{id:5,name:"Korba"},{id:6,name:"Menzel Temime"},{id:7,name:"El Haouaria"},{id:8,name:"Takelsa"},{id:9,name:"Soliman"},{id:10,name:"Menzel Bouzelfa"},{id:11,name:"Beni Khalled"},{id:12,name:"Grombalia"},{id:13,name:"Bouargoub"},{id:14,name:"Hammamet"},{id:15,name:"Kelibia"},{id:16,name:"Hammam Ghezaz"}]},{id:11,name:"Zaghouan",delegations:[{id:1,name:"Zaghouan"},{id:2,name:"Zriba"},{id:3,name:"Bir Mcherga"},{id:4,name:"Djebel El Oust"},{id:5,name:"El Fahs"},{id:6,name:"Nadhour"}]},{id:12,name:"Sousse",delegations:[{id:1,name:"Sousse Ville"},{id:2,name:"Sousse Jawhara"},{id:3,name:"Sousse Riadh"},{id:4,name:"Sousse Sidi Abdelhamid"},{id:5,name:"Hammam Sousse"},{id:6,name:"Akouda"},{id:7,name:"Kalaa Kebira"},{id:8,name:"Sidi Bou Ali"},{id:9,name:"Hergla"},{id:10,name:"Enfidha"},{id:11,name:"Bouficha"},{id:12,name:"Kondar"},{id:13,name:"Sidi El Heni"},{id:14,name:"Msaken"},{id:15,name:"Kalaa Sghira"}]},{id:13,name:"Monastir",delegations:[{id:1,name:"Monastir"},{id:2,name:"Ouerdanine"},{id:3,name:"Sahline"},{id:4,name:"Zeramdine"},{id:5,name:"Beni Hassen"},{id:6,name:"Jemmal"},{id:7,name:"Bembla"},{id:8,name:"Moknine"},{id:9,name:"Bekalta"},{id:10,name:"Teboulba"},{id:11,name:"Ksar Hellal"},{id:12,name:"Ksibet El Mediouni"},{id:13,name:"Sayada Lamta Bou Hjar"}]},{id:14,name:"Mahdia",delegations:[{id:1,name:"Mahdia"},{id:2,name:"Bou Merdes"},{id:3,name:"Ouled Chamekh"},{id:4,name:"Chorbane"},{id:5,name:"Hebira"},{id:6,name:"Essouassi"},{id:7,name:"El Jem"},{id:8,name:"Chebba"},{id:9,name:"Melloulech"},{id:10,name:"Sidi Alouane"},{id:11,name:"Ksour Essef"}]},{id:15,name:"Sfax",delegations:[{id:1,name:"Sfax Ville"},{id:2,name:"Sfax Ouest"},{id:3,name:"Sfax Sud"},{id:4,name:"Sakiet Ezzit"},{id:5,name:"Sakiet Eddaier"},{id:6,name:"Thyna"},{id:7,name:"El Amra"},{id:8,name:"Agareb"},{id:9,name:"Jebeniana"},{id:10,name:"El Hencha"},{id:11,name:"Menzel Chaker"},{id:12,name:"Ghraiba"},{id:13,name:"Bir Ali Ben Khalifa"},{id:14,name:"Skhira"},{id:15,name:"Mahares"},{id:16,name:"Kerkennah"}]},{id:16,name:"Kairouan",delegations:[{id:1,name:"Kairouan Nord"},{id:2,name:"Kairouan Sud"},{id:3,name:"Chebika"},{id:4,name:"Sbikha"},{id:5,name:"Haffouz"},{id:6,name:"Ala"},{id:7,name:"Hajeb El Ayoun"},{id:8,name:"Nasrallah"},{id:9,name:"Chrarda"},{id:10,name:"Bouhajla"},{id:11,name:"El Oueslatia"}]},{id:17,name:"Kasserine",delegations:[{id:1,name:"Kasserine Nord"},{id:2,name:"Kasserine Sud"},{id:3,name:"Ezzouhour"},{id:4,name:"Hassi El Ferid"},{id:5,name:"Sbeitla"},{id:6,name:"Sbiba"},{id:7,name:"Djedeliane"},{id:8,name:"El Ayoun"},{id:9,name:"Thala"},{id:10,name:"Hidra"},{id:11,name:"Foussana"},{id:12,name:"Feriana"},{id:13,name:"Majel Bel Abbes"}]},{id:18,name:"Sidi Bouzid",delegations:[{id:1,name:"Sidi Bouzid Ouest"},{id:2,name:"Sidi Bouzid Est"},{id:3,name:"Jilma"},{id:4,name:"Cebbala Ouled Asker"},{id:5,name:"Bir El Hafey"},{id:6,name:"Sidi Ali Ben Aoun"},{id:7,name:"Menzel Bouzaiane"},{id:8,name:"Meknassy"},{id:9,name:"Souk Jedid"},{id:10,name:"Mezzouna"},{id:11,name:"Regueb"},{id:12,name:"Ouled Haffouz"}]},{id:19,name:"Gabes",delegations:[{id:1,name:"Gabes Ville"},{id:2,name:"Gabes Ouest"},{id:3,name:"Gabes Sud"},{id:4,name:"Ghannouch"},{id:5,name:"Metouia"},{id:6,name:"Menzel El Habib"},{id:7,name:"El Hamma"},{id:8,name:"Matmata"},{id:9,name:"Nouvelle Matmata"},{id:10,name:"Mareth"}]},{id:20,name:"Medenine",delegations:[{id:1,name:"Medenine Nord"},{id:2,name:"Medenine Sud"},{id:3,name:"Beni Khedache"},{id:4,name:"Ben Guerdane"},{id:5,name:"Zarzis"},{id:6,name:"Houmt Souk"},{id:7,name:"Midoun"},{id:8,name:"Ajim"},{id:9,name:"Sidi Makhlouf"}]},{id:21,name:"Tataouine",delegations:[{id:1,name:"Tataouine Nord"},{id:2,name:"Tataouine Sud"},{id:3,name:"Smar"},{id:4,name:"Bir Lahmar"},{id:5,name:"Ghomrassen"},{id:6,name:"Dhehiba"},{id:7,name:"Remada"}]},{id:22,name:"Gafsa",delegations:[{id:1,name:"Gafsa Nord"},{id:2,name:"Gafsa Sud"},{id:3,name:"Sidi Aich"},{id:4,name:"El Ksar"},{id:5,name:"Oum El Araies"},{id:6,name:"Redeyef"},{id:7,name:"Metlaoui"},{id:8,name:"Mdhila"},{id:9,name:"El Guettar"},{id:10,name:"Belkhir"},{id:11,name:"Sned"}]},{id:23,name:"Tozeur",delegations:[{id:1,name:"Tozeur"},{id:2,name:"Degache"},{id:3,name:"Tameghza"},{id:4,name:"Nefta"},{id:5,name:"Hazoua"}]},{id:24,name:"Kebili",delegations:[{id:1,name:"Kebili Nord"},{id:2,name:"Kebili Sud"},{id:3,name:"Souk El Ahad"},{id:4,name:"Douz Nord"},{id:5,name:"Douz Sud"},{id:6,name:"Faouar"}]}],Te=E=>V.find(m=>m.id===E),le=E=>{const m=Te(E);return(m==null?void 0:m.delegations)||[]};function Xe(){const[E]=ke(),m=_e(),{t:i,lang:o,dir:J}=Me(),j=E.get("merchant")||"",h=E.get("bordereau")||"",oe=[{key:"incorrectSize",fr:"Taille incorrecte",ar:"Ù…Ù‚Ø§Ø³ ØºÙŠØ± ØµØ­ÙŠØ­"},{key:"wrongColor",fr:"Couleur non conforme",ar:"Ù„ÙˆÙ† ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚"},{key:"defectiveProduct",fr:"Produit dÃ©fectueux",ar:"Ù…Ù†ØªØ¬ Ù…Ø¹ÙŠØ¨"},{key:"damagedProduct",fr:"Produit endommagÃ©",ar:"Ù…Ù†ØªØ¬ ØªØ§Ù„Ù"},{key:"notAsDescribed",fr:"Ne correspond pas Ã  la description",ar:"Ù„Ø§ ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„ÙˆØµÙ"},{key:"changedMind",fr:"Changement d'avis",ar:"ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø£ÙŠ"},{key:"other",fr:"Autre",ar:"Ø£Ø®Ø±Ù‰"}],[g,$]=s.useState(null),[t,x]=s.useState({clientName:"",clientPhone:"",clientAddress:"",clientGovernorateId:0,clientDelegation:"",clientCountry:"Tunisia",productName:"",reason:""}),[T,X]=s.useState([]),[_,U]=s.useState(null),[b,Z]=s.useState([]),[W,Q]=s.useState(!1),[me,B]=s.useState(!0),[ce,Y]=s.useState(!1),[I,f]=s.useState(""),[ue,he]=s.useState(!1),[R,K]=s.useState(!1),[G,ee]=s.useState(!1),[ge,ae]=s.useState(!1),[A,H]=s.useState(0),[Ie,xe]=s.useState(""),M=s.useRef(null),F=s.useRef(null),P=s.useRef([]),p=s.useRef(null),L=s.useRef(null),v=s.useRef(null),N=s.useRef([]),y=s.useRef(null),z=60;s.useEffect(()=>{console.log("ExchangeForm - merchantId:",j,"bordereauCode:",h),h?be():j?fe():(B(!1),f(i("noMerchantSpecified")))},[j,h]);const be=async()=>{try{const{data:a,error:n}=await u.from("merchant_bordereaux").select("*, merchants(*)").eq("bordereau_code",h).single();if(n||!a){f("Bordereau non trouve"),B(!1);return}if(a.status!=="available"){if(a.exchange_id){const{data:l}=await u.from("exchanges").select("exchange_code").eq("id",a.exchange_id).single();if(l&&l.exchange_code){m(`/client/tracking/${l.exchange_code}`);return}}const{data:r}=await u.from("exchanges").select("exchange_code").eq("bordereau_code",h).maybeSingle();if(r&&r.exchange_code){m(`/client/tracking/${r.exchange_code}`);return}f("Ce bordereau a deja ete utilise"),B(!1);return}$(a.merchants)}catch(a){console.error("Error loading bordereau:",a),f("Erreur lors du chargement du bordereau")}finally{B(!1)}};s.useEffect(()=>{const a=localStorage.getItem("lastClientPhone");a&&ne(a)},[]);const fe=async()=>{console.log("Loading merchant with ID:",j);try{const{data:a,error:n}=await u.from("merchants").select("*").eq("id",j).single();if(console.log("Merchant query result:",{data:a,error:n}),n)throw n;$(a)}catch(a){console.error("Error loading merchant:",a),f(i("merchantNotFound"))}finally{B(!1)}},ne=async a=>{Y(!0);try{const{data:n}=await u.from("exchanges").select("*").eq("client_phone",a).order("created_at",{ascending:!1}).limit(1);if(n&&n.length>0){const r=n[0],l=r.client_governorate_id||0;x({clientName:r.client_name||"",clientPhone:a,clientAddress:r.client_address||"",clientGovernorateId:l,clientDelegation:r.client_delegation||"",clientCountry:r.client_country||"Tunisia",productName:"",reason:""}),l>0&&X(le(l)),he(!0)}}catch(n){console.error("Error loading previous data:",n)}finally{Y(!1)}},pe=async a=>{x({...t,clientPhone:a}),a.length>=8&&ne(a)},je=a=>{x({...t,clientGovernorateId:a,clientDelegation:""}),X(le(a))},ve=async()=>{try{const a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});p.current=a,ee(!0)}catch(a){console.error("Error accessing camera:",a),f(i("cameraAccessError"))}};s.useEffect(()=>{G&&M.current&&p.current&&(M.current.srcObject=p.current,M.current.play().catch(a=>{console.error("Error playing video:",a)}))},[G]);const re=()=>{v.current&&(clearInterval(v.current),v.current=null),y.current&&(clearInterval(y.current),y.current=null),p.current&&(p.current.getTracks().forEach(a=>a.stop()),p.current=null),ee(!1),K(!1),H(0)},ie=()=>{if(!M.current||!L.current)return null;const a=M.current,n=L.current,r=n.getContext("2d");return r?(n.width=a.videoWidth||640,n.height=a.videoHeight||480,r.drawImage(a,0,0,n.width,n.height),n.toDataURL("image/jpeg",.8)):null},Ne=async a=>new Promise(n=>{const r=document.createElement("video");r.src=a,r.muted=!0,r.playsInline=!0;const l=[],d=document.createElement("canvas"),S=d.getContext("2d");r.onloadedmetadata=()=>{const k=r.duration;d.width=r.videoWidth||640,d.height=r.videoHeight||480;const w=[.1,k*.33,k*.66,k-.1].filter(D=>D>0&&D<k);let c=0;const C=()=>{if(c>=w.length){r.remove(),n(l);return}r.currentTime=w[c]};r.onseeked=()=>{if(S){S.drawImage(r,0,0,d.width,d.height);const D=d.toDataURL("image/jpeg",.8);l.push(D)}c++,C()},C()},r.onerror=()=>{n(l)},setTimeout(()=>{l.length===0&&n(N.current)},1e4)}),ye=()=>{if(!p.current)return;P.current=[],N.current=[];const a=new MediaRecorder(p.current,{mimeType:"video/webm"});a.ondataavailable=n=>{n.data.size>0&&P.current.push(n.data)},a.onstop=async()=>{v.current&&(clearInterval(v.current),v.current=null);const n=new Blob(P.current,{type:"video/webm"}),r=new FileReader;r.onloadend=async()=>{const l=r.result;U(l),ae(!0);let d=await Ne(l);if(d.length===0&&N.current.length>0&&(d=N.current),d.length>4){const S=Math.floor(d.length/4);d=[d[0],d[S],d[S*2],d[d.length-1]]}Z(d),ae(!1)},r.readAsDataURL(n),re()},F.current=a,a.start(),K(!0),H(0),xe(""),y.current=setInterval(()=>{H(n=>{const r=n+1;return r>=z&&te(),r})},1e3),setTimeout(()=>{const n=ie();n&&N.current.push(n)},100),v.current=setInterval(()=>{const n=ie();n&&N.current.push(n)},2e3)},te=()=>{y.current&&(clearInterval(y.current),y.current=null),F.current&&R&&(F.current.stop(),K(!1))},se=a=>{const n=Math.floor(a/60),r=a%60;return`${n}:${r.toString().padStart(2,"0")}`},Se=()=>{U(null),Z([]),N.current=[]},we=()=>{const a=Date.now().toString(36).toUpperCase(),n=Math.random().toString(36).substring(2,6).toUpperCase();return`EXC-${a}-${n}`},Ee=async a=>{a.preventDefault(),Q(!0),f("");try{const n=we();let r=null,l=null;const d=V.find(c=>c.id===t.clientGovernorateId),S={exchange_code:n,merchant_id:(g==null?void 0:g.id)||j,client_name:t.clientName,client_phone:t.clientPhone,client_address:t.clientAddress,client_governorate_id:t.clientGovernorateId,client_city:(d==null?void 0:d.name)||"",client_delegation:t.clientDelegation,client_country:t.clientCountry,product_name:t.productName,reason:t.reason,video:_,images:b.length>0?b:null,status:"pending",payment_status:"pending",payment_amount:0,bordereau_code:h||null},k={exchange_code:n,merchant_id:(g==null?void 0:g.id)||j,client_name:t.clientName,client_phone:t.clientPhone,client_address:t.clientAddress,client_city:(d==null?void 0:d.name)||"",client_postal_code:t.clientDelegation,client_country:t.clientCountry,product_name:t.productName,reason:t.reason,video:_,images:b.length>0?b:null,status:"pending",payment_status:"pending",payment_amount:0},w=await u.from("exchanges").insert(S).select().single();if(w.error){const c=w.error.message||"";if(c.includes("client_governorate_id")||c.includes("client_delegation")||c.includes("bordereau_code")){console.log("Using fallback insert without new columns");const C=await u.from("exchanges").insert(k).select().single();r=C.data,l=C.error}else l=w.error}else r=w.data;if(l)throw l;await u.from("status_history").insert({exchange_id:r.id,status:"pending"}),h&&await u.from("merchant_bordereaux").update({status:"assigned",exchange_id:r.id,assigned_at:new Date().toISOString()}).eq("bordereau_code",h),localStorage.setItem("lastClientPhone",t.clientPhone),m(`/client/success/${n}`)}catch(n){console.error("Error submitting exchange:",n),f(i("submissionError"))}finally{Q(!1)}};return me?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600"})}):g?e.jsx("div",{className:"min-h-screen bg-slate-50",dir:J,children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>m("/client/scan"),className:"flex items-center text-slate-600 hover:text-slate-900 transition-colors",children:[e.jsx(Be,{className:"w-5 h-5 me-2"}),e.jsx("span",{className:"font-medium",children:i("back")})]}),e.jsx(de,{})]}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:i("exchangeRequest")}),e.jsx("p",{className:"text-slate-600",children:i("fillFormToSubmit")})]}),e.jsx("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-900",children:g.name}),e.jsx("p",{className:"text-sm text-purple-600",children:i("merchant")})]})]})}),ue&&e.jsxs("div",{className:"mb-6 bg-emerald-50 border border-emerald-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:i("infoFound")})]}),e.jsx("p",{className:"text-sm text-emerald-600 mt-1",children:i("infoFoundDescription")})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[I&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:I}),e.jsxs("form",{onSubmit:Ee,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:i("yourInformation")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[i("fullName")," *"]}),e.jsx("input",{type:"text",required:!0,value:t.clientName,onChange:a=>x({...t,clientName:a.target.value}),placeholder:i("yourName"),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[i("phone")," *"]}),e.jsx("input",{type:"tel",required:!0,value:t.clientPhone,onChange:a=>pe(a.target.value),placeholder:"+216 XX XXX XXX",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",dir:"ltr"}),ce&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:i("searchingInfo")})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Re,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:i("deliveryAddress")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[i("address")," *"]}),e.jsx("input",{type:"text",required:!0,value:t.clientAddress,onChange:a=>x({...t,clientAddress:a.target.value}),placeholder:i("streetNumber"),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[o==="ar"?"Ø§Ù„ÙˆÙ„Ø§ÙŠØ©":"Gouvernorat"," *"]}),e.jsxs("select",{required:!0,value:t.clientGovernorateId,onChange:a=>je(parseInt(a.target.value)),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:0,children:o==="ar"?"Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©":"SÃ©lectionner le gouvernorat"}),V.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[o==="ar"?"Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠØ©":"DÃ©lÃ©gation"," *"]}),e.jsxs("select",{required:!0,value:t.clientDelegation,onChange:a=>x({...t,clientDelegation:a.target.value}),disabled:T.length===0,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 disabled:bg-slate-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:T.length===0?o==="ar"?"Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹":"SÃ©lectionner d'abord le gouvernorat":o==="ar"?"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠØ©":"SÃ©lectionner la dÃ©lÃ©gation"}),T.map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[i("country")," *"]}),e.jsx("input",{type:"text",required:!0,readOnly:!0,value:t.clientCountry,className:"w-full px-4 py-3 border border-slate-300 rounded-lg bg-slate-50 cursor-not-allowed"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:i("productDetails")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[i("productName")," *"]}),e.jsx("input",{type:"text",required:!0,value:t.productName,onChange:a=>x({...t,productName:a.target.value}),placeholder:i("productNamePlaceholder"),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[i("exchangeReason")," *"]}),e.jsxs("select",{required:!0,value:t.reason,onChange:a=>x({...t,reason:a.target.value}),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"",children:i("selectReason")}),oe.map(a=>e.jsx("option",{value:a.fr,children:o==="ar"?a.ar:a.fr},a.key))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[i("productVideo")," *"]}),e.jsx("p",{className:"text-xs text-slate-600 mb-3",children:i("videoDescription")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("canvas",{ref:L,className:"hidden"}),G?e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:M,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-64 object-cover rounded-lg border border-slate-200 bg-black"}),R&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2 bg-red-600 text-white px-3 py-1.5 rounded-full shadow-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsxs("span",{className:"font-mono font-bold",children:[se(A)," /"," ",se(z)]})]}),R&&A>=50&&e.jsx("div",{className:"absolute top-3 right-3 bg-amber-500 text-white px-3 py-1.5 rounded-full text-sm shadow-lg",children:o==="ar"?`${z-A} Ø«Ø§Ù†ÙŠØ© Ù…ØªØ¨Ù‚ÙŠØ©`:`${z-A}s restantes`}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-4",children:[R?e.jsxs("button",{type:"button",onClick:te,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors shadow-lg animate-pulse",children:[e.jsx(De,{className:"w-5 h-5"}),i("stop")]}):e.jsxs("button",{type:"button",onClick:ye,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg",children:[e.jsx(q,{className:"w-5 h-5"}),i("record")]}),e.jsxs("button",{type:"button",onClick:re,className:"flex items-center gap-2 px-4 py-2 bg-slate-500 text-white rounded-full hover:bg-slate-600 transition-colors shadow-lg",children:[e.jsx(ze,{className:"w-5 h-5"}),i("cancel")]})]})]}):_?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("video",{src:_,controls:!0,className:"w-full h-64 object-cover rounded-lg border border-slate-200"}),e.jsx("div",{className:"absolute top-2 right-2 flex gap-2",children:e.jsxs("button",{type:"button",onClick:Se,className:"flex items-center gap-1 px-3 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors shadow-lg text-sm",children:[e.jsx(q,{className:"w-4 h-4"}),o==="ar"?"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„":"RÃ©-enregistrer"]})})]}),e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-emerald-800",children:o==="ar"?"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!":"VidÃ©o enregistrÃ©e avec succÃ¨s !"}),e.jsx("p",{className:"text-xs text-emerald-600 mt-0.5",children:o==="ar"?"Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£ØªØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØªØ³Ø¬ÙŠÙ„Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰":"Si vous avez fait une erreur, vous pouvez supprimer et rÃ©-enregistrer"})]})]}),ge?e.jsxs("div",{className:"flex items-center justify-center p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-emerald-600 mr-3"}),e.jsx("span",{className:"text-sm text-slate-600",children:o==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ±...":"Extraction des images..."})]}):b.length>0?e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(O,{className:"w-5 h-5 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-emerald-700",children:o==="ar"?`ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${b.length} ØµÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`:`${b.length} images extraites automatiquement`})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:b.map((a,n)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:a,alt:`Frame ${n+1}`,className:"w-full h-full object-cover rounded-lg border border-emerald-300"}),e.jsx("span",{className:"absolute bottom-1 right-1 bg-black/50 text-white text-xs px-1.5 py-0.5 rounded",children:n+1})]},n))})]}):null]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:ve,className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-300 rounded-lg cursor-pointer hover:border-emerald-500 transition-colors",children:[e.jsx(q,{className:"w-8 h-8 text-slate-400 mb-2"}),e.jsx("span",{className:"text-sm text-slate-500",children:i("clickToRecord")})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium mb-1",children:o==="ar"?"ðŸ“¹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„:":"ðŸ“¹ Instructions d'enregistrement :"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsxs("li",{children:["â€¢"," ",o==="ar"?"Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ØªØ³Ø¬ÙŠÙ„: Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© (60 Ø«Ø§Ù†ÙŠØ©)":"DurÃ©e maximale : 1 minute (60 secondes)"]}),e.jsxs("li",{children:["â€¢"," ",o==="ar"?"Ø£Ø¸Ù‡Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¨ÙˆØ¶ÙˆØ­ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙˆØ§ÙŠØ§":"Montrez clairement le produit sous tous les angles"]}),e.jsxs("li",{children:["â€¢"," ",o==="ar"?"ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£Øª":"Vous pouvez rÃ©-enregistrer en cas d'erreur"]})]})]})]})]})]})]})]}),e.jsx("button",{type:"submit",disabled:W||!_,className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-colors shadow-sm",children:i(W?"submitting":"submitRequest")})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-slate-50",dir:J,children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx(de,{})}),e.jsx("div",{className:"max-w-md mx-auto text-center",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6",children:[e.jsx("p",{className:"text-red-700 mb-4",children:I||i("merchantNotFound")}),e.jsx("button",{onClick:()=>m("/client/scan"),className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:i("scanQRCode")})]})})]})})}export{Xe as default};
