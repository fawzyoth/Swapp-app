import{s as i,j as e,S as D,D as q,a as V}from"./index-C-n_DeK3.js";import{h as ce,u as de,r as a}from"./react-vendor-CTUriZ5h.js";import{D as I}from"./DeliveryLayout-D4qX3PG1.js";import{I as X,c as U}from"./smsService-qtIlF6gc.js";import{A as oe}from"./arrow-left-CxjwE-xR.js";import{U as me}from"./user-DEx4Ce9L.js";import{P as L}from"./phone-BNQXnIac.js";import{P as T}from"./package-ChDCFdB3.js";import{M as B}from"./map-pin-DUtVdt2Q.js";import{H as xe}from"./home-9mW_oZwz.js";import{V as he}from"./video-Cwp6uQ4V.js";import{C as ue}from"./clock-Dhxn45-3.js";import{C as S}from"./check-circle-CyNeZd0p.js";import{X as O}from"./x-circle-D3f66Y07.js";import{T as be}from"./trending-up-9gPHMyOx.js";import{B as H}from"./banknote-JI0QWWz-.js";import{C as pe}from"./credit-card-D2z2xSBY.js";import{S as fe}from"./smartphone-B93dNxcm.js";import{P as ge}from"./play-rTm69v02.js";import{c as je}from"./createLucideIcon-CMjKDoEE.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./menu-DP2azNEK.js";import"./truck-CgEV9F53.js";import"./layout-dashboard-CqNl1jWq.js";import"./scan-line-Dhzz-_Ia.js";import"./wallet-CVOcG8S4.js";import"./log-out-BX30H4-p.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=je("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);function Ne({src:c,alt:d,className:s,onClick:N}){const[o,h]=a.useState(!1),[v,P]=a.useState(!1),u=a.useRef(null);return a.useEffect(()=>{const b=new IntersectionObserver(R=>{R.forEach(y=>{y.isIntersecting&&u.current&&(u.current.src=c,b.disconnect())})},{rootMargin:"100px"});return u.current&&b.observe(u.current),()=>b.disconnect()},[c]),v?e.jsx("div",{className:`${s} bg-slate-100 flex items-center justify-center`,children:e.jsx(G,{className:"w-8 h-8 text-slate-400"})}):e.jsxs("div",{className:"relative",children:[!o&&e.jsx("div",{className:`${s} bg-slate-100 animate-pulse flex items-center justify-center absolute inset-0`,children:e.jsx(G,{className:"w-8 h-8 text-slate-300"})}),e.jsx("img",{ref:u,alt:d,className:`${s} ${o?"opacity-100":"opacity-0"} transition-opacity duration-300`,onLoad:()=>h(!0),onError:()=>P(!0),onClick:N})]})}function ve({src:c,className:d}){const[s,N]=a.useState(!1),[o,h]=a.useState(!1),v=()=>{h(!0),N(!0)};return s?e.jsxs("div",{className:"relative",children:[o&&e.jsx("div",{className:`${d} bg-slate-900 flex items-center justify-center absolute inset-0 z-10`,children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500"})}),e.jsx("video",{src:c,controls:!0,autoPlay:!0,className:d,onLoadedData:()=>h(!1),onCanPlay:()=>h(!1)})]}):e.jsxs("div",{className:`${d} bg-slate-900 flex items-center justify-center cursor-pointer relative group`,onClick:v,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-white/90 rounded-full flex items-center justify-center group-hover:bg-white transition-colors shadow-lg",children:e.jsx(ge,{className:"w-8 h-8 text-amber-600 ml-1"})}),e.jsx("span",{className:"text-white font-medium text-sm",children:"Cliquez pour charger la vidéo"})]})]})}function Ze(){const{code:c}=ce(),d=de(),[s,N]=a.useState(null),[o,h]=a.useState([]),[v,P]=a.useState(!0),[u,b]=a.useState(!1),[R,y]=a.useState(!1),[W,Y]=a.useState(!1),[l,Z]=a.useState(null),[$,J]=a.useState(""),[z,K]=a.useState(""),[f,E]=a.useState(!1),[m,Q]=a.useState(!1),[w,ee]=a.useState(""),[_,k]=a.useState("cash"),[M,se]=a.useState(""),[g,A]=a.useState("accepted"),[F,te]=a.useState("");a.useEffect(()=>{c&&ae()},[c]);const ae=async()=>{try{const t=c==null?void 0:c.trim().toUpperCase();console.log("Fetching exchange with code:",t);const{data:r,error:p}=await i.from("exchanges").select("*").eq("exchange_code",t).maybeSingle();if(p)throw console.error("Supabase error:",p),p;if(console.log("Exchange data received:",r),r){if(N(r),r.merchant_id){const{data:C}=await i.from("merchants").select("*").eq("id",r.merchant_id).maybeSingle();C&&Z(C)}const{data:j}=await i.from("exchanges").select("*").eq("client_phone",r.client_phone).neq("id",r.id).order("created_at",{ascending:!1}).limit(5);h(j||[])}}catch(t){console.error("Error fetching exchange:",t)}finally{P(!1)}},re=()=>{y(!0)},le=()=>{const t=Date.now().toString(36).toUpperCase();return`BAG-${(s==null?void 0:s.exchange_code)||"EXC"}-${t}`},ne=async()=>{if(!$.trim()){alert("Veuillez fournir une raison pour le refus");return}E(!0);try{const{data:{user:t}}=await i.auth.getUser();if(!t)throw new Error("Non authentifié");await i.from("exchanges").update({status:"delivery_rejected",updated_at:new Date().toISOString()}).eq("id",s.id),await i.from("delivery_verifications").insert({exchange_id:s.id,delivery_person_id:t.id,status:"rejected",rejection_reason:$}),await i.from("status_history").insert({exchange_id:s.id,status:"delivery_rejected"}),await U(s.client_phone,s.client_name,s.exchange_code,"delivery_rejected",D.delivery_rejected),b(!1),d("/delivery/dashboard")}catch(t){console.error("Error rejecting exchange:",t),alert("Erreur lors du refus de l'échange")}finally{E(!1)}},ie=async()=>{const t=m?parseFloat(w):0;if(m&&(isNaN(t)||t<=0)){alert("Veuillez entrer un montant valide");return}E(!0);try{const{data:{user:r}}=await i.auth.getUser();if(!r)throw new Error("Non authentifié");const p=le(),j=m&&t>0?"completed":"delivery_verified",{error:C}=await i.from("exchanges").update({status:j,bag_id:p,return_product_status:g,return_product_notes:F||null,delivery_person_id:r.id,completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",s.id);if(C)throw console.error("Error updating exchange:",C),new Error("Erreur lors de la mise à jour de l'échange");m&&t>0&&await i.from("exchanges").update({amount_collected:t,collection_date:new Date().toISOString(),collected_by:r.id,settlement_status:"pending_settlement"}).eq("id",s.id).then(({error:x})=>{x&&console.warn("Financial columns not available:",x.message)}),await i.from("delivery_verifications").insert({exchange_id:s.id,delivery_person_id:r.id,status:"accepted",bag_id:p,payment_collected:m,amount_collected:t,payment_method:m?_:null,collection_notes:M||null}).then(({error:x})=>{x&&console.warn("delivery_verifications table not available:",x.message)}),m&&t>0&&await i.from("financial_transactions").insert({exchange_id:s.id,delivery_person_id:r.id,merchant_id:s.merchant_id,transaction_type:"collection_from_client",amount:t,currency:"TND",direction:"credit",status:"completed",description:`Encaissement client - ${s.exchange_code}`,created_by:r.id}).then(({error:x})=>{x&&console.warn("financial_transactions table not available:",x.message)}),await i.from("status_history").insert({exchange_id:s.id,status:j}),await U(s.client_phone,s.client_name,s.exchange_code,j,D[j]),K(p),y(!1),Y(!0)}catch(r){console.error("Error accepting exchange:",r),alert("Erreur lors de l'acceptation de l'échange")}finally{E(!1)}};if(v)return e.jsx(I,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})})});if(!s)return e.jsx(I,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Échange non trouvé"}),e.jsxs("p",{className:"text-slate-600 mb-4",children:['Le code "',c,`" n'existe pas.`]}),e.jsx("button",{onClick:()=>d("/delivery/scan"),className:"px-6 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700",children:"Retour au scanner"})]})})});const n={total:o.length,validated:o.filter(t=>t.status==="validated"||t.status==="completed"||t.status==="delivery_verified").length,rejected:o.filter(t=>t.status==="rejected"||t.status==="delivery_rejected").length};return e.jsx(I,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>d("/delivery/scan"),className:"flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors mb-6",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Retour au scanner"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-1",children:s.exchange_code}),e.jsxs("p",{className:"text-slate-600",children:["Créé le"," ",new Date(s.created_at).toLocaleDateString("fr-FR")]})]}),e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-medium ${s.status==="validated"?"bg-emerald-100 text-emerald-800 border border-emerald-200":s.status==="in_transit"?"bg-blue-100 text-blue-800 border border-blue-200":"bg-amber-100 text-amber-800 border border-amber-200"}`,children:D[s.status]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(me,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"Client"})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Nom:"}),e.jsx("p",{className:"font-medium text-slate-900",children:s.client_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Téléphone:"}),e.jsx("p",{className:"font-medium text-slate-900",children:e.jsxs("a",{href:`tel:${s.client_phone}`,className:"text-amber-600 hover:text-amber-700 flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4"}),s.client_phone]})})]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(T,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"Produit"})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Nom:"}),e.jsx("p",{className:"font-medium text-slate-900",children:s.product_name||"Non spécifié"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Raison d'échange:"}),e.jsx("p",{className:"font-medium text-slate-900",children:s.reason})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-5 border border-amber-200 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"w-5 h-5 text-amber-700"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"Adresse de livraison"})]}),e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.client_address||"Non fournie"}),e.jsx("p",{className:"text-slate-700",children:s.client_city&&s.client_postal_code?`${s.client_city} ${s.client_postal_code}, ${s.client_country||"Tunisia"}`:"Informations incomplètes"})]})]})})]}),s.video&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"Vidéo de référence"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]})]}),e.jsx("div",{className:"bg-black rounded-lg overflow-hidden",children:e.jsx(ve,{src:s.video,className:"w-full max-h-96"})}),e.jsxs("p",{className:"text-sm text-amber-700 mt-2 bg-amber-50 p-3 rounded-lg border border-amber-200",children:[e.jsx("strong",{children:"Important:"})," Comparez le produit présenté par le client avec cette vidéo de référence avant d'accepter l'échange."]})]}),s.photos&&s.photos.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 mb-4",children:["Photos du produit (",s.photos.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:s.photos.map((t,r)=>e.jsx(Ne,{src:t,alt:`Photo ${r+1}`,className:"w-full h-40 object-cover rounded-lg border border-slate-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(t,"_blank")},r))})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t border-slate-200",children:[e.jsxs("button",{onClick:re,className:"flex-1 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Accepter l'échange"]}),e.jsxs("button",{onClick:()=>b(!0),className:"flex-1 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Refuser l'échange"]})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(be,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"Historique du client"})]}),o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Premier échange de ce client"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-200",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:n.total}),e.jsx("div",{className:"text-xs text-slate-600",children:"Échanges"})]}),e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-3 border border-emerald-200",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-700",children:n.validated}),e.jsx("div",{className:"text-xs text-emerald-700",children:"Validés"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 border border-red-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-700",children:n.rejected}),e.jsx("div",{className:"text-xs text-red-700",children:"Refusés"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Derniers échanges"}),o.slice(0,3).map(t=>e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-200 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-mono text-xs text-slate-600",children:t.exchange_code}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t.status==="validated"||t.status==="completed"||t.status==="delivery_verified"?"bg-emerald-100 text-emerald-700":t.status==="rejected"||t.status==="delivery_rejected"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:D[t.status]})]}),e.jsx("p",{className:"text-xs text-slate-600 truncate",children:t.reason}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:new Date(t.created_at).toLocaleDateString("fr-FR")})]},t.id))]}),n.total>0&&e.jsx("div",{className:`rounded-lg p-3 border ${n.validated/n.total>=.7?"bg-emerald-50 border-emerald-200":n.validated/n.total>=.4?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:`w-4 h-4 ${n.validated/n.total>=.7?"text-emerald-600":n.validated/n.total>=.4?"text-amber-600":"text-red-600"}`}),e.jsxs("span",{className:"text-sm font-medium",children:["Taux de validation:"," ",Math.round(n.validated/n.total*100),"%"]})]})})]})]})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-lg w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Refuser l'échange"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Veuillez expliquer pourquoi vous refusez cet échange"}),e.jsx("textarea",{value:$,onChange:t=>J(t.target.value),placeholder:"Ex: Le produit ne correspond pas à la vidéo de référence...",rows:4,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>b(!1),disabled:f,className:"flex-1 px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition-colors",children:"Annuler"}),e.jsx("button",{onClick:ne,disabled:f,className:"flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors",children:f?"Traitement...":"Confirmer le refus"})]})]})})}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-emerald-100 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"Confirmer l'acceptation"}),e.jsx("p",{className:"text-slate-600 text-sm",children:"Confirmez l'échange et indiquez si un paiement a été encaissé"})]})]}),e.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Code échange:"}),e.jsx("span",{className:"font-mono font-medium text-slate-900",children:s==null?void 0:s.exchange_code})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Client:"}),e.jsx("span",{className:"font-medium text-slate-900",children:s==null?void 0:s.client_name})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(T,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"Verification du produit retourne"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Verifiez l'etat du produit que le client retourne"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>A("accepted"),className:`flex flex-col items-center justify-center gap-2 px-4 py-4 rounded-lg border-2 transition-colors ${g==="accepted"?"border-emerald-500 bg-emerald-100 text-emerald-800":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"}`,children:[e.jsx(S,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:"Accepte"})]}),e.jsxs("button",{type:"button",onClick:()=>A("problem"),className:`flex flex-col items-center justify-center gap-2 px-4 py-4 rounded-lg border-2 transition-colors ${g==="problem"?"border-orange-500 bg-orange-100 text-orange-800":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"}`,children:[e.jsx(X,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:"Probleme"})]}),e.jsxs("button",{type:"button",onClick:()=>A("rejected"),className:`flex flex-col items-center justify-center gap-2 px-4 py-4 rounded-lg border-2 transition-colors ${g==="rejected"?"border-red-500 bg-red-100 text-red-800":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"}`,children:[e.jsx(O,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:"Refuse"})]})]}),(g==="problem"||g==="rejected")&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notes sur le produit retourne *"}),e.jsx("textarea",{value:F,onChange:t=>te(t.target.value),placeholder:"Decrivez le probleme ou la raison du refus...",rows:2,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(H,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"Encaissement"}),e.jsx("p",{className:"text-sm text-slate-600",children:(s==null?void 0:s.payment_amount)>0?`Montant attendu: ${s.payment_amount.toFixed(2)} TND`:"Indiquez si vous avez encaisse un paiement"})]})]}),e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:t=>Q(t.target.checked),className:"w-5 h-5 rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Paiement encaissé"})]})}),m&&e.jsxs("div",{className:"space-y-4 bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Montant encaissé (TND)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:w,onChange:t=>ee(t.target.value),placeholder:"0.00",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 font-mono text-lg"})]}),w&&parseFloat(w)>0&&e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-slate-600 mb-2",children:"Répartition du montant:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Frais plateforme:"}),e.jsxs("span",{className:"text-red-600",children:["-",(l==null?void 0:l.platform_fee)??q," ","TND"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Frais livraison:"}),e.jsxs("span",{className:"text-red-600",children:["-",(l==null?void 0:l.delivery_fee)??V," ","TND"]})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t border-slate-200",children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Pour le marchand:"}),e.jsxs("span",{className:"font-bold text-emerald-600",children:[Math.max(0,parseFloat(w)-((l==null?void 0:l.platform_fee)??q)-((l==null?void 0:l.delivery_fee)??V)).toFixed(2)," ","TND"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mode de paiement"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>k("cash"),className:`flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 transition-colors ${_==="cash"?"border-amber-500 bg-amber-100 text-amber-800":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"}`,children:[e.jsx(H,{className:"w-5 h-5"}),"Espèces"]}),e.jsxs("button",{type:"button",onClick:()=>k("card"),className:`flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 transition-colors ${_==="card"?"border-amber-500 bg-amber-100 text-amber-800":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"}`,children:[e.jsx(pe,{className:"w-5 h-5"}),"Carte"]}),e.jsxs("button",{type:"button",onClick:()=>k("mobile_payment"),className:`flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 transition-colors ${_==="mobile_payment"?"border-amber-500 bg-amber-100 text-amber-800":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"}`,children:[e.jsx(fe,{className:"w-5 h-5"}),"Mobile"]}),e.jsx("button",{type:"button",onClick:()=>k("other"),className:`flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 transition-colors ${_==="other"?"border-amber-500 bg-amber-100 text-amber-800":"border-slate-200 bg-white text-slate-700 hover:border-slate-300"}`,children:"Autre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notes (optionnel)"}),e.jsx("input",{type:"text",value:M,onChange:t=>se(t.target.value),placeholder:"Ex: Reçu numéro...",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>y(!1),disabled:f,className:"flex-1 px-6 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition-colors",children:"Annuler"}),e.jsx("button",{onClick:ie,disabled:f,className:"flex-1 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors",children:f?"Traitement...":"Confirmer l'acceptation"})]})]})})}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-lg w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4",children:e.jsx(S,{className:"w-8 h-8 text-emerald-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Échange Accepté"}),e.jsx("p",{className:"text-slate-600",children:"Le retour a été assigné au sac de collecte"})]}),e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"w-5 h-5 text-emerald-600"}),e.jsx("span",{className:"font-semibold text-emerald-900",children:"Sac assigné"})]}),e.jsx("p",{className:"font-mono text-lg text-emerald-800",children:z})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(B,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"font-semibold text-amber-900",children:"Adresse de retour E-Commerçant"})]}),l?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-slate-900",children:l.name}),e.jsx("p",{className:"text-slate-700",children:l.address||"123 Rue du Commerce"}),e.jsxs("p",{className:"text-slate-700",children:[l.city||"Tunis"," ",l.postal_code||"1000"]}),e.jsxs("p",{className:"text-slate-600 flex items-center gap-1 mt-2",children:[e.jsx(L,{className:"w-4 h-4"}),l.phone||"+216 XX XXX XXX"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-slate-900",children:"SWAPP E-Commerce"}),e.jsx("p",{className:"text-slate-700",children:"Zone Industrielle, Rue de l'Innovation"}),e.jsx("p",{className:"text-slate-700",children:"Tunis 1000, Tunisia"}),e.jsxs("p",{className:"text-slate-600 flex items-center gap-1 mt-2",children:[e.jsx(L,{className:"w-4 h-4"}),"+216 71 234 567"]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Instructions:"})," Déposez le sac"," ",e.jsx("span",{className:"font-mono",children:z})," à l'adresse indiquée ci-dessus pour retourner l'article au e-commerçant."]})}),e.jsx("button",{onClick:()=>d("/delivery/dashboard"),className:"w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",children:"Terminer"})]})})})]})})}export{Ze as default};
