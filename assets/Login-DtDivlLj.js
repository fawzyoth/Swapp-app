import{j as e,s as t}from"./index-DZYJF6_c.js";import{u as I,r as a}from"./react-vendor-CTUriZ5h.js";import{A as y}from"./arrow-left-CxjwE-xR.js";import{c as O}from"./createLucideIcon-CMjKDoEE.js";import"./supabase-Bl4YWSQ9.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=O("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);function k(){const o=I(),[n,N]=a.useState(""),[c,p]=a.useState(""),[d,m]=a.useState(!1),[u,g]=a.useState(""),f=async r=>{r.preventDefault(),m(!0),g(""),console.log("[LOGIN] Starting login process..."),console.log("[LOGIN] Email:",n.trim().toLowerCase());try{console.log("[LOGIN] Calling supabase.auth.signInWithPassword...");const{data:s,error:l}=await t.auth.signInWithPassword({email:n.trim().toLowerCase(),password:c});if(console.log("[LOGIN] Supabase auth response:"),console.log("[LOGIN] - data:",s),console.log("[LOGIN] - error:",l),console.log("[LOGIN] - data.user:",s==null?void 0:s.user),console.log("[LOGIN] - data.session:",s==null?void 0:s.session),l)throw console.error("[LOGIN] Auth error:",l),l;if(s.user){const i=s.user.email;console.log("[LOGIN] User authenticated successfully!"),console.log("[LOGIN] User ID:",s.user.id),console.log("[LOGIN] User email:",i),console.log("[LOGIN] Checking if user is a merchant...");const{data:h,error:L}=await t.from("merchants").select("id").eq("email",i).maybeSingle();if(console.log("[LOGIN] Merchant query result:"),console.log("[LOGIN] - merchant:",h),console.log("[LOGIN] - merchantError:",L),h){console.log("[LOGIN] User is a MERCHANT! Redirecting to /merchant/dashboard..."),console.log("[LOGIN] navigate function:",o),console.log("[LOGIN] Calling navigate now..."),o("/merchant/dashboard",{replace:!0}),console.log("[LOGIN] navigate() called, should have redirected");return}console.log("[LOGIN] User is not a merchant. Checking if delivery person...");const{data:x,error:v}=await t.from("delivery_persons").select("id").eq("email",i).maybeSingle();if(console.log("[LOGIN] Delivery person query result:"),console.log("[LOGIN] - deliveryPerson:",x),console.log("[LOGIN] - deliveryError:",v),x){console.log("[LOGIN] User is a DELIVERY PERSON! Redirecting to /delivery/dashboard..."),o("/delivery/dashboard",{replace:!0}),console.log("[LOGIN] navigate() called, should have redirected");return}throw console.log("[LOGIN] User not found in merchants or delivery_persons tables!"),console.log("[LOGIN] Signing out user..."),await t.auth.signOut(),new Error("Compte non trouvé. Contactez l'administrateur.")}else console.log("[LOGIN] No user in response data")}catch(s){console.error("[LOGIN] Caught error:",s),console.error("[LOGIN] Error message:",s.message),g(s.message||"Erreur de connexion")}finally{console.log("[LOGIN] Login process finished. Loading:",!1),m(!1)}},b=()=>{o("/")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-white to-sky-50 flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md px-4",children:[e.jsxs("button",{onClick:b,className:"flex items-center text-slate-600 hover:text-slate-900 mb-6",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"Retour à l'accueil"]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-emerald-100 rounded-full mb-4",children:e.jsx(G,{className:"w-10 h-10 text-emerald-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Connexion"}),e.jsx("p",{className:"text-slate-600",children:"Accédez à votre espace SWAPP"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[u&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm",children:u}),e.jsxs("form",{onSubmit:f,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:n,onChange:r=>N(r.target.value),placeholder:"votre@email.com",className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mot de passe"}),e.jsx("input",{type:"password",required:!0,value:c,onChange:r=>p(r.target.value),placeholder:"••••••••",className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"})]}),e.jsx("button",{type:"submit",disabled:d,className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 text-white rounded-xl font-semibold text-lg transition-colors",children:d?"Connexion en cours...":"Se connecter"})]})]}),e.jsx("p",{className:"text-center text-slate-500 text-sm mt-6",children:"Vous serez redirigé automatiquement vers votre espace"})]})})}export{k as default};
