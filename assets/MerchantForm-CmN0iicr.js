import{c as y,u as E,r as d,s as n,j as e}from"./index-rDBYtsKc.js";import{A as b}from"./AdminLayout-DIXkkuv7.js";import{A as q}from"./arrow-left-vJPITjot.js";import{S as C}from"./store-DDz9l529.js";import{S}from"./save-C394mS3i.js";import"./x-C0vRYFto.js";import"./createLucideIcon-D4GF9uxc.js";import"./menu-_Um9a96Y.js";import"./shield-HSYj089_.js";import"./layout-dashboard-DN8t5OBl.js";import"./users-D0D_q4qa.js";import"./truck-tnZmE0RT.js";import"./banknote-Df89TtRt.js";import"./wallet-CsyVQ_oH.js";import"./file-text-Zdsfn5PS.js";import"./clock-BOTOyW2g.js";import"./home-LI61lqQD.js";function W(){const{id:o}=y(),m=E(),t=!!o,[r,i]=d.useState({name:"",email:"",phone:"",password:""}),[p,u]=d.useState(!1),[g,j]=d.useState(t),[h,l]=d.useState("");d.useEffect(()=>{t&&v()},[o]);const v=async()=>{try{const{data:a,error:s}=await n.from("merchants").select("*").eq("id",o).single();if(s)throw s;a&&i({name:a.name||"",email:a.email||"",phone:a.phone||""})}catch(a){console.error("Error fetching merchant:",a),l("Erreur lors du chargement des données")}finally{j(!1)}},w=async a=>{a.preventDefault(),u(!0),l("");try{if(t){const{error:s}=await n.from("merchants").update({name:r.name,email:r.email,phone:r.phone}).eq("id",o);if(s)throw s;m(`/admin/merchant/${o}`)}else{if(!r.password||r.password.length<6){l("Le mot de passe doit contenir au moins 6 caractères"),u(!1);return}const{data:s}=await n.from("delivery_persons").select("id").eq("email",r.email).maybeSingle();if(s)throw new Error("Cet email est déjà utilisé par un compte livreur. Veuillez utiliser un autre email.");const{data:c,error:x}=await n.from("merchants").insert({name:r.name,email:r.email,phone:r.phone}).select().single();if(x)throw x;const{error:f}=await n.auth.signUp({email:r.email,password:r.password,options:{emailRedirectTo:void 0,data:{merchant_id:c.id,name:r.name}}});f&&console.warn("Auth user creation failed:",f);const N=`SWAPP-${c.id.slice(0,8).toUpperCase()}`;await n.from("merchants").update({qr_code_data:N}).eq("id",c.id),m(`/admin/merchant/${c.id}`)}}catch(s){console.error("Error saving merchant:",s),s.code==="23505"?l("Un e-commerçant avec cet email existe déjà"):s.code==="42703"?l("Erreur de base de données: colonne manquante. Veuillez ajouter la colonne qr_code_data."):s.message?l(`Erreur: ${s.message}`):l("Erreur lors de la sauvegarde")}finally{u(!1)}};return g?e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})})}):e.jsx(b,{children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>m(t?`/admin/merchant/${o}`:"/admin/merchants"),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:t?"Modifier l'e-commerçant":"Nouvel e-commerçant"}),e.jsx("p",{className:"text-slate-600",children:t?"Modifiez les informations du compte":"Créez un nouveau compte e-commerçant"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[h&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:h}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-6 border-b border-slate-200",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(C,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Informations du compte"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Renseignez les informations de l'e-commerçant"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nom de l'entreprise *"}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:a=>i({...r,name:a.target.value}),placeholder:"Ex: Ma Boutique",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:r.email,onChange:a=>i({...r,email:a.target.value}),placeholder:"contact@maboutique.com",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Téléphone"}),e.jsx("input",{type:"tel",value:r.phone,onChange:a=>i({...r,phone:a.target.value}),placeholder:"+216 XX XXX XXX",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),!t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mot de passe *"}),e.jsx("input",{type:"password",required:!t,value:r.password,onChange:a=>i({...r,password:a.target.value}),placeholder:"Minimum 6 caractères",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Ce mot de passe sera utilisé pour la connexion à l'espace e-commerçant"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(t?`/admin/merchant/${o}`:"/admin/merchants"),className:"flex-1 px-4 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:p,className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-purple-300 transition-colors",children:p?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5"}),t?"Enregistrer":"Créer"]})})]})]})]})]})})}export{W as default};
