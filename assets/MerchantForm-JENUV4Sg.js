import{s as i,j as e}from"./index-CYPRHEJa.js";import{h as N,u as y,r as d}from"./react-vendor-CTUriZ5h.js";import{A as f}from"./AdminLayout-BvyY5otR.js";import{A as E}from"./arrow-left-CxjwE-xR.js";import{S as q}from"./store-B-5iV_wL.js";import{S as C}from"./save-DeLrZxpc.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./shield-BNgLrtrc.js";import"./layout-dashboard-CqNl1jWq.js";import"./users-4zMWxYqH.js";import"./truck-CgEV9F53.js";import"./home-9mW_oZwz.js";function T(){const{id:o}=N(),m=y(),t=!!o,[r,n]=d.useState({name:"",email:"",phone:"",password:""}),[u,c]=d.useState(!1),[b,g]=d.useState(t),[p,l]=d.useState("");d.useEffect(()=>{t&&j()},[o]);const j=async()=>{try{const{data:s,error:a}=await i.from("merchants").select("*").eq("id",o).single();if(a)throw a;s&&n({name:s.name||"",email:s.email||"",phone:s.phone||""})}catch(s){console.error("Error fetching merchant:",s),l("Erreur lors du chargement des données")}finally{g(!1)}},v=async s=>{s.preventDefault(),c(!0),l("");try{if(t){const{error:a}=await i.from("merchants").update({name:r.name,email:r.email,phone:r.phone}).eq("id",o);if(a)throw a;m(`/admin/merchant/${o}`)}else{if(!r.password||r.password.length<6){l("Le mot de passe doit contenir au moins 6 caractères"),c(!1);return}const{data:a,error:h}=await i.from("merchants").insert({name:r.name,email:r.email,phone:r.phone}).select().single();if(h)throw h;const{error:x}=await i.auth.signUp({email:r.email,password:r.password,options:{emailRedirectTo:void 0,data:{merchant_id:a.id,name:r.name}}});x&&console.warn("Auth user creation failed:",x);const w=`SWAPP-${a.id.slice(0,8).toUpperCase()}`;await i.from("merchants").update({qr_code_data:w}).eq("id",a.id),m(`/admin/merchant/${a.id}`)}}catch(a){console.error("Error saving merchant:",a),a.code==="23505"?l("Un e-commerçant avec cet email existe déjà"):a.code==="42703"?l("Erreur de base de données: colonne manquante. Veuillez ajouter la colonne qr_code_data."):a.message?l(`Erreur: ${a.message}`):l("Erreur lors de la sauvegarde")}finally{c(!1)}};return b?e.jsx(f,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})})}):e.jsx(f,{children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>m(t?`/admin/merchant/${o}`:"/admin/merchants"),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(E,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:t?"Modifier l'e-commerçant":"Nouvel e-commerçant"}),e.jsx("p",{className:"text-slate-600",children:t?"Modifiez les informations du compte":"Créez un nouveau compte e-commerçant"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[p&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:p}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-6 border-b border-slate-200",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(q,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Informations du compte"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Renseignez les informations de l'e-commerçant"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nom de l'entreprise *"}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:s=>n({...r,name:s.target.value}),placeholder:"Ex: Ma Boutique",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:r.email,onChange:s=>n({...r,email:s.target.value}),placeholder:"contact@maboutique.com",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Téléphone"}),e.jsx("input",{type:"tel",value:r.phone,onChange:s=>n({...r,phone:s.target.value}),placeholder:"+216 XX XXX XXX",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),!t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mot de passe *"}),e.jsx("input",{type:"password",required:!t,value:r.password,onChange:s=>n({...r,password:s.target.value}),placeholder:"Minimum 6 caractères",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Ce mot de passe sera utilisé pour la connexion à l'espace e-commerçant"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(t?`/admin/merchant/${o}`:"/admin/merchants"),className:"flex-1 px-4 py-3 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:u,className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-purple-300 transition-colors",children:u?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-5 h-5"}),t?"Enregistrer":"Créer"]})})]})]})]})]})})}export{T as default};
