import{s as c,j as e}from"./index-D04Gu7ka.js";import{r,L as n}from"./react-vendor-CTUriZ5h.js";import{A as h}from"./AdminLayout-DYWpLi8J.js";import{P as u}from"./plus-BbVUCmx5.js";import{S as L}from"./search-CPbK6Y1N.js";import{S as j}from"./store-B-5iV_wL.js";import{P as E}from"./package-ChDCFdB3.js";import{Q as f}from"./qr-code-ByVDLSXi.js";import{E as _}from"./eye-B0fj8J_e.js";import{S as k}from"./square-pen-CeNeTQJP.js";import{T as A}from"./trash-2-DAKlHNH6.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./shield-BNgLrtrc.js";import"./layout-dashboard-CqNl1jWq.js";import"./users-4zMWxYqH.js";import"./truck-CgEV9F53.js";import"./banknote-JI0QWWz-.js";import"./wallet-CVOcG8S4.js";import"./file-text-B3Ewreww.js";import"./clock-Dhxn45-3.js";import"./home-9mW_oZwz.js";function te(){const[o,d]=r.useState([]),[N,g]=r.useState([]),[b,v]=r.useState(!0),[l,w]=r.useState(""),[m,i]=r.useState(null);r.useEffect(()=>{y()},[]);const y=async()=>{try{const[t,s]=await Promise.all([c.from("merchants").select("id, name, email, phone, qr_code_data, created_at").order("created_at",{ascending:!1}),c.from("exchanges").select("merchant_id, status")]);d(t.data||[]),g(s.data||[])}finally{v(!1)}},C=async t=>{try{await c.from("merchants").delete().eq("id",t),d(o.filter(s=>s.id!==t)),i(null)}catch(s){console.error("Error deleting merchant:",s)}},S=t=>{const s=N.filter(a=>a.merchant_id===t);return{total:s.length,pending:s.filter(a=>a.status==="pending").length,validated:s.filter(a=>["validated","preparing","in_transit","completed"].includes(a.status)).length,rejected:s.filter(a=>a.status==="rejected").length}},x=o.filter(t=>{var s,a,p;return((s=t.name)==null?void 0:s.toLowerCase().includes(l.toLowerCase()))||((a=t.email)==null?void 0:a.toLowerCase().includes(l.toLowerCase()))||((p=t.phone)==null?void 0:p.toLowerCase().includes(l.toLowerCase()))});return b?e.jsx(h,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})})}):e.jsx(h,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-2",children:"E-Commerçants"}),e.jsx("p",{className:"text-slate-600",children:"Gérez les comptes e-commerçants"})]}),e.jsxs(n,{to:"/admin/merchant/new",className:"mt-4 md:mt-0 inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(u,{className:"w-5 h-5"}),"Ajouter un e-commerçant"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par nom, email ou téléphone...",value:l,onChange:t=>w(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-slate-900",children:"E-Commerçant"}),e.jsx("th",{className:"text-left px-6 py-4 text-sm font-semibold text-slate-900",children:"Contact"}),e.jsx("th",{className:"text-center px-6 py-4 text-sm font-semibold text-slate-900",children:"Échanges"}),e.jsx("th",{className:"text-center px-6 py-4 text-sm font-semibold text-slate-900",children:"QR Code"}),e.jsx("th",{className:"text-right px-6 py-4 text-sm font-semibold text-slate-900",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:x.map(t=>{const s=S(t.id);return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Inscrit le"," ",new Date(t.created_at).toLocaleDateString("fr-FR")]})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-slate-900",children:t.email}),e.jsx("p",{className:"text-sm text-slate-500",children:t.phone||"-"})]}),e.jsxs("td",{className:"px-6 py-4 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-900",children:s.total})]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[e.jsxs("span",{className:"text-emerald-600",children:[s.validated," validés"]}),s.rejected>0&&e.jsxs("span",{className:"text-red-600 ml-2",children:[s.rejected," rejetés"]})]})]}),e.jsx("td",{className:"px-6 py-4 text-center",children:t.qr_code_data?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs",children:[e.jsx(f,{className:"w-3 h-3"}),"Généré"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-slate-100 text-slate-600 rounded-full text-xs",children:[e.jsx(f,{className:"w-3 h-3"}),"Non généré"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(n,{to:`/admin/merchant/${t.id}`,className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Voir détails",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsx(n,{to:`/admin/merchant/${t.id}/edit`,className:"p-2 text-slate-600 hover:text-sky-600 hover:bg-sky-50 rounded-lg transition-colors",title:"Modifier",children:e.jsx(k,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>i(t.id),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Supprimer",children:e.jsx(A,{className:"w-5 h-5"})})]})})]},t.id)})})]})}),x.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500",children:"Aucun e-commerçant trouvé"}),e.jsxs(n,{to:"/admin/merchant/new",className:"inline-flex items-center gap-2 mt-4 px-4 py-2 text-purple-600 hover:text-purple-700",children:[e.jsx(u,{className:"w-5 h-5"}),"Ajouter un e-commerçant"]})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Confirmer la suppression"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Êtes-vous sûr de vouloir supprimer cet e-commerçant ? Cette action est irréversible."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>i(null),className:"px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Annuler"}),e.jsx("button",{onClick:()=>C(m),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Supprimer"})]})]})})]})})}export{te as default};
