import{g as $,s as Y,j as e,D as Z,a as B,P as O}from"./index-hp3Tfpax.js";import{r as n,L as I}from"./react-vendor-CTUriZ5h.js";import{A as y}from"./AdminLayout-DAn3vzh8.js";import{W as b}from"./wallet-CVOcG8S4.js";import{R as v}from"./refresh-cw-EGIEbGnh.js";import{S as U}from"./search-CPbK6Y1N.js";import{F as G}from"./filter-Cp7rfch8.js";import{C as H}from"./calendar-upMk3ayk.js";import{D as W}from"./download-BkxpqmAo.js";import{B as z}from"./building-2-D3YxmJoi.js";import{C as V}from"./chevron-right-DAoz1ith.js";import{C as o}from"./check-circle-CyNeZd0p.js";import{C as w}from"./clock-Dhxn45-3.js";import{A as q}from"./alert-circle-_Iqic_ih.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./shield-BNgLrtrc.js";import"./layout-dashboard-CqNl1jWq.js";import"./users-4zMWxYqH.js";import"./truck-CgEV9F53.js";import"./banknote-JI0QWWz-.js";import"./store-B-5iV_wL.js";import"./file-text-B3Ewreww.js";import"./home-9mW_oZwz.js";const P=[{id:"1",merchant_id:"m1",payment_number:"PAY-2025-P24-001",period_number:2,year:2025,month:12,period_start:"2025-12-01",period_end:"2025-12-15",total_exchanges:12,total_collected:380,total_swapp_fees:108,total_delivery_fees:60,amount_due:212,status:"pending",created_at:new Date().toISOString(),merchant:{id:"m1",email:"techstore@example.com",name:"TechStore",phone:"+216 98 123 456",business_name:"TechStore Tunisie",platform_fee:9,delivery_fee:5,created_at:""}},{id:"2",merchant_id:"m2",payment_number:"PAY-2025-P24-002",period_number:2,year:2025,month:12,period_start:"2025-12-01",period_end:"2025-12-15",total_exchanges:8,total_collected:245,total_swapp_fees:72,total_delivery_fees:40,amount_due:133,status:"paid",paid_at:"2025-12-16T10:00:00Z",merchant_accepted:!1,created_at:new Date().toISOString(),merchant:{id:"m2",email:"modashop@example.com",name:"ModaShop",phone:"+216 97 456 789",business_name:"ModaShop Fashion",platform_fee:9,delivery_fee:5,created_at:""}},{id:"3",merchant_id:"m3",payment_number:"PAY-2025-P24-003",period_number:2,year:2025,month:12,period_start:"2025-12-01",period_end:"2025-12-15",total_exchanges:5,total_collected:134,total_swapp_fees:45,total_delivery_fees:25,amount_due:64,status:"accepted",paid_at:"2025-12-16T10:00:00Z",payment_method:"cash",payment_reference:"CASH-2025-1216-001",merchant_accepted:!0,merchant_accepted_at:"2025-12-16T12:00:00Z",created_at:new Date().toISOString(),merchant:{id:"m3",email:"electroplus@example.com",name:"ElectroPlus",phone:"+216 96 789 012",business_name:"ElectroPlus SARL",platform_fee:9,delivery_fee:5,created_at:""}},{id:"4",merchant_id:"m1",payment_number:"PAY-2025-P23-001",period_number:1,year:2025,month:12,period_start:"2025-12-01",period_end:"2025-12-15",total_exchanges:15,total_collected:425,total_swapp_fees:135,total_delivery_fees:75,amount_due:215,status:"accepted",paid_at:"2025-12-17T14:30:00Z",payment_method:"cash",payment_reference:"CASH-2025-1217-001",merchant_accepted:!0,merchant_accepted_at:"2025-12-17T16:00:00Z",created_at:"2025-12-01T00:00:00Z",merchant:{id:"m1",email:"techstore@example.com",name:"TechStore",phone:"+216 98 123 456",business_name:"TechStore Tunisie",platform_fee:9,delivery_fee:5,created_at:""}}];function be(){const[S,d]=n.useState([]),[D,T]=n.useState(!0),[h,u]=n.useState(!1),[i,C]=n.useState(""),[m,A]=n.useState("all"),[x,E]=n.useState("current"),s=$();n.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:t,error:a}=await Y.from("merchant_payments").select(`
          *,
          merchant:merchants(id, name, email, phone, business_name)
        `).order("created_at",{ascending:!1});a?(console.log("Using demo data - merchant_payments table not created yet"),d(P)):d(t||[])}catch(t){console.error("Error fetching payments:",t),d(P)}finally{T(!1)}},L=async()=>{u(!0);try{alert(`Génération des paiements pour la période ${s.periodNumber===1?"1-15":"16-"+new Date(s.year,s.month,0).getDate()} ${new Date(s.year,s.month-1).toLocaleDateString("fr-FR",{month:"long"})} ${s.year}`),await f()}catch(t){console.error("Error generating payments:",t),alert("Erreur lors de la génération des paiements")}finally{u(!1)}},c=S.filter(t=>{var g,j,_,N;const a=i===""||t.payment_number.toLowerCase().includes(i.toLowerCase())||((j=(g=t.merchant)==null?void 0:g.name)==null?void 0:j.toLowerCase().includes(i.toLowerCase()))||((N=(_=t.merchant)==null?void 0:_.business_name)==null?void 0:N.toLowerCase().includes(i.toLowerCase())),r=m==="all"||t.status===m;let l=!0;if(x==="current")l=t.year===s.year&&t.month===s.month&&t.period_number===s.periodNumber;else if(x==="previous"){const p=s.periodNumber===1?{year:s.year,month:s.month-1||12,num:2}:{year:s.year,month:s.month,num:1};l=t.year===p.year&&t.month===p.month&&t.period_number===p.num}return a&&r&&l}),F=c.filter(t=>t.status==="pending"||t.status==="approved").reduce((t,a)=>t+a.amount_due,0),k=t=>{const a={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",paid:"bg-emerald-100 text-emerald-800",accepted:"bg-green-100 text-green-800",disputed:"bg-red-100 text-red-800"},r={pending:e.jsx(w,{className:"w-3 h-3"}),approved:e.jsx(o,{className:"w-3 h-3"}),paid:e.jsx(o,{className:"w-3 h-3"}),accepted:e.jsx(o,{className:"w-3 h-3"}),disputed:e.jsx(q,{className:"w-3 h-3"})};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a[t]}`,children:[r[t],O[t]]})},R=t=>t.status==="pending"?e.jsx("span",{className:"text-xs text-slate-400",children:"—"}):t.merchant_accepted?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(o,{className:"w-3 h-3"}),"Accepté"]}):t.status==="paid"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800",children:[e.jsx(w,{className:"w-3 h-3"}),"En attente"]}):e.jsx("span",{className:"text-xs text-slate-400",children:"—"}),M=t=>{const a=new Date(t.period_start),r=new Date(t.period_end);return`${a.getDate()}-${r.getDate()} ${a.toLocaleDateString("fr-FR",{month:"short"})}`};return D?e.jsx(y,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(y,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx(b,{className:"w-7 h-7"}),"Paiements Marchands"]}),e.jsxs("p",{className:"text-slate-600 mt-1",children:["Période actuelle:"," ",s.periodNumber===1?"1-15":"16-"+new Date(s.year,s.month,0).getDate()," ",new Date(s.year,s.month-1).toLocaleDateString("fr-FR",{month:"long"})," ",s.year]})]}),e.jsxs("button",{onClick:L,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors disabled:opacity-50",children:[h?e.jsx(v,{className:"w-4 h-4 animate-spin"}):e.jsx(v,{className:"w-4 h-4"}),"Générer Période"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-sky-500 to-sky-600 rounded-xl shadow p-6 mb-8 text-white",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sky-100 text-sm",children:"Total à payer cette période"}),e.jsxs("p",{className:"text-3xl font-bold",children:[F.toFixed(2)," TND"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sky-100 text-sm",children:"Paiements en attente"}),e.jsx("p",{className:"text-3xl font-bold",children:c.filter(t=>t.status==="pending").length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sky-100 text-sm",children:"Marchands concernés"}),e.jsx("p",{className:"text-3xl font-bold",children:new Set(c.map(t=>t.merchant_id)).size})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-64 relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par n° paiement ou marchand...",value:i,onChange:t=>C(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-slate-400"}),e.jsxs("select",{value:m,onChange:t=>A(t.target.value),className:"border border-slate-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"all",children:"Tous statuts"}),e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"approved",children:"Approuvé"}),e.jsx("option",{value:"paid",children:"Payé"}),e.jsx("option",{value:"disputed",children:"Contesté"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-slate-400"}),e.jsxs("select",{value:x,onChange:t=>E(t.target.value),className:"border border-slate-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"all",children:"Toutes périodes"}),e.jsx("option",{value:"current",children:"Période actuelle"}),e.jsx("option",{value:"previous",children:"Période précédente"})]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"Exporter"]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:c.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-4 text-slate-300"}),e.jsx("p",{children:"Aucun paiement trouvé"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"N° Paiement"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Marchand"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Période"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase",children:"Échanges"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase",children:"Collecté"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase",children:"Frais"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase",children:"À Payer"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase",children:"Statut"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase",children:"Acceptation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:c.map(t=>{var a,r,l;return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm text-slate-900",children:t.payment_number})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center",children:e.jsx(z,{className:"w-4 h-4 text-slate-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:((a=t.merchant)==null?void 0:a.business_name)||((r=t.merchant)==null?void 0:r.name)||"—"}),e.jsx("p",{className:"text-xs text-slate-500",children:(l=t.merchant)==null?void 0:l.email})]})]})}),e.jsxs("td",{className:"px-4 py-3 text-slate-600",children:[M(t)," ",t.year]}),e.jsx("td",{className:"px-4 py-3 text-center text-slate-900",children:t.total_exchanges}),e.jsxs("td",{className:"px-4 py-3 text-right text-slate-900",children:[t.total_collected.toFixed(2)," TND"]}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"text-xs text-slate-500",children:[e.jsxs("div",{children:["Plateforme: ",t.total_swapp_fees.toFixed(2)]}),e.jsxs("div",{children:["Livraison:"," ",(t.total_delivery_fees||0).toFixed(2)]})]})}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-emerald-600",children:[t.amount_due.toFixed(2)," TND"]}),e.jsx("td",{className:"px-4 py-3 text-center",children:k(t.status)}),e.jsx("td",{className:"px-4 py-3 text-center",children:R(t)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(I,{to:`/admin/merchant-payments/${t.id}`,className:"inline-flex items-center gap-1 text-sky-600 hover:text-sky-700 text-sm font-medium",children:["Détails",e.jsx(V,{className:"w-4 h-4"})]})})]},t.id)})})]})})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Cycle de Paiement"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Période 1:"})," Du 1er au 15 du mois → Paiement entre le 16 et le 20"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Période 2:"})," Du 16 à la fin du mois → Paiement entre le 1er et le 5 du mois suivant"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Frais Plateforme:"})," ",Z," TND par défaut (configurable par marchand)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Frais Livraison:"})," ",B," TND par défaut (configurable par marchand)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Paiement espèces:"})," Le marchand doit accepter le paiement après réception"]})]})]})]})})}export{be as default};
