import{u as $,a as Q,c as D,r as d,s as y,j as e}from"./index-CQ_LRKqG.js";import{L as S}from"./LanguageSwitcher-BSsa_eK8.js";import{S as m}from"./store-Cz-oRZt_.js";import{C}from"./chevron-right-4k3MFnrn.js";import{P as p}from"./package-euHH1Ynp.js";import{S as x}from"./star-z966A4YF.js";import{S as P}from"./search-D4jlkjVa.js";import{C as L}from"./clock-CzMshNXu.js";import"./createLucideIcon-_6ROX8yg.js";function V(){const c=$(),{lang:t,dir:h}=Q(),{scannedMerchants:i,clientInfo:l}=D(),[k,_]=d.useState([]),[q,g]=d.useState(!0),[f,R]=d.useState(""),[a,N]=d.useState(null);d.useEffect(()=>{M()},[i,l]);const M=async()=>{if(!(l!=null&&l.phone)||i.length===0){g(!1);return}try{const s=i.map(r=>r.id),{data:n}=await y.from("exchanges").select("*").eq("client_phone",l.phone).in("merchant_id",s).order("created_at",{ascending:!1}),{data:o}=await y.from("reviews").select("*").eq("client_phone",l.phone).in("merchant_id",s).order("created_at",{ascending:!1}),b=i.map(r=>({...r,exchanges:(n==null?void 0:n.filter(j=>j.merchant_id===r.id))||[],reviews:(o==null?void 0:o.filter(j=>j.merchant_id===r.id))||[]}));_(b)}catch(s){console.error("Error loading merchant history:",s)}finally{g(!1)}},v=k.filter(s=>s.name.toLowerCase().includes(f.toLowerCase())),u=s=>new Date(s).toLocaleDateString(t==="ar"?"ar-TN":"fr-TN",{year:"numeric",month:"short",day:"numeric"}),w=s=>{const n=new Date(s),b=new Date().getTime()-n.getTime(),r=Math.floor(b/(1e3*60*60*24));return r===0?t==="ar"?"اليوم":"Aujourd'hui":r===1?t==="ar"?"أمس":"Hier":r<7?t==="ar"?`منذ ${r} أيام`:`Il y a ${r} jours`:u(s)};return l?q?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500"})}):a?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",dir:h,children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(S,{})}),e.jsxs("button",{onClick:()=>N(null),className:"flex items-center text-white/70 hover:text-white mb-6 transition-colors",children:[e.jsx(C,{className:`w-5 h-5 ${t==="ar"?"ml-2":"mr-2 rotate-180"}`}),e.jsx("span",{className:"font-medium",children:t==="ar"?"العودة":"Retour"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[a.logoUrl?e.jsx("img",{src:a.logoUrl,alt:a.name,className:"w-16 h-16 rounded-xl object-cover"}):e.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-xl flex items-center justify-center",children:e.jsx(m,{className:"w-8 h-8 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:a.name}),e.jsxs("p",{className:"text-slate-400 text-sm",children:[t==="ar"?"آخر تفاعل:":"Dernière interaction:"," ",w(a.lastInteraction)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-6",children:[e.jsxs("button",{onClick:()=>c(`/client/exchange/new?merchant=${a.id}`),className:"flex items-center justify-center gap-2 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-medium transition-colors",children:[e.jsx(p,{className:"w-5 h-5"}),t==="ar"?"طلب استبدال":"Demander échange"]}),e.jsxs("button",{onClick:()=>c(`/client/review/new?merchant=${a.id}`),className:"flex items-center justify-center gap-2 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-medium transition-colors",children:[e.jsx(x,{className:"w-5 h-5"}),t==="ar"?"ترك تقييم":"Laisser un avis"]})]})]}),a.exchanges.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-emerald-400"}),t==="ar"?"طلبات الاستبدال":"Demandes d'échange",e.jsxs("span",{className:"text-sm text-slate-400",children:["(",a.exchanges.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:a.exchanges.map(s=>e.jsx("div",{onClick:()=>c(`/client/tracking/${s.exchange_code}`),className:"bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl p-4 cursor-pointer hover:bg-white/20 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.product_name}),e.jsx("p",{className:"text-sm text-slate-400",children:s.exchange_code})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${s.status==="completed"?"bg-emerald-500/20 text-emerald-400":s.status==="pending"?"bg-amber-500/20 text-amber-400":s.status==="rejected"?"bg-red-500/20 text-red-400":"bg-blue-500/20 text-blue-400"}`,children:s.status}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:u(s.created_at)})]})]})},s.id))})]}),a.reviews.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(x,{className:"w-5 h-5 text-amber-400"}),t==="ar"?"تقييماتي":"Mes avis",e.jsxs("span",{className:"text-sm text-slate-400",children:["(",a.reviews.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:a.reviews.map(s=>e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[[1,2,3,4,5].map(n=>e.jsx(x,{className:`w-4 h-4 ${n<=s.rating?"text-amber-400 fill-amber-400":"text-slate-600"}`},n)),e.jsx("span",{className:"text-sm text-slate-400 ml-2",children:u(s.created_at)})]}),s.comment&&e.jsx("p",{className:"text-slate-300 text-sm",children:s.comment}),s.merchant_response&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:t==="ar"?"رد المتجر:":"Réponse du marchand:"}),e.jsx("p",{className:"text-sm text-emerald-400",children:s.merchant_response})]})]},s.id))})]}),a.exchanges.length===0&&a.reviews.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:t==="ar"?"لم تقم بأي تفاعل مع هذا المتجر بعد":"Vous n'avez pas encore interagi avec cette boutique"})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",dir:h,children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(S,{})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:t==="ar"?"متاجري":"Mes Boutiques"}),e.jsx("p",{className:"text-slate-400",children:t==="ar"?`مرحبًا ${l.name}، إليك المتاجر التي تفاعلت معها`:`Bonjour ${l.name}, voici les boutiques avec lesquelles vous avez interagi`})]}),i.length>3&&e.jsxs("div",{className:"relative mb-6",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",value:f,onChange:s=>R(s.target.value),placeholder:t==="ar"?"البحث عن متجر...":"Rechercher une boutique...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-slate-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),v.length>0?e.jsx("div",{className:"space-y-3",children:v.map(s=>e.jsx("div",{onClick:()=>N(s),className:"bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-4 cursor-pointer hover:bg-white/20 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[s.logoUrl?e.jsx("img",{src:s.logoUrl,alt:s.name,className:"w-14 h-14 rounded-xl object-cover"}):e.jsx("div",{className:"w-14 h-14 bg-emerald-500/20 rounded-xl flex items-center justify-center",children:e.jsx(m,{className:"w-7 h-7 text-emerald-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-white",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-400 mt-1",children:[s.exchanges.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"w-4 h-4"}),s.exchanges.length]}),s.reviews.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-4 h-4"}),s.reviews.length]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4"}),w(s.lastInteraction)]})]})]}),e.jsx(C,{className:`w-5 h-5 text-slate-400 ${t==="ar"?"rotate-180":""}`})]})},s.id))}):i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 mx-auto bg-slate-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(m,{className:"w-10 h-10 text-slate-400"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-3",children:t==="ar"?"لا توجد متاجر بعد":"Aucune boutique"}),e.jsx("p",{className:"text-slate-400 mb-6",children:t==="ar"?"قم بمسح رمز QR الخاص بأي متجر للبدء":"Scannez le QR code d'une boutique pour commencer"}),e.jsx("button",{onClick:()=>c("/client/scan"),className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-medium transition-colors",children:t==="ar"?"مسح رمز QR":"Scanner un QR Code"})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-400",children:t==="ar"?"لا توجد نتائج":"Aucun résultat"})}),i.length>0&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2",children:e.jsx("button",{onClick:()=>c("/client/scan"),className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-full font-medium shadow-lg shadow-emerald-600/30 transition-all hover:scale-105",children:t==="ar"?"+ مسح متجر جديد":"+ Scanner une boutique"})}),e.jsx("div",{className:"mt-12 pb-20 text-center",children:e.jsxs("p",{className:"text-slate-500 text-sm",children:["Powered by ",e.jsx("span",{className:"font-semibold text-emerald-400",children:"SWAPP"})]})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",dir:h,children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto bg-slate-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(m,{className:"w-10 h-10 text-slate-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-3",children:t==="ar"?"مرحبًا بك في SWAPP":"Bienvenue sur SWAPP"}),e.jsx("p",{className:"text-slate-400 mb-6",children:t==="ar"?"قم بمسح رمز QR الخاص بأي متجر للبدء. ستظهر هنا جميع العلامات التجارية التي تفاعلت معها.":"Scannez le QR code d'une boutique pour commencer. Toutes les marques avec lesquelles vous avez interagi apparaîtront ici."}),e.jsx("button",{onClick:()=>c("/client/scan"),className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-medium transition-colors",children:t==="ar"?"مسح رمز QR":"Scanner un QR Code"})]})})}export{V as default};
