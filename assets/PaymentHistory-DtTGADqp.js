import{u as $,r as d,s as m,h as k,j as e,P as v,L as w,D as U,i as q}from"./index-DFvv-w89.js";import{M as y}from"./MerchantLayout-DaYlHzKY.js";import{C as T}from"./clock-CE09cy-B.js";import{T as O}from"./trending-up-DD5ujhR9.js";import{C as D}from"./calendar-CmUjSZZL.js";import{C as I}from"./credit-card-4EFQM6gR.js";import{W}from"./wallet-MnBri6Rx.js";import{C as B}from"./chevron-right-DldUc1Cw.js";import{A as H}from"./alert-circle-DJhIx7HF.js";import{C as u}from"./check-circle-DSGQyNwA.js";import"./x-Da1ibMTn.js";import"./createLucideIcon-uyDXa_zM.js";import"./menu-C3vAH9_j.js";import"./store-N3OyYKaz.js";import"./layout-dashboard-Cu2jKyVz.js";import"./package-DnO4fK3w.js";import"./truck-Bi_hIRN9.js";import"./users-BmwoClUy.js";import"./banknote-D7yUYJio.js";import"./message-square-CZQYz4Jq.js";import"./star-C0JDmjfi.js";import"./video-BmMYZyy_.js";import"./log-out-Ba_KqF8c.js";const _=[{id:"1",merchant_id:"demo",payment_number:"PAY-2025-P24-001",period_number:2,year:2025,month:12,period_start:"2025-12-01",period_end:"2025-12-15",total_exchanges:8,total_collected:245,total_swapp_fees:72,total_delivery_fees:40,amount_due:133,status:"paid",paid_at:"2025-12-18T10:30:00Z",payment_method:"cash",merchant_accepted:!1,created_at:new Date().toISOString()},{id:"2",merchant_id:"demo",payment_number:"PAY-2025-P23-001",period_number:1,year:2025,month:12,period_start:"2025-12-01",period_end:"2025-12-15",total_exchanges:12,total_collected:380,total_swapp_fees:108,total_delivery_fees:60,amount_due:212,status:"accepted",paid_at:"2025-12-18T10:30:00Z",payment_method:"cash",merchant_accepted:!0,merchant_accepted_at:"2025-12-18T14:00:00Z",created_at:"2025-12-01T00:00:00Z"},{id:"3",merchant_id:"demo",payment_number:"PAY-2025-P22-001",period_number:2,year:2025,month:11,period_start:"2025-11-16",period_end:"2025-11-30",total_exchanges:15,total_collected:425,total_swapp_fees:135,total_delivery_fees:75,amount_due:215,status:"accepted",paid_at:"2025-12-03T14:00:00Z",payment_method:"cash",merchant_accepted:!0,merchant_accepted_at:"2025-12-03T16:00:00Z",created_at:"2025-11-16T00:00:00Z"},{id:"4",merchant_id:"demo",payment_number:"PAY-2025-P21-001",period_number:1,year:2025,month:11,period_start:"2025-11-01",period_end:"2025-11-15",total_exchanges:10,total_collected:310,total_swapp_fees:90,total_delivery_fees:50,amount_due:170,status:"accepted",paid_at:"2025-11-18T09:15:00Z",payment_method:"cash",merchant_accepted:!0,merchant_accepted_at:"2025-11-18T12:00:00Z",created_at:"2025-11-01T00:00:00Z"}],f={total_pending:173,total_paid:782,current_period_amount:173,exchanges_this_period:8,last_payment_date:"2025-12-18",last_payment_amount:272};function _e(){const S=$(),[g,c]=d.useState([]),[s,o]=d.useState(null),[A,j]=d.useState(!0),[x,E]=d.useState("all");d.useEffect(()=>{F(),C()},[]);const F=async()=>{const{data:{session:t}}=await m.auth.getSession();t||S("/merchant/login")},C=async()=>{try{const{data:{session:t}}=await m.auth.getSession();if(!t)return;const{data:r}=await m.from("merchants").select("id").eq("email",t.user.email).maybeSingle();if(!r){c(_),o(f),j(!1);return}const{data:n,error:Z}=await m.from("merchant_payments").select("*").eq("merchant_id",r.id).order("created_at",{ascending:!1});if(Z)console.log("Using demo data - merchant_payments table not created yet"),c(_),o(f);else{c(n||[]);const R=(n||[]).filter(a=>a.status==="pending"||a.status==="approved").reduce((a,h)=>a+h.amount_due,0),Y=(n||[]).filter(a=>a.status==="paid").reduce((a,h)=>a+h.amount_due,0),l=(n||[]).find(a=>a.status==="paid"),p=k(),i=(n||[]).find(a=>a.year===p.year&&a.month===p.month&&a.period_number===p.periodNumber);o({total_pending:R,total_paid:Y,current_period_amount:(i==null?void 0:i.amount_due)||0,exchanges_this_period:(i==null?void 0:i.total_exchanges)||0,last_payment_date:l==null?void 0:l.paid_at,last_payment_amount:l==null?void 0:l.amount_due})}}catch(t){console.error("Error fetching data:",t),c(_),o(f)}finally{j(!1)}},b=x==="all"?g:g.filter(t=>t.status===x),P=t=>{const r={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",paid:"bg-emerald-100 text-emerald-800",accepted:"bg-green-100 text-green-800",disputed:"bg-red-100 text-red-800"},n={pending:e.jsx(T,{className:"w-3 h-3"}),approved:e.jsx(u,{className:"w-3 h-3"}),paid:e.jsx(u,{className:"w-3 h-3"}),accepted:e.jsx(u,{className:"w-3 h-3"}),disputed:e.jsx(H,{className:"w-3 h-3"})};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${r[t]}`,children:[n[t],v[t]]})},L=t=>t.status==="paid"&&!t.merchant_accepted,N=t=>new Date(t).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"}),M=t=>{const r=new Date(t.period_start),n=new Date(t.period_end);return`${r.getDate()}-${n.getDate()} ${r.toLocaleDateString("fr-FR",{month:"short"})} ${t.year}`};return A?e.jsx(y,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(y,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Mes Paiements"}),e.jsx("p",{className:"text-slate-600",children:"Suivi de vos paiements bi-mensuels"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(T,{className:"w-6 h-6 text-yellow-600"})})}),e.jsx("p",{className:"text-slate-600 text-sm mb-1",children:"Solde en Attente"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900",children:[s==null?void 0:s.total_pending.toFixed(2)," TND"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(O,{className:"w-6 h-6 text-green-600"})})}),e.jsx("p",{className:"text-slate-600 text-sm mb-1",children:"Total Reçu"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900",children:[s==null?void 0:s.total_paid.toFixed(2)," TND"]}),(s==null?void 0:s.last_payment_date)&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Dernier paiement: ",N(s.last_payment_date)]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(D,{className:"w-6 h-6 text-blue-600"})})}),e.jsx("p",{className:"text-slate-600 text-sm mb-1",children:"Période Actuelle"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900",children:[s==null?void 0:s.exchanges_this_period," échanges"]}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[s==null?void 0:s.current_period_amount.toFixed(2)," TND à recevoir"]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Filtrer par statut:"}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","paid","disputed"].map(t=>e.jsx("button",{onClick:()=>E(t),className:`px-3 py-1 text-sm rounded-lg transition-colors ${x===t?"bg-sky-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:t==="all"?"Tous":v[t]},t))})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200",children:e.jsxs("h3",{className:"font-semibold text-slate-900 flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Historique des Paiements"]})}),b.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-4 text-slate-300"}),e.jsx("p",{children:"Aucun paiement trouvé"})]}):e.jsx("div",{className:"divide-y divide-slate-200",children:b.map(t=>e.jsx("div",{className:"p-4 hover:bg-slate-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(w,{to:`/merchant/payments/${t.id}`,className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-medium text-slate-900",children:t.payment_number}),P(t.status),L(t)&&e.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-800 rounded-full text-xs font-medium",children:"Action requise"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4"}),M(t)]}),e.jsxs("span",{children:[t.total_exchanges," échanges"]}),e.jsx("span",{className:"text-slate-400",children:"|"}),e.jsxs("span",{children:["Frais:"," ",(t.total_swapp_fees+(t.total_delivery_fees||0)).toFixed(2)," ","TND"]})]})]}),e.jsxs("div",{className:"text-right mr-4",children:[e.jsxs("p",{className:"text-lg font-bold text-emerald-600",children:[t.amount_due.toFixed(2)," TND"]}),t.paid_at&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Payé le ",N(t.paid_at)]}),t.merchant_accepted&&e.jsx("p",{className:"text-xs text-green-600 font-medium",children:"✓ Accepté"})]}),e.jsx(w,{to:`/merchant/payments/${t.id}`,className:"flex items-center",children:e.jsx(B,{className:"w-5 h-5 text-slate-400"})})]})},t.id))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Comment ça marche ?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Les paiements sont calculés toutes les 2 semaines (1-15 et 16-fin du mois)"}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Frais Plateforme:"})," ",U," TND par échange (déduit du montant encaissé)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Frais Livraison:"})," ",q," TND par échange (déduit du montant encaissé)"]}),e.jsx("li",{children:"• Le paiement est effectué en espèces au bureau SWAPP"}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Important:"})," Vous devez accepter le paiement après réception pour confirmer"]})]})]})]})})}export{_e as default};
