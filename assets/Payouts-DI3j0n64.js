import{s as W,j as e,p as P,h as T}from"./index-DJR32chX.js";import{r as t}from"./react-vendor-CTUriZ5h.js";import{F as H}from"./FinanceLayout-CR_SXrc6.js";import{P as J}from"./plus-BbVUCmx5.js";import{C as f}from"./credit-card-D2z2xSBY.js";import{C as b}from"./clock-Dhxn45-3.js";import{C as N}from"./check-circle-CyNeZd0p.js";import{B as F}from"./building-2-D3YxmJoi.js";import{S as Q}from"./search-CPbK6Y1N.js";import{C as D}from"./calendar-upMk3ayk.js";import{R as V}from"./refresh-cw-EGIEbGnh.js";import{E as Y}from"./eye-B0fj8J_e.js";import{C as Z}from"./chevron-left-Dqi4HWkY.js";import{C as ee}from"./chevron-right-DAoz1ith.js";import{X as se}from"./x-D4qrk5Qy.js";import{X as ae}from"./x-circle-D3f66Y07.js";import{T as te}from"./truck-CgEV9F53.js";import{U as re}from"./user-DEx4Ce9L.js";import"./supabase-Bl4YWSQ9.js";import"./menu-DP2azNEK.js";import"./createLucideIcon-CMjKDoEE.js";import"./calculator-BAKCaH61.js";import"./layout-dashboard-CqNl1jWq.js";import"./wallet-CVOcG8S4.js";import"./file-text-B3Ewreww.js";import"./alert-triangle-1NuODUVJ.js";import"./bar-chart-3-DdlwYHtY.js";import"./users-4zMWxYqH.js";import"./settings-C58fTzTa.js";import"./log-out-BX30H4-p.js";function Ae(){var S;const[c,L]=t.useState([]),[M,v]=t.useState(!0),[g,R]=t.useState(""),[d,A]=t.useState("all"),[m,E]=t.useState("all"),[o,z]=t.useState(""),[x,B]=t.useState(""),[a,y]=t.useState(null),[r,n]=t.useState(1),[p,q]=t.useState(0),i=15;t.useEffect(()=>{w()},[r,d,m,o,x]);const w=async()=>{v(!0);try{let s=W.from("finance_payouts").select(`
          *,
          merchant:merchants(business_name),
          delivery_person:delivery_persons(full_name),
          delivery_company:delivery_companies(name),
          wallet:finance_wallets(wallet_number)
        `,{count:"exact"});d!=="all"&&(s=s.eq("status",d)),m!=="all"&&(s=s.eq("payee_type",m)),o&&(s=s.gte("created_at",o)),x&&(s=s.lte("created_at",x+"T23:59:59")),g&&(s=s.ilike("payout_number",`%${g}%`));const{data:l,error:k,count:O}=await s.order("created_at",{ascending:!1}).range((r-1)*i,r*i-1);if(k)throw k;L(l||[]),q(O||0)}catch(s){console.error("Error fetching payouts:",s)}finally{v(!1)}},I=()=>{n(1),w()},h=s=>new Intl.NumberFormat("fr-TN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(s)+" TND",_=s=>{switch(s){case"paid":return e.jsx(N,{className:"w-5 h-5 text-green-500"});case"approved":return e.jsx(N,{className:"w-5 h-5 text-blue-500"});case"pending":return e.jsx(b,{className:"w-5 h-5 text-yellow-500"});case"rejected":case"cancelled":return e.jsx(ae,{className:"w-5 h-5 text-red-500"});default:return e.jsx(b,{className:"w-5 h-5 text-gray-500"})}},C=s=>{switch(s){case"paid":return"bg-green-100 text-green-800";case"approved":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},X=s=>{switch(s){case"merchant":return e.jsx(F,{className:"w-5 h-5"});case"delivery_person":return e.jsx(re,{className:"w-5 h-5"});case"delivery_company":return e.jsx(te,{className:"w-5 h-5"});default:return e.jsx(f,{className:"w-5 h-5"})}},j=s=>s.merchant?s.merchant.business_name:s.delivery_person?s.delivery_person.full_name:s.delivery_company?s.delivery_company.name:s.payout_number,$=[{value:"all",label:"Tous les bénéficiaires"},{value:"merchant",label:"Marchands"},{value:"delivery_person",label:"Livreurs"},{value:"delivery_company",label:"Sociétés Livraison"}],U=[{value:"all",label:"Tous les statuts"},{value:"pending",label:"En Attente"},{value:"approved",label:"Approuvé"},{value:"paid",label:"Payé"},{value:"rejected",label:"Rejeté"},{value:"cancelled",label:"Annulé"}],u=Math.ceil(p/i),G=c.filter(s=>s.status==="pending"||s.status==="approved").reduce((s,l)=>s+Number(l.amount),0),K=c.filter(s=>s.status==="paid").reduce((s,l)=>s+Number(l.amount),0);return e.jsxs(H,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Paiements"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Gestion des versements aux partenaires"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:[e.jsx(J,{className:"w-4 h-4"}),"Nouveau Paiement"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(f,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Paiements"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"En Attente"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:h(G)})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Payé (page)"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h(K)})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(F,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Bénéficiaires"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Set(c.map(s=>s.merchant_id||s.delivery_person_id||s.delivery_company_id)).size})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par numéro...",value:g,onChange:s=>R(s.target.value),onKeyDown:s=>s.key==="Enter"&&I(),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsx("div",{children:e.jsx("select",{value:m,onChange:s=>{E(s.target.value),n(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:$.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx("div",{children:e.jsx("select",{value:d,onChange:s=>{A(s.target.value),n(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:U.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:o,onChange:s=>{z(s.target.value),n(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:x,onChange:s=>{B(s.target.value),n(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(V,{className:"w-8 h-8 text-emerald-500 animate-spin"})}):c.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Aucun paiement trouvé"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paiement"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bénéficiaire"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Méthode"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:c.map(s=>{var l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[_(s.status),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.payout_number}),e.jsx("p",{className:"text-sm text-gray-500",children:((l=s.wallet)==null?void 0:l.wallet_number)||"-"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center text-gray-600",children:X(s.payee_type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:j(s)}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s.payee_type==="merchant"?"Marchand":s.payee_type==="delivery_person"?"Livreur":s.payee_type==="delivery_company"?"Société":s.payee_type})]})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("span",{className:"font-semibold text-gray-900",children:h(Number(s.amount))})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:"text-sm text-gray-600",children:P[s.payment_method]||s.payment_method||"-"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${C(s.status)}`,children:T[s.status]||s.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-gray-600",children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"})})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>y(s),className:"p-2 text-gray-500 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",children:e.jsx(Y,{className:"w-5 h-5"})})})]},s.id)})})]})}),u>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Affichage ",(r-1)*i+1," - ",Math.min(r*i,p)," sur ",p]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(Math.max(1,r-1)),disabled:r===1,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",r," / ",u]}),e.jsx("button",{onClick:()=>n(Math.min(u,r+1)),disabled:r===u,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ee,{className:"w-5 h-5"})})]})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[_(a.status),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:a.payout_number}),e.jsx("p",{className:"text-sm text-gray-500",children:j(a)})]})]}),e.jsx("button",{onClick:()=>y(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(se,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-xl",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Montant"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:h(Number(a.amount))}),e.jsx("span",{className:`mt-2 inline-block px-3 py-1 text-sm font-medium rounded-full ${C(a.status)}`,children:T[a.status]||a.status})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Bénéficiaire"}),e.jsx("span",{className:"font-medium text-gray-900",children:j(a)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Type"}),e.jsx("span",{className:"font-medium text-gray-900 capitalize",children:a.payee_type==="merchant"?"Marchand":a.payee_type==="delivery_person"?"Livreur":a.payee_type==="delivery_company"?"Société Livraison":a.payee_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Wallet"}),e.jsx("span",{className:"font-medium text-gray-900",children:((S=a.wallet)==null?void 0:S.wallet_number)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Méthode"}),e.jsx("span",{className:"font-medium text-gray-900",children:P[a.payment_method]||a.payment_method||"-"})]}),a.payment_reference&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Référence"}),e.jsx("span",{className:"font-medium text-gray-900",children:a.payment_reference})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Créé le"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(a.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})})]}),a.paid_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Payé le"}),e.jsx("span",{className:"font-medium text-green-600",children:new Date(a.paid_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})})]}),a.notes&&e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Notes"}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-lg",children:a.notes})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 flex justify-end gap-3",children:[a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200",children:"Rejeter"}),e.jsx("button",{className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600",children:"Approuver"})]}),a.status==="approved"&&e.jsx("button",{className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600",children:"Marquer Payé"}),e.jsx("button",{onClick:()=>y(null),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Fermer"})]})]})})]})}export{Ae as default};
