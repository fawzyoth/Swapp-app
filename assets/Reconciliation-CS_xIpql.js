import{s as Q,j as e,r as _}from"./index-BvuTS9li.js";import{r}from"./react-vendor-CTUriZ5h.js";import{F as X,C as I}from"./FinanceLayout-BaoFCtjW.js";import{P as O}from"./plus-BbVUCmx5.js";import{C as y}from"./clock-Dhxn45-3.js";import{A as C}from"./alert-triangle-1NuODUVJ.js";import{X as V}from"./x-circle-D3f66Y07.js";import{C as j}from"./check-circle-CyNeZd0p.js";import{C as S}from"./calendar-upMk3ayk.js";import{R as k}from"./refresh-cw-EGIEbGnh.js";import{E as B}from"./eye-B0fj8J_e.js";import{C as G}from"./chevron-left-Dqi4HWkY.js";import{C as J}from"./chevron-right-DAoz1ith.js";import{X as K}from"./x-D4qrk5Qy.js";import"./supabase-Bl4YWSQ9.js";import"./menu-DP2azNEK.js";import"./createLucideIcon-CMjKDoEE.js";import"./calculator-BAKCaH61.js";import"./layout-dashboard-CqNl1jWq.js";import"./wallet-CVOcG8S4.js";import"./credit-card-D2z2xSBY.js";import"./file-text-B3Ewreww.js";import"./bar-chart-3-DdlwYHtY.js";import"./building-2-D3YxmJoi.js";import"./users-4zMWxYqH.js";import"./settings-C58fTzTa.js";import"./log-out-BX30H4-p.js";function we(){const[c,R]=r.useState([]),[D,b]=r.useState(!0),[d,F]=r.useState("all"),[o,T]=r.useState("all"),[x,L]=r.useState(""),[m,M]=r.useState(""),[s,g]=r.useState(null),[a,i]=r.useState(1),[u,A]=r.useState(0),n=15;r.useEffect(()=>{N()},[a,d,o,x,m]);const N=async()=>{b(!0);try{let t=Q.from("finance_reconciliations").select(`
          *,
          delivery_company:delivery_companies(name)
        `,{count:"exact"});d!=="all"&&(t=t.eq("status",d)),o!=="all"&&(t=t.eq("reconciliation_type",o)),x&&(t=t.gte("period_start",x)),m&&(t=t.lte("period_end",m));const{data:h,error:w,count:H}=await t.order("created_at",{ascending:!1}).range((a-1)*n,a*n-1);if(w)throw w;R(h||[]),A(H||0)}catch(t){console.error("Error fetching reconciliations:",t)}finally{b(!1)}},l=t=>new Intl.NumberFormat("fr-TN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)+" TND",f=t=>{switch(t){case"matched":return e.jsx(j,{className:"w-5 h-5 text-green-500"});case"discrepancy":return e.jsx(C,{className:"w-5 h-5 text-orange-500"});case"pending":return e.jsx(y,{className:"w-5 h-5 text-yellow-500"});case"resolved":return e.jsx(j,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(y,{className:"w-5 h-5 text-gray-500"})}},v=t=>{switch(t){case"matched":return"bg-green-100 text-green-800";case"discrepancy":return"bg-orange-100 text-orange-800";case"pending":return"bg-yellow-100 text-yellow-800";case"resolved":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},E=[{value:"all",label:"Tous les types"},{value:"daily",label:"Quotidien"},{value:"weekly",label:"Hebdomadaire"},{value:"monthly",label:"Mensuel"},{value:"delivery_company",label:"Société Livraison"},{value:"merchant",label:"Marchand"}],P=[{value:"all",label:"Tous les statuts"},{value:"pending",label:"En Attente"},{value:"matched",label:"Réconcilié"},{value:"discrepancy",label:"Écart"},{value:"resolved",label:"Résolu"}],p=Math.ceil(u/n),q=c.filter(t=>t.status==="pending").length,$=c.filter(t=>t.status==="discrepancy").length,z=c.filter(t=>t.status==="discrepancy").reduce((t,h)=>t+Math.abs(Number(h.discrepancy_amount)),0);return e.jsxs(X,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Réconciliation"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Vérification et rapprochement des comptes"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:[e.jsx(O,{className:"w-4 h-4"}),"Nouvelle Réconciliation"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"En Attente"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:q})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Écarts Détectés"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:$})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Montant Écarts"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:l(z)})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(j,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx("div",{children:e.jsx("select",{value:o,onChange:t=>{T(t.target.value),i(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:E.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})}),e.jsx("div",{children:e.jsx("select",{value:d,onChange:t=>{F(t.target.value),i(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:P.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:x,onChange:t=>{L(t.target.value),i(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Date début"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:m,onChange:t=>{M(t.target.value),i(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Date fin"})]}),e.jsx("div",{children:e.jsxs("button",{onClick:N,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsx(k,{className:"w-4 h-4"}),"Actualiser"]})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(k,{className:"w-8 h-8 text-emerald-500 animate-spin"})}):c.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(I,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Aucune réconciliation trouvée"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Référence"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Période"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attendu"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Réel"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Écart"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:c.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[f(t.status),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.reconciliation_number}),t.delivery_company&&e.jsx("p",{className:"text-sm text-gray-500",children:t.delivery_company.name})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-gray-700 capitalize",children:t.reconciliation_type==="daily"?"Quotidien":t.reconciliation_type==="weekly"?"Hebdomadaire":t.reconciliation_type==="monthly"?"Mensuel":t.reconciliation_type==="delivery_company"?"Société Livraison":t.reconciliation_type})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[new Date(t.period_start).toLocaleDateString("fr-FR")," - ",new Date(t.period_end).toLocaleDateString("fr-FR")]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:l(Number(t.expected_amount))})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:l(Number(t.actual_amount))})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("span",{className:`font-semibold ${Number(t.discrepancy_amount)===0?"text-green-600":Number(t.discrepancy_amount)>0?"text-blue-600":"text-red-600"}`,children:[Number(t.discrepancy_amount)>0?"+":"",l(Number(t.discrepancy_amount))]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${v(t.status)}`,children:_[t.status]||t.status})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>g(t),className:"p-2 text-gray-500 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",children:e.jsx(B,{className:"w-5 h-5"})})})]},t.id))})]})}),p>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Affichage ",(a-1)*n+1," - ",Math.min(a*n,u)," sur ",u]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(Math.max(1,a-1)),disabled:a===1,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",a," / ",p]}),e.jsx("button",{onClick:()=>i(Math.min(p,a+1)),disabled:a===p,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(J,{className:"w-5 h-5"})})]})]})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-xl w-full overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[f(s.status),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s.reconciliation_number}),e.jsxs("p",{className:"text-sm text-gray-500",children:[new Date(s.period_start).toLocaleDateString("fr-FR")," - ",new Date(s.period_end).toLocaleDateString("fr-FR")]})]})]}),e.jsx("button",{onClick:()=>g(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(K,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Attendu"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:l(Number(s.expected_amount))})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Réel"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:l(Number(s.actual_amount))})]}),e.jsxs("div",{className:`rounded-lg p-4 text-center ${Number(s.discrepancy_amount)===0?"bg-green-50":Number(s.discrepancy_amount)>0?"bg-blue-50":"bg-red-50"}`,children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Écart"}),e.jsx("p",{className:`text-xl font-bold ${Number(s.discrepancy_amount)===0?"text-green-600":Number(s.discrepancy_amount)>0?"text-blue-600":"text-red-600"}`,children:l(Number(s.discrepancy_amount))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Type"}),e.jsx("span",{className:"font-medium text-gray-900 capitalize",children:s.reconciliation_type==="daily"?"Quotidien":s.reconciliation_type==="weekly"?"Hebdomadaire":s.reconciliation_type==="monthly"?"Mensuel":s.reconciliation_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Statut"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${v(s.status)}`,children:_[s.status]||s.status})]}),s.delivery_company&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Société Livraison"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.delivery_company.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Créé le"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})})]}),s.notes&&e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Notes"}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-lg",children:s.notes})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 flex justify-end gap-3",children:[s.status==="discrepancy"&&e.jsx("button",{className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600",children:"Marquer Résolu"}),e.jsx("button",{onClick:()=>g(null),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Fermer"})]})]})})]})}export{we as default};
