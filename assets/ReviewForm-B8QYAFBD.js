import{s as b,j as e}from"./index-DZYJF6_c.js";import{f as k,u as X,r}from"./react-vendor-CTUriZ5h.js";import{S as f}from"./StarRating-CBYZa208.js";import{C as g}from"./ClientLayout-hEHDleOk.js";import{C as p}from"./check-Cm21nyZb.js";import{A as _}from"./arrow-left-CxjwE-xR.js";import{S as z}from"./star-Cw7sdsKF.js";import{S as D}from"./send-DlqxrGT5.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./scan-line-Dhzz-_Ia.js";import"./home-9mW_oZwz.js";import"./message-square-B53yKzw3.js";function Q(){const[j]=k(),c=X(),o=j.get("code")||"",[t,l]=r.useState({clientName:"",clientPhone:"",rating:0,comment:""}),[m,d]=r.useState(!1),[v,x]=r.useState(!1),[u,i]=r.useState(""),[N,w]=r.useState(!1),[y,S]=r.useState(!1);r.useEffect(()=>{const s=localStorage.getItem("lastClientPhone");s&&h(s)},[]);const h=async s=>{x(!0);try{const{data:a}=await b.from("exchanges").select("*").eq("client_phone",s).order("created_at",{ascending:!1}).limit(1);if(a&&a.length>0){const n=a[0];l(E=>({...E,clientName:n.client_name||"",clientPhone:s})),S(!0)}}catch(a){console.error("Error loading previous data:",a)}finally{x(!1)}},C=async s=>{l({...t,clientPhone:s}),s.length>=8&&h(s)},P=async s=>{if(s.preventDefault(),t.rating===0){i("Veuillez sélectionner une note");return}d(!0),i("");try{const a="11111111-1111-1111-1111-111111111111",{error:n}=await b.from("reviews").insert({exchange_code:o||null,merchant_id:a,client_name:t.clientName,client_phone:t.clientPhone,rating:t.rating,comment:t.comment||null,is_published:!0});if(n)throw n;localStorage.setItem("lastClientPhone",t.clientPhone),w(!0)}catch(a){console.error("Error submitting review:",a),i("Erreur lors de la soumission. Veuillez réessayer.")}finally{d(!1)}};return N?e.jsx(g,{children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-8 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4",children:e.jsx(p,{className:"w-8 h-8 text-emerald-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Merci pour votre avis !"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Votre retour nous aide a ameliorer nos services."}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(f,{rating:t.rating,readonly:!0,size:"lg"})}),e.jsx("button",{onClick:()=>c("/"),className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",children:"Retour a l'accueil"})]})})}):e.jsx(g,{children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>c("/client/scan"),className:"flex items-center text-slate-600 hover:text-slate-900 mb-6 transition-colors",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-medium",children:"Retour"})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-amber-100 rounded-full mb-4",children:e.jsx(z,{className:"w-8 h-8 text-amber-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Laisser un avis"}),e.jsx("p",{className:"text-slate-600",children:"Partagez votre experience avec le marchand"})]}),y&&e.jsxs("div",{className:"mb-6 bg-emerald-50 border border-emerald-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Informations retrouvees"})]}),e.jsx("p",{className:"text-sm text-emerald-600 mt-1",children:"Vos informations ont ete automatiquement remplies"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[u&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:u}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[o&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Code d'echange"}),e.jsx("input",{type:"text",value:o,disabled:!0,className:"w-full px-4 py-2 bg-white border border-slate-300 rounded-lg text-slate-900 font-mono font-semibold"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Vos informations"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nom complet *"}),e.jsx("input",{type:"text",required:!0,value:t.clientName,onChange:s=>l({...t,clientName:s.target.value}),placeholder:"Votre nom",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Telephone *"}),e.jsx("input",{type:"tel",required:!0,value:t.clientPhone,onChange:s=>C(s.target.value),placeholder:"+216 XX XXX XXX",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500"}),v&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Recherche de vos informations..."})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Votre avis"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Note *"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{rating:t.rating,onRatingChange:s=>l({...t,rating:s}),size:"lg"}),t.rating>0&&e.jsxs("span",{className:"text-lg font-semibold text-amber-600",children:[t.rating,"/5"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Commentaire (optionnel)"}),e.jsx("textarea",{value:t.comment,onChange:s=>l({...t,comment:s.target.value}),placeholder:"Decrivez votre experience...",rows:4,maxLength:500,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 resize-none"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1 text-right",children:[t.comment.length,"/500 caracteres"]})]})]})]}),e.jsxs("button",{type:"submit",disabled:m||t.rating===0,className:"w-full flex items-center justify-center gap-2 py-4 bg-amber-500 hover:bg-amber-600 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-colors shadow-sm",children:[e.jsx(D,{className:"w-5 h-5"}),m?"Envoi en cours...":"Envoyer mon avis"]})]})]})]})})}export{Q as default};
