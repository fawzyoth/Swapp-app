import{s as f,j as e}from"./index-hp3Tfpax.js";import{u as I,r as a}from"./react-vendor-CTUriZ5h.js";import{M as N}from"./MerchantLayout-C6R0JEpM.js";import{S as w}from"./StarRating-Cr0kBsr1.js";import{S as j}from"./star-Cw7sdsKF.js";import{T as O}from"./trending-up-9gPHMyOx.js";import{M as q}from"./message-square-B53yKzw3.js";import{S as V}from"./search-CPbK6Y1N.js";import{S as G}from"./send-DlqxrGT5.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./createLucideIcon-CMjKDoEE.js";import"./menu-DP2azNEK.js";import"./store-B-5iV_wL.js";import"./layout-dashboard-CqNl1jWq.js";import"./package-ChDCFdB3.js";import"./truck-CgEV9F53.js";import"./users-4zMWxYqH.js";import"./banknote-JI0QWWz-.js";import"./video-Cwp6uQ4V.js";import"./log-out-BX30H4-p.js";function ce(){const y=I(),[b,g]=a.useState([]),[t,d]=a.useState(null),[S,_]=a.useState(!0),[c,R]=a.useState(""),[i,k]=a.useState(null),[n,m]=a.useState(""),[C,v]=a.useState(!1),[x,T]=a.useState({total:0,averageRating:0,responseRate:0});a.useEffect(()=>{D(),M()},[]);const D=async()=>{const{data:{session:s}}=await f.auth.getSession();s||y("/merchant/login")},M=async()=>{try{const{data:s,error:r}=await f.from("reviews").select("*").order("created_at",{ascending:!1});if(r)throw r;const l=s||[];g(l);const o=l.length,E=o>0?l.reduce((p,F)=>p+F.rating,0)/o:0,A=l.filter(p=>p.merchant_response).length,L=o>0?Math.round(A/o*100):0;T({total:o,averageRating:Math.round(E*10)/10,responseRate:L}),l.length>0&&!t&&d(l[0])}catch(s){console.error("Error fetching reviews:",s)}finally{_(!1)}},z=async()=>{if(!(!t||!n.trim())){v(!0);try{const{error:s}=await f.from("reviews").update({merchant_response:n.trim(),merchant_response_at:new Date().toISOString()}).eq("id",t.id);if(s)throw s;g(b.map(r=>r.id===t.id?{...r,merchant_response:n.trim(),merchant_response_at:new Date().toISOString()}:r)),d({...t,merchant_response:n.trim(),merchant_response_at:new Date().toISOString()}),m("")}catch(s){console.error("Error submitting response:",s)}finally{v(!1)}}},h=b.filter(s=>{const r=s.client_name.toLowerCase().includes(c.toLowerCase())||s.client_phone.includes(c),l=i===null||s.rating===i;return r&&l}),u=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return S?e.jsx(N,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(N,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Avis Clients"}),e.jsx("p",{className:"text-slate-600",children:"Gerez les avis et retours de vos clients"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(j,{className:"w-6 h-6 text-amber-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:x.total})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Total des avis"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(O,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:x.averageRating}),e.jsx(j,{className:"w-5 h-5 fill-amber-400 text-amber-400"})]})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Note moyenne"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-sky-100 rounded-lg",children:e.jsx(q,{className:"w-6 h-6 text-sky-600"})}),e.jsxs("span",{className:"text-2xl font-bold text-slate-900",children:[x.responseRate,"%"]})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Taux de reponse"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par nom ou telephone...",value:c,onChange:s=>R(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500"})]})}),e.jsx("div",{children:e.jsxs("select",{value:i===null?"":i,onChange:s=>k(s.target.value?Number(s.target.value):null),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[e.jsx("option",{value:"",children:"Toutes les notes"}),e.jsx("option",{value:"5",children:"5 etoiles"}),e.jsx("option",{value:"4",children:"4 etoiles"}),e.jsx("option",{value:"3",children:"3 etoiles"}),e.jsx("option",{value:"2",children:"2 etoiles"}),e.jsx("option",{value:"1",children:"1 etoile"})]})})]})}),h.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(j,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Aucun avis"}),e.jsx("p",{className:"text-slate-600",children:c||i!==null?"Aucun avis ne correspond a vos criteres":"Vous n'avez pas encore recu d'avis clients"})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 h-[calc(100vh-400px)] min-h-[400px] flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-slate-200 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-slate-200",children:e.jsxs("h3",{className:"font-semibold text-slate-900",children:[h.length," avis"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h.map(s=>e.jsxs("button",{onClick:()=>{d(s),m("")},className:`w-full p-4 text-left border-b border-slate-100 hover:bg-slate-50 transition-colors ${(t==null?void 0:t.id)===s.id?"bg-sky-50 border-l-4 border-l-sky-600":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-slate-900",children:s.client_name}),e.jsx(w,{rating:s.rating,readonly:!0,size:"sm"})]}),e.jsx("p",{className:"text-sm text-slate-600 truncate",children:s.comment||"Pas de commentaire"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:u(s.created_at)}),s.merchant_response&&e.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full",children:"Repondu"})]})]},s.id))})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:t.client_name}),e.jsx("p",{className:"text-sm text-slate-600",children:t.client_phone})]}),e.jsx(w,{rating:t.rating,readonly:!0,size:"lg"})]}),t.exchange_code&&e.jsxs("p",{className:"text-sm text-slate-600",children:["Code d'echange: ",e.jsx("span",{className:"font-mono font-medium",children:t.exchange_code})]}),e.jsx("p",{className:"text-sm text-slate-500 mt-2",children:u(t.created_at)})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-2",children:"Commentaire du client"}),e.jsx("div",{className:"bg-slate-50 rounded-lg p-4",children:e.jsx("p",{className:"text-slate-700",children:t.comment||"Aucun commentaire"})})]}),t.merchant_response&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-2",children:"Votre reponse"}),e.jsxs("div",{className:"bg-sky-50 rounded-lg p-4 border border-sky-200",children:[e.jsx("p",{className:"text-slate-700",children:t.merchant_response}),t.merchant_response_at&&e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Repondu le ",u(t.merchant_response_at)]})]})]})]}),!t.merchant_response&&e.jsx("div",{className:"p-4 border-t border-slate-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{value:n,onChange:s=>m(s.target.value),placeholder:"Ecrire une reponse...",rows:2,className:"flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 resize-none"}),e.jsx("button",{onClick:z,disabled:!n.trim()||C,className:"px-4 py-2 bg-sky-600 hover:bg-sky-700 disabled:bg-slate-300 text-white rounded-lg transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-slate-500",children:"Selectionnez un avis pour voir les details"})})]})]})})}export{ce as default};
