import{u as E,s as R,j as e}from"./index-zDZ3Lj_p.js";import{r as l,u as k}from"./react-vendor-CTUriZ5h.js";import{H as q}from"./qr-scanner-QRjSEYwL.js";import{L as X}from"./LanguageSwitcher-DTklPvj6.js";import{S as Q}from"./scan-line-Dhzz-_Ia.js";import{K as L}from"./key-round-jTceDe-V.js";import"./supabase-Bl4YWSQ9.js";import"./createLucideIcon-CMjKDoEE.js";function $(){const[x,o]=l.useState(""),[c,N]=l.useState(""),[i,h]=l.useState(!1),[m,f]=l.useState(!1),b=k(),{t:a,dir:y,lang:s}=E();l.useEffect(()=>{if(!i){const r=new q("qr-reader",{fps:10,qrbox:{width:250,height:250}},!1);return r.render(w,S),()=>{r.clear()}}},[i]);const w=r=>{g(r)},S=()=>{},g=async r=>{f(!0),o("");try{if(r.includes("/client/exchange/new?merchant=")){const v=new URL(r).searchParams.get("merchant");if(v){b(`/client/exchange/new?merchant=${v}`);return}}let t=null,d=null;try{const u=JSON.parse(r);t=u.merchant_id,d=u.code}catch{d=r}let n=R.from("merchants").select("*");t?n=n.eq("id",t):d&&(n=n.eq("qr_code_data",d));const{data:p,error:j}=await n.maybeSingle();if(j)throw j;p?b(`/client/exchange/new?merchant=${p.id}`):o(a("invalidQRCode"))}catch(t){console.error("Error validating QR code:",t),o(a("invalidQRCode"))}finally{f(!1)}},C=r=>{r.preventDefault(),c.trim()&&g(c.trim())};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 to-sky-50",dir:y,children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx(X,{})}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4",children:e.jsx(Q,{className:"w-8 h-8 text-emerald-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:a("scanQRCode")}),e.jsx("p",{className:"text-slate-600",children:a("scanDescription")})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[x&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:x}),m&&e.jsxs("div",{className:"mb-4 p-4 bg-sky-50 border border-sky-200 rounded-lg text-sky-700 flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-sky-600"}),a("loading")]}),i?e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:s==="ar"?"رمز التاجر":"Code du commerçant"}),e.jsx("input",{type:"text",value:c,onChange:r=>N(r.target.value),placeholder:"SWAPP-XXXXXXXX",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"submit",disabled:m,className:"w-full py-3 bg-emerald-600 hover:bg-emerald-700 disabled:bg-emerald-300 text-white rounded-lg font-medium transition-colors",children:m?a("loading"):s==="ar"?"التحقق من الرمز":"Valider le code"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"w-full py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors",children:s==="ar"?"العودة للماسح":"Retour au scanner"})]})]}):e.jsxs("div",{children:[e.jsx("div",{id:"qr-reader",className:"mb-4"}),e.jsxs("button",{onClick:()=>h(!0),className:"w-full flex items-center justify-center gap-2 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors",children:[e.jsx(L,{className:"w-5 h-5"}),s==="ar"?"إدخال الرمز يدوياً":"Entrer le code manuellement"]})]}),e.jsx("div",{className:"mt-6 p-4 bg-emerald-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-emerald-800",children:s==="ar"?"امسح رمز QR المقدم من التاجر لتقديم طلب تبديل المنتج.":"Scannez le QR code fourni par votre commerçant pour soumettre une demande d'échange de produit."})})]})]})]})})}export{$ as default};
