import{s as O,j as e,t as T,f as _}from"./index-DGuJxBT7.js";import{r as s}from"./react-vendor-CTUriZ5h.js";import{F as H,A as K}from"./FinanceLayout-C-9hheDF.js";import{D as U}from"./download-BkxpqmAo.js";import{S as X}from"./search-CPbK6Y1N.js";import{C}from"./calendar-upMk3ayk.js";import{R as B}from"./refresh-cw-EGIEbGnh.js";import{A as k,a as D}from"./arrow-up-right-B7-eFdur.js";import{E as G}from"./eye-B0fj8J_e.js";import{C as J}from"./chevron-left-Dqi4HWkY.js";import{C as Q}from"./chevron-right-DAoz1ith.js";import{X as V}from"./x-D4qrk5Qy.js";import"./supabase-Bl4YWSQ9.js";import"./menu-DP2azNEK.js";import"./createLucideIcon-CMjKDoEE.js";import"./calculator-BAKCaH61.js";import"./layout-dashboard-CqNl1jWq.js";import"./wallet-CVOcG8S4.js";import"./credit-card-D2z2xSBY.js";import"./file-text-B3Ewreww.js";import"./alert-triangle-1NuODUVJ.js";import"./bar-chart-3-DdlwYHtY.js";import"./building-2-D3YxmJoi.js";import"./users-4zMWxYqH.js";import"./settings-C58fTzTa.js";import"./log-out-BX30H4-p.js";function Se(){var w;const[d,A]=s.useState([]),[F,j]=s.useState(!0),[o,R]=s.useState(""),[m,E]=s.useState("all"),[x,L]=s.useState("all"),[u,$]=s.useState(""),[p,M]=s.useState(""),[a,y]=s.useState(null),[r,n]=s.useState(1),[g,P]=s.useState(0),c=20;s.useEffect(()=>{N()},[r,m,x,u,p]);const N=async()=>{j(!0);try{let t=O.from("finance_transactions").select(`
          *,
          wallet:finance_wallets(wallet_number, wallet_type)
        `,{count:"exact"});m!=="all"&&(t=t.eq("transaction_type",m)),x!=="all"&&(t=t.eq("status",x)),u&&(t=t.gte("created_at",u)),p&&(t=t.lte("created_at",p+"T23:59:59")),o&&(t=t.or(`transaction_number.ilike.%${o}%,description.ilike.%${o}%`));const{data:l,error:S,count:I}=await t.order("created_at",{ascending:!1}).range((r-1)*c,r*c-1);if(S)throw S;A(l||[]),P(I||0)}catch(t){console.error("Error fetching transactions:",t)}finally{j(!1)}},q=()=>{n(1),N()},i=t=>new Intl.NumberFormat("fr-TN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)+" TND",v=t=>{switch(t){case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"reversed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},W=[{value:"all",label:"Tous les types"},{value:"client_collection",label:"Encaissement Client"},{value:"swapp_fee",label:"Commission SWAPP"},{value:"merchant_credit",label:"Crédit Marchand"},{value:"dp_to_company",label:"Livreur → Société"},{value:"company_to_swapp",label:"Société → SWAPP"},{value:"merchant_payout",label:"Paiement Marchand"},{value:"adjustment",label:"Ajustement"},{value:"refund",label:"Remboursement"}],z=[{value:"all",label:"Tous les statuts"},{value:"pending",label:"En Attente"},{value:"completed",label:"Complété"},{value:"failed",label:"Échoué"},{value:"reversed",label:"Annulé"}],h=Math.ceil(g/c),b=d.filter(t=>Number(t.amount)>0).reduce((t,l)=>t+Number(l.amount),0),f=d.filter(t=>Number(t.amount)<0).reduce((t,l)=>t+Math.abs(Number(l.amount)),0);return e.jsxs(H,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Transactions"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Historique des mouvements financiers"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsx(U,{className:"w-4 h-4"}),"Exporter"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:g})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Entrées"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 mt-1",children:["+",i(b)]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Sorties"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600 mt-1",children:["-",i(f)]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Solde Net"}),e.jsx("p",{className:`text-2xl font-bold mt-1 ${b-f>=0?"text-green-600":"text-red-600"}`,children:i(b-f)})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher...",value:o,onChange:t=>R(t.target.value),onKeyDown:t=>t.key==="Enter"&&q(),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsx("div",{children:e.jsx("select",{value:m,onChange:t=>{E(t.target.value),n(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:W.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})}),e.jsx("div",{children:e.jsx("select",{value:x,onChange:t=>{L(t.target.value),n(1)},className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:u,onChange:t=>{$(t.target.value),n(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:p,onChange:t=>{M(t.target.value),n(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(B,{className:"w-8 h-8 text-emerald-500 animate-spin"})}):d.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Aucune transaction trouvée"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transaction"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Wallet"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:d.map(t=>{var l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${Number(t.amount)>=0?"bg-green-100":"bg-red-100"}`,children:Number(t.amount)>=0?e.jsx(k,{className:"w-5 h-5 text-green-600"}):e.jsx(D,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.transaction_number}),e.jsx("p",{className:"text-sm text-gray-500 truncate max-w-[200px]",children:t.description||"-"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-gray-700",children:T[t.transaction_type]||t.transaction_type})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-gray-600",children:((l=t.wallet)==null?void 0:l.wallet_number)||"-"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("span",{className:`font-semibold ${Number(t.amount)>=0?"text-green-600":"text-red-600"}`,children:[Number(t.amount)>=0?"+":"",i(Number(t.amount))]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${v(t.status)}`,children:_[t.status]||t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-gray-600",children:new Date(t.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>y(t),className:"p-2 text-gray-500 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})})]},t.id)})})]})}),h>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Affichage ",(r-1)*c+1," - ",Math.min(r*c,g)," sur ",g]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(Math.max(1,r-1)),disabled:r===1,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",r," / ",h]}),e.jsx("button",{onClick:()=>n(Math.min(h,r+1)),disabled:r===h,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Q,{className:"w-5 h-5"})})]})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Détail Transaction"}),e.jsx("button",{onClick:()=>y(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(V,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${Number(a.amount)>=0?"bg-green-100":"bg-red-100"}`,children:Number(a.amount)>=0?e.jsx(k,{className:"w-8 h-8 text-green-600"}):e.jsx(D,{className:"w-8 h-8 text-red-600"})})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:`text-3xl font-bold ${Number(a.amount)>=0?"text-green-600":"text-red-600"}`,children:[Number(a.amount)>=0?"+":"",i(Number(a.amount))]}),e.jsx("span",{className:`mt-2 inline-block px-3 py-1 text-sm font-medium rounded-full ${v(a.status)}`,children:_[a.status]||a.status})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Numéro"}),e.jsx("span",{className:"font-medium text-gray-900",children:a.transaction_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Type"}),e.jsx("span",{className:"font-medium text-gray-900",children:T[a.transaction_type]||a.transaction_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Wallet"}),e.jsx("span",{className:"font-medium text-gray-900",children:((w=a.wallet)==null?void 0:w.wallet_number)||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Date"}),e.jsx("span",{className:"font-medium text-gray-900",children:new Date(a.created_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),a.description&&e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-lg",children:a.description})]}),a.reference&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Référence"}),e.jsx("span",{className:"font-medium text-gray-900",children:a.reference})]})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-100 flex justify-end",children:e.jsx("button",{onClick:()=>y(null),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"Fermer"})})]})})]})}export{Se as default};
