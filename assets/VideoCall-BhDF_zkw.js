import{s as m,j as e}from"./index-BvuTS9li.js";import{h as I,u as M,r as t}from"./react-vendor-CTUriZ5h.js";import{A as q}from"./alert-circle-_Iqic_ih.js";import{C as A}from"./check-circle-CyNeZd0p.js";import{V as i}from"./video-Cwp6uQ4V.js";import{C as b}from"./clock-Dhxn45-3.js";import{M as $,a as J,V as D}from"./video-off-CvREAmEw.js";import{P}from"./phone-BNQXnIac.js";import"./supabase-Bl4YWSQ9.js";import"./createLucideIcon-CMjKDoEE.js";function Q(){const{roomId:x}=I(),u=M(),[r,g]=t.useState(null),[N,v]=t.useState(!0),[h,n]=t.useState(""),[f,w]=t.useState(!1),[c,p]=t.useState(!1),[l,y]=t.useState(300),[o,C]=t.useState(!0),[d,k]=t.useState(!0),[S,E]=t.useState(!1);t.useEffect(()=>{V()},[x]),t.useEffect(()=>{let s;return c&&l>0&&(s=setInterval(()=>{y(a=>a<=1?(j(),0):a-1)},1e3)),()=>clearInterval(s)},[c,l]);const V=async()=>{try{const{data:s,error:a}=await m.from("video_calls").select("*").eq("room_id",x).single();if(a)throw a;if(!s){n("Appel video non trouve");return}if(s.status==="completed"||s.status==="expired"||s.status==="cancelled"){n("Cet appel video n'est plus disponible");return}g(s)}catch(s){console.error("Error fetching video call:",s),n("Erreur lors du chargement de l'appel")}finally{v(!1)}},R=async()=>{if(r)try{await m.from("video_calls").update({status:"active",started_at:new Date().toISOString(),recording_consent:f}).eq("id",r.id),p(!0)}catch(s){console.error("Error joining call:",s)}},j=async()=>{if(!r)return;const s=300-l;try{await m.from("video_calls").update({status:"completed",ended_at:new Date().toISOString(),duration_seconds:s}).eq("id",r.id),E(!0),p(!1)}catch(a){console.error("Error ending call:",a)}},O=s=>{const a=Math.floor(s/60),_=s%60;return`${a}:${_.toString().padStart(2,"0")}`};return N?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}):h?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-8 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4",children:e.jsx(q,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-900 mb-2",children:"Appel non disponible"}),e.jsx("p",{className:"text-slate-600 mb-6",children:h}),e.jsx("button",{onClick:()=>u("/"),className:"px-6 py-3 bg-slate-900 hover:bg-slate-800 text-white rounded-lg font-medium transition-colors",children:"Retour a l'accueil"})]})}):S?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-8 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4",children:e.jsx(A,{className:"w-8 h-8 text-emerald-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-900 mb-2",children:"Appel termine"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Merci d'avoir participe a cet appel video."}),e.jsx("button",{onClick:()=>u("/"),className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",children:"Retour a l'accueil"})]})}):c?e.jsxs("div",{className:"min-h-screen bg-slate-900 flex flex-col",children:[e.jsxs("div",{className:"bg-slate-800 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${l<=60?"bg-red-500 animate-pulse":"bg-emerald-500"}`}),e.jsx("span",{className:"text-white font-medium",children:"Appel en cours"})]}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full ${l<=60?"bg-red-600":"bg-slate-700"}`,children:[e.jsx(b,{className:"w-4 h-4 text-white"}),e.jsx("span",{className:"text-white font-mono",children:O(l)})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-slate-800 rounded-2xl w-full max-w-4xl aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(i,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 text-lg",children:"Zone video"}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:"Votre implementation WebRTC sera integree ici"})]})})}),e.jsx("div",{className:"bg-slate-800 px-4 py-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>k(!d),className:`p-4 rounded-full transition-colors ${d?"bg-slate-700 hover:bg-slate-600":"bg-red-600 hover:bg-red-700"}`,children:d?e.jsx($,{className:"w-6 h-6 text-white"}):e.jsx(J,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:()=>C(!o),className:`p-4 rounded-full transition-colors ${o?"bg-slate-700 hover:bg-slate-600":"bg-red-600 hover:bg-red-700"}`,children:o?e.jsx(i,{className:"w-6 h-6 text-white"}):e.jsx(D,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:j,className:"p-4 bg-red-600 hover:bg-red-700 rounded-full transition-colors",children:e.jsx(P,{className:"w-6 h-6 text-white rotate-[135deg]"})})]})})]}):e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-sky-100 rounded-full mb-4",children:e.jsx(i,{className:"w-8 h-8 text-sky-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-900 mb-2",children:"Rejoindre l'appel video"}),e.jsx("p",{className:"text-slate-600",children:"Vous etes invite a un appel video avec le marchand"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(b,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Duree maximale: 5 minutes"})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"L'appel se terminera automatiquement apres 5 minutes"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>w(s.target.checked),className:"mt-1 w-4 h-4 text-sky-600 border-slate-300 rounded focus:ring-sky-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:"J'accepte que cet appel puisse etre enregistre a des fins de qualite de service"})]})}),e.jsxs("button",{onClick:R,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-semibold transition-colors",children:[e.jsx(i,{className:"w-5 h-5"}),"Rejoindre l'appel"]})]})})}export{Q as default};
