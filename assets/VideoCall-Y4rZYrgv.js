import{s as o,j as e}from"./index-D04Gu7ka.js";import{h as L,u as q,r}from"./react-vendor-CTUriZ5h.js";import{M as d}from"./MerchantLayout-ugDJsPGp.js";import{A as J}from"./alert-circle-_Iqic_ih.js";import{C as P}from"./check-circle-CyNeZd0p.js";import{V as m}from"./video-Cwp6uQ4V.js";import{U}from"./user-DEx4Ce9L.js";import{P as v}from"./phone-BNQXnIac.js";import{C as y}from"./clock-Dhxn45-3.js";import{c as z}from"./createLucideIcon-CMjKDoEE.js";import{M as H,a as W,V as Z}from"./video-off-CvREAmEw.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./menu-DP2azNEK.js";import"./store-B-5iV_wL.js";import"./layout-dashboard-CqNl1jWq.js";import"./package-ChDCFdB3.js";import"./truck-CgEV9F53.js";import"./users-4zMWxYqH.js";import"./banknote-JI0QWWz-.js";import"./message-square-B53yKzw3.js";import"./star-Cw7sdsKF.js";import"./log-out-BX30H4-p.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=z("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function fe(){const{roomId:g}=L(),x=q(),[t,k]=r.useState(null),[S,E]=r.useState(!0),[j,b]=r.useState(""),[h,u]=r.useState(!1),[l,N]=r.useState(300),[n,_]=r.useState(!0),[c,C]=r.useState(!0),[i,M]=r.useState(!1),[R,A]=r.useState(!1);r.useEffect(()=>{V(),I()},[g]),r.useEffect(()=>{let s;return h&&l>0&&(s=setInterval(()=>{N(a=>a<=1?(w(),0):a-1)},1e3)),()=>clearInterval(s)},[h,l]);const V=async()=>{const{data:{session:s}}=await o.auth.getSession();s||x("/merchant/login")},I=async()=>{try{const{data:s,error:a}=await o.from("video_calls").select("*").eq("room_id",g).single();if(a)throw a;if(!s){b("Appel video non trouve");return}if(k(s),s.status==="active"&&s.started_at){const p=new Date(s.started_at).getTime(),D=Math.floor((Date.now()-p)/1e3);N(Math.max(0,300-D)),u(!0)}}catch(s){console.error("Error fetching video call:",s),b("Erreur lors du chargement de l'appel")}finally{E(!1)}},O=async()=>{if(t)try{t.status==="pending"&&await o.from("video_calls").update({status:"active",started_at:new Date().toISOString()}).eq("id",t.id),u(!0)}catch(s){console.error("Error joining call:",s)}},w=async()=>{if(!t)return;const s=300-l;try{await o.from("video_calls").update({status:"completed",ended_at:new Date().toISOString(),duration_seconds:s}).eq("id",t.id),A(!0),u(!1)}catch(a){console.error("Error ending call:",a)}},$=()=>{M(!i),console.log(i?"Stopping recording...":"Starting recording...")},T=s=>{const a=Math.floor(s/60),p=s%60;return`${a}:${p.toString().padStart(2,"0")}`};return S?e.jsx(d,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):j?e.jsx(d,{children:e.jsxs("div",{className:"max-w-md mx-auto text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4",children:e.jsx(J,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-900 mb-2",children:"Erreur"}),e.jsx("p",{className:"text-slate-600 mb-6",children:j}),e.jsx("button",{onClick:()=>x("/merchant/video-calls"),className:"px-6 py-3 bg-sky-600 hover:bg-sky-700 text-white rounded-lg font-medium transition-colors",children:"Retour aux appels"})]})}):R?e.jsx(d,{children:e.jsxs("div",{className:"max-w-md mx-auto text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4",children:e.jsx(P,{className:"w-8 h-8 text-emerald-600"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-900 mb-2",children:"Appel termine"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["L'appel avec ",t==null?void 0:t.client_name," est termine."]}),e.jsx("button",{onClick:()=>x("/merchant/video-calls"),className:"px-6 py-3 bg-sky-600 hover:bg-sky-700 text-white rounded-lg font-medium transition-colors",children:"Retour aux appels"})]})}):h?e.jsxs("div",{className:"min-h-screen bg-slate-900 flex flex-col",children:[e.jsxs("div",{className:"bg-slate-800 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${l<=60?"bg-red-500 animate-pulse":"bg-emerald-500"}`}),e.jsxs("span",{className:"text-white font-medium",children:["Appel avec ",t==null?void 0:t.client_name]})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-red-600 rounded-full",children:[e.jsx(f,{className:"w-3 h-3 text-white fill-white animate-pulse"}),e.jsx("span",{className:"text-white text-sm font-medium",children:"Enregistrement"})]})]}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full ${l<=60?"bg-red-600":"bg-slate-700"}`,children:[e.jsx(y,{className:"w-4 h-4 text-white"}),e.jsx("span",{className:"text-white font-mono",children:T(l)})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-slate-800 rounded-2xl w-full max-w-4xl aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(m,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 text-lg",children:"Zone video"}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:"Votre implementation WebRTC sera integree ici"})]})})}),e.jsx("div",{className:"bg-slate-800 px-4 py-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>C(!c),className:`p-4 rounded-full transition-colors ${c?"bg-slate-700 hover:bg-slate-600":"bg-red-600 hover:bg-red-700"}`,title:c?"Couper le micro":"Activer le micro",children:c?e.jsx(H,{className:"w-6 h-6 text-white"}):e.jsx(W,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:()=>_(!n),className:`p-4 rounded-full transition-colors ${n?"bg-slate-700 hover:bg-slate-600":"bg-red-600 hover:bg-red-700"}`,title:n?"Couper la video":"Activer la video",children:n?e.jsx(m,{className:"w-6 h-6 text-white"}):e.jsx(Z,{className:"w-6 h-6 text-white"})}),(t==null?void 0:t.recording_consent)&&e.jsx("button",{onClick:$,className:`p-4 rounded-full transition-colors ${i?"bg-red-600 hover:bg-red-700":"bg-slate-700 hover:bg-slate-600"}`,title:i?"Arreter l'enregistrement":"Demarrer l'enregistrement",children:e.jsx(f,{className:`w-6 h-6 text-white ${i?"fill-white":""}`})}),e.jsx("button",{onClick:w,className:"p-4 bg-red-600 hover:bg-red-700 rounded-full transition-colors",title:"Terminer l'appel",children:e.jsx(v,{className:"w-6 h-6 text-white rotate-[135deg]"})})]})})]}):e.jsx(d,{children:e.jsx("div",{className:"max-w-lg mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-sky-100 rounded-full mb-4",children:e.jsx(m,{className:"w-8 h-8 text-sky-600"})}),e.jsxs("h1",{className:"text-xl font-bold text-slate-900 mb-2",children:["Appel video avec ",t==null?void 0:t.client_name]}),e.jsx("p",{className:"text-slate-600",children:"Rejoignez l'appel pour discuter avec le client"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-slate-50 rounded-lg",children:[e.jsx(U,{className:"w-5 h-5 text-slate-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Client"}),e.jsx("p",{className:"font-medium text-slate-900",children:t==null?void 0:t.client_name})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-slate-50 rounded-lg",children:[e.jsx(v,{className:"w-5 h-5 text-slate-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Telephone"}),e.jsx("p",{className:"font-medium text-slate-900",children:t==null?void 0:t.client_phone})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-amber-50 rounded-lg border border-amber-200",children:[e.jsx(y,{className:"w-5 h-5 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-amber-600",children:"Duree maximale"}),e.jsx("p",{className:"font-medium text-amber-700",children:"5 minutes"})]})]}),(t==null?void 0:t.recording_consent)&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-emerald-50 rounded-lg border border-emerald-200",children:[e.jsx(f,{className:"w-5 h-5 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600",children:"Enregistrement"}),e.jsx("p",{className:"font-medium text-emerald-700",children:"Le client a consenti a l'enregistrement"})]})]})]}),e.jsxs("button",{onClick:O,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-semibold transition-colors",children:[e.jsx(m,{className:"w-5 h-5"}),"Rejoindre l'appel"]})]})})})}export{fe as default};
