import{s as x,j as e,V as y}from"./index-DdAZvCql.js";import{u as k,r as l}from"./react-vendor-CTUriZ5h.js";import{M as m}from"./MerchantLayout-BoH8hDF2.js";import{V as c}from"./video-Cwp6uQ4V.js";import{C as S}from"./clock-Dhxn45-3.js";import{P as C}from"./phone-BNQXnIac.js";import{S as _}from"./search-CPbK6Y1N.js";import{U as E}from"./user-DEx4Ce9L.js";import{c as L}from"./createLucideIcon-CMjKDoEE.js";import"./supabase-Bl4YWSQ9.js";import"./x-D4qrk5Qy.js";import"./menu-DP2azNEK.js";import"./store-B-5iV_wL.js";import"./layout-dashboard-CqNl1jWq.js";import"./package-ChDCFdB3.js";import"./truck-CgEV9F53.js";import"./users-4zMWxYqH.js";import"./banknote-JI0QWWz-.js";import"./message-square-B53yKzw3.js";import"./star-Cw7sdsKF.js";import"./log-out-BX30H4-p.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=L("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function Y(){const d=k(),[a,h]=l.useState([]),[p,u]=l.useState(!0),[r,j]=l.useState(""),[i,f]=l.useState("");l.useEffect(()=>{g(),N()},[]);const g=async()=>{const{data:{session:s}}=await x.auth.getSession();s||d("/merchant/login")},N=async()=>{try{const{data:s,error:t}=await x.from("video_calls").select("*").order("created_at",{ascending:!1});if(t)throw t;h(s||[])}catch(s){console.error("Error fetching video calls:",s)}finally{u(!1)}},o=a.filter(s=>{const t=s.client_name.toLowerCase().includes(r.toLowerCase())||s.client_phone.includes(r)||s.room_id.includes(r),n=!i||s.status===i;return t&&n}),b=s=>{switch(s){case"pending":return"bg-amber-100 text-amber-800";case"active":return"bg-emerald-100 text-emerald-800";case"completed":return"bg-sky-100 text-sky-800";case"expired":return"bg-slate-100 text-slate-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-slate-100 text-slate-800"}},v=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),w=s=>{if(!s)return"-";const t=Math.floor(s/60),n=s%60;return`${t}m ${n}s`};return p?e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(m,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Appels Video"}),e.jsx("p",{className:"text-slate-600",children:"Historique et gestion des appels video avec vos clients"})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-sky-100 rounded-lg",children:e.jsx(c,{className:"w-6 h-6 text-sky-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.length})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Total des appels"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-amber-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.filter(s=>s.status==="pending").length})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"En attente"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(c,{className:"w-6 h-6 text-emerald-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.filter(s=>s.status==="active").length})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"En cours"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(C,{className:"w-6 h-6 text-slate-600"})}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a.filter(s=>s.status==="completed").length})]}),e.jsx("h3",{className:"text-slate-600 text-sm",children:"Termines"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par nom, telephone ou room ID...",value:r,onChange:s=>j(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500"})]})}),e.jsx("div",{children:e.jsxs("select",{value:i,onChange:s=>f(s.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"active",children:"En cours"}),e.jsx("option",{value:"completed",children:"Termine"}),e.jsx("option",{value:"expired",children:"Expire"}),e.jsx("option",{value:"cancelled",children:"Annule"})]})})]})}),o.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(c,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Aucun appel video"}),e.jsx("p",{className:"text-slate-600",children:r||i?"Aucun appel ne correspond a vos criteres":"Vous n'avez pas encore d'appels video"})]}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Room ID"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Duree"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:o.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-slate-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.client_name}),e.jsx("p",{className:"text-sm text-slate-500",children:s.client_phone})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"font-mono text-sm text-slate-600",children:s.room_id})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:v(s.created_at)}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:w(s.duration_seconds)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${b(s.status)}`,children:y[s.status]||s.status})}),e.jsx("td",{className:"px-6 py-4",children:(s.status==="pending"||s.status==="active")&&e.jsxs("button",{onClick:()=>d(`/merchant/call/${s.room_id}`),className:"flex items-center gap-1 px-3 py-1.5 bg-sky-600 hover:bg-sky-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(V,{className:"w-4 h-4"}),"Rejoindre"]})})]},s.id))})]})})]})})}export{Y as default};
