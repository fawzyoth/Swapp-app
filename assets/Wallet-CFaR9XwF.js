import{r as l,s as i,j as e,p as D}from"./index-CQ_LRKqG.js";import{D as p}from"./DeliveryLayout-BrsIu7Tb.js";import{W as _}from"./wallet-Dtdyx2S8.js";import{C}from"./clock-CzMshNXu.js";import{T as S}from"./trending-up-SKtT3bkQ.js";import{C as T}from"./check-circle-CNrQZjEC.js";import{B as A}from"./banknote-B-tG0m_s.js";import{A as k}from"./alert-circle-D4GLTGUl.js";import{A as F,a as P}from"./arrow-up-right-B3x3KRLb.js";import"./x-BXOCxbM_.js";import"./createLucideIcon-_6ROX8yg.js";import"./menu-BxfI3nIZ.js";import"./truck-Cnf3_ycc.js";import"./layout-dashboard-BZxJ5DpE.js";import"./scan-line-B70g6SY1.js";import"./home-BFpn_AqO.js";import"./log-out-DgqNs_DR.js";function Y(){const[a,u]=l.useState([]),[c,j]=l.useState([]),[b,f]=l.useState(!0),[L,N]=l.useState(null);l.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:{user:s}}=await i.auth.getUser();if(!s)return;const{data:t}=await i.from("delivery_persons").select("*").eq("email",s.email).single();if(t){N(t);const{data:r}=await i.from("delivery_verifications").select(`
            *,
            exchange:exchanges(
              id,
              exchange_code,
              client_name,
              merchant_id,
              merchants(name)
            )
          `).eq("delivery_person_id",t.id).eq("payment_collected",!0).order("created_at",{ascending:!1}),{data:d}=await i.from("delivery_deposits").select("*").eq("delivery_person_id",t.id).order("created_at",{ascending:!1});u(r||[]),j(d||[])}}finally{f(!1)}},v=a.reduce((s,t)=>s+(t.amount_collected||0),0),n=c.filter(s=>s.status==="confirmed").reduce((s,t)=>s+t.amount_deposited,0),o=v-n,x=a.filter(s=>!s.deposit_id),y=a.filter(s=>new Date(s.created_at).toDateString()===new Date().toDateString()).reduce((s,t)=>s+(t.amount_collected||0),0),w=s=>{const t={pending:"bg-amber-100 text-amber-700",confirmed:"bg-emerald-100 text-emerald-700",disputed:"bg-red-100 text-red-700"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t[s]||"bg-slate-100 text-slate-700"}`,children:D[s]||s})};return b?e.jsx(p,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"})})}):e.jsx(p,{children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx(_,{className:"w-7 h-7 text-sky-600"}),"Mon Portefeuille"]}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Suivi de vos collectes et dépôts"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"w-4 h-4 text-amber-600"})})}),e.jsxs("p",{className:"text-2xl font-bold text-amber-600",children:[o.toFixed(2)," TND"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"À déposer"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:"w-8 h-8 bg-sky-100 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"w-4 h-4 text-sky-600"})})}),e.jsxs("p",{className:"text-2xl font-bold text-sky-600",children:[y.toFixed(2)," TND"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Collecté aujourd'hui"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:"w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-4 h-4 text-emerald-600"})})}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-600",children:[n.toFixed(2)," TND"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Total déposé"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(A,{className:"w-4 h-4 text-purple-600"})})}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:a.length}),e.jsx("p",{className:"text-xs text-slate-500",children:"Collectes totales"})]})]}),x.length>0&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-amber-900",children:"Collectes en attente de dépôt"}),e.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:["Vous avez ",x.length," collecte(s) pour un total de"," ",e.jsxs("strong",{children:[o.toFixed(2)," TND"]})," à déposer au bureau SWAPP."]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-slate-900",children:"Collectes Récentes"}),e.jsx(F,{className:"w-5 h-5 text-emerald-600"})]}),a.length>0?e.jsx("div",{className:"divide-y divide-slate-200 max-h-96 overflow-y-auto",children:a.slice(0,10).map(s=>{var t,r,d,m,h;return e.jsx("div",{className:"p-4 hover:bg-slate-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:(t=s.exchange)==null?void 0:t.exchange_code}),e.jsx("p",{className:"text-sm text-slate-500",children:(r=s.exchange)==null?void 0:r.client_name}),e.jsx("p",{className:"text-xs text-slate-400",children:(m=(d=s.exchange)==null?void 0:d.merchants)==null?void 0:m.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-emerald-600",children:["+",(h=s.amount_collected)==null?void 0:h.toFixed(2)," TND"]}),e.jsx("p",{className:"text-xs text-slate-500",children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}),!s.deposit_id&&e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-amber-100 text-amber-700 rounded text-xs",children:"Non déposé"})]})]})},s.id)})}):e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Aucune collecte"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-slate-900",children:"Historique Dépôts"}),e.jsx(P,{className:"w-5 h-5 text-sky-600"})]}),c.length>0?e.jsx("div",{className:"divide-y divide-slate-200 max-h-96 overflow-y-auto",children:c.map(s=>e.jsx("div",{className:"p-4 hover:bg-slate-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.deposit_number}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.total_exchanges," échanges"]}),e.jsx("p",{className:"text-xs text-slate-400",children:new Date(s.deposit_date).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-slate-900",children:[s.amount_deposited.toFixed(2)," TND"]}),w(s.status),s.discrepancy!==0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Écart: ",s.discrepancy.toFixed(2)," TND"]})]})]})},s.id))}):e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Aucun dépôt"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Comment déposer vos collectes?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"1. Rendez-vous au bureau SWAPP avec l'argent collecté"}),e.jsx("li",{children:"2. Présentez votre ID livreur à l'agent"}),e.jsx("li",{children:"3. L'agent vérifiera le montant et confirmera le dépôt"}),e.jsx("li",{children:"4. Vous recevrez une confirmation dans votre portefeuille"})]})]})]})})}export{Y as default};
