import{r as a,s as N,j as e,w as L}from"./index-CGuTpfce.js";import{F as E}from"./FinanceLayout-BA4cwJBg.js";import{P}from"./plus-CRa8ZD_X.js";import{S as R}from"./search-WmZ5iiTZ.js";import{F as D}from"./filter-orBVu81y.js";import{R as x}from"./refresh-cw-CI8VlnhK.js";import{W as j}from"./wallet-rOluuaMK.js";import{E as B}from"./eye-C8ZykI6Y.js";import{X as U}from"./x-BDYXHXVZ.js";import{A as $,a as q}from"./arrow-up-right-TSHy3xQ7.js";import{T as I}from"./truck-T6aPcJoR.js";import{U as z}from"./user-DQDpWxcd.js";import{B as G}from"./building-2-Dnu0Yj2X.js";import"./menu-BDfgw-7m.js";import"./createLucideIcon-D9R5Vyj_.js";import"./calculator-Bhz4aUEn.js";import"./layout-dashboard-C14bcGdN.js";import"./credit-card-BSxBFpdc.js";import"./file-text-CNKwjRK0.js";import"./alert-triangle-sSbZHj6s.js";import"./bar-chart-3-CtE8cigR.js";import"./users-B34gaGxt.js";import"./settings-DiX6a7BK.js";import"./log-out-DzvhW2NF.js";function pe(){const[f,b]=a.useState([]),[v,h]=a.useState(!0),[i,w]=a.useState(""),[d,_]=a.useState("all"),[l,o]=a.useState(null),[p,S]=a.useState([]),[T,u]=a.useState(!1);a.useEffect(()=>{g()},[]);const g=async()=>{h(!0);try{const{data:s,error:r}=await N.from("finance_wallets").select(`
          *,
          merchant:merchants(business_name),
          delivery_person:delivery_persons(full_name),
          delivery_company:delivery_companies(name)
        `).eq("is_active",!0).order("wallet_type").order("created_at",{ascending:!1});if(r)throw r;b(s||[])}catch(s){console.error("Error fetching wallets:",s)}finally{h(!1)}},W=async s=>{u(!0);try{const{data:r,error:c}=await N.from("finance_transactions").select("*").eq("wallet_id",s).order("created_at",{ascending:!1}).limit(20);if(c)throw c;S(r||[])}catch(r){console.error("Error fetching transactions:",r)}finally{u(!1)}},C=s=>{o(s),W(s.id)},y=s=>{switch(s){case"merchant":return e.jsx(G,{className:"w-5 h-5"});case"delivery_person":return e.jsx(z,{className:"w-5 h-5"});case"delivery_company":return e.jsx(I,{className:"w-5 h-5"});default:return e.jsx(j,{className:"w-5 h-5"})}},m=s=>s.merchant?s.merchant.business_name:s.delivery_person?s.delivery_person.full_name:s.delivery_company?s.delivery_company.name:s.wallet_number,t=s=>new Intl.NumberFormat("fr-TN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(s)+" TND",n=f.filter(s=>{const r=m(s).toLowerCase().includes(i.toLowerCase())||s.wallet_number.toLowerCase().includes(i.toLowerCase()),c=d==="all"||s.wallet_type===d;return r&&c}),k=[{value:"all",label:"Tous"},{value:"merchant",label:"Marchands"},{value:"delivery_person",label:"Livreurs"},{value:"delivery_company",label:"Sociétés Livraison"},{value:"swapp_main",label:"SWAPP Principal"},{value:"swapp_fee",label:"SWAPP Commissions"}],A=n.reduce((s,r)=>s+Number(r.balance),0),F=n.reduce((s,r)=>s+Number(r.pending_in)-Number(r.pending_out),0);return e.jsxs(E,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Portefeuilles"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Gestion des portefeuilles virtuels"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),"Nouveau Wallet"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Solde Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:t(A)})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"En Attente"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600 mt-1",children:t(F)})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Nombre de Wallets"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:n.length})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher un wallet...",value:i,onChange:s=>w(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-gray-400"}),e.jsx("select",{value:d,onChange:s=>_(s.target.value),className:"px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:k.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("button",{onClick:g,className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:e.jsx(x,{className:"w-5 h-5 text-gray-500"})})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:v?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(x,{className:"w-8 h-8 text-emerald-500 animate-spin"})}):n.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(j,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Aucun wallet trouvé"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Wallet"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Solde"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"En Attente"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Devise"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:n.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center text-emerald-600",children:y(s.wallet_type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:m(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.wallet_number})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded",children:L[s.wallet_type]||s.wallet_type})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("span",{className:`font-semibold ${Number(s.balance)>=0?"text-green-600":"text-red-600"}`,children:t(Number(s.balance))})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-green-600",children:["+",t(Number(s.pending_in))]}),e.jsx("span",{className:"text-gray-400 mx-1",children:"/"}),e.jsxs("span",{className:"text-red-600",children:["-",t(Number(s.pending_out))]})]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:"text-gray-600",children:s.currency})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>C(s),className:"p-2 text-gray-500 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",children:e.jsx(B,{className:"w-5 h-5"})})})]},s.id))})]})})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center text-emerald-600",children:y(l.wallet_type)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:m(l)}),e.jsx("p",{className:"text-sm text-gray-500",children:l.wallet_number})]})]}),e.jsx("button",{onClick:()=>o(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Solde"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:t(Number(l.balance))})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600",children:"Entrées en Attente"}),e.jsxs("p",{className:"text-xl font-bold text-green-700",children:["+",t(Number(l.pending_in))]})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-600",children:"Sorties en Attente"}),e.jsxs("p",{className:"text-xl font-bold text-red-700",children:["-",t(Number(l.pending_out))]})]})]}),e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Transactions Récentes"}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden max-h-64 overflow-y-auto",children:T?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(x,{className:"w-6 h-6 text-emerald-500 animate-spin"})}):p.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Aucune transaction"}):e.jsx("div",{className:"divide-y divide-gray-100",children:p.map(s=>e.jsxs("div",{className:"p-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${Number(s.amount)>=0?"bg-green-100":"bg-red-100"}`,children:Number(s.amount)>=0?e.jsx($,{className:"w-4 h-4 text-green-600"}):e.jsx(q,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.description||s.transaction_type}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleDateString("fr-FR")})]})]}),e.jsxs("span",{className:`font-semibold ${Number(s.amount)>=0?"text-green-600":"text-red-600"}`,children:[Number(s.amount)>=0?"+":"",t(Number(s.amount))]})]},s.id))})})]}),e.jsx("div",{className:"p-6 border-t border-gray-100 flex justify-end gap-3",children:e.jsx("button",{onClick:()=>o(null),className:"px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50",children:"Fermer"})})]})})]})}export{pe as default};
