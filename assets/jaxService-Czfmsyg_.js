const c="https://core.jax-delivery.com/api",p=[0,3],y="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2NvcmUuamF4LWRlbGl2ZXJ5LmNvbS9hcGkvdXRpbGlzYXRldXJzL0xvbmdUb2tlbiIsImlhdCI6MTc2Njc2NjI5MSwiZXhwIjoxODI5ODM4MjkxLCJuYmYiOjE3NjY3NjYyOTEsImp0aSI6IjY4T1RuNDB2aVN2VzdpMHQiLCJzdWIiOiIzNDIyIiwicHJ2IjoiZDA5MDViY2Y2NWE2ZDk5MmQ5MGNiZmU0NjIyNmJkMzEzYWU1MTkzZiJ9.2OZPJSLbCALAMgmrUR41u1CNk5e6Ozagc5pHFMHBj_4",a={tunis:1,ariana:2,"ben arous":3,manouba:4,bizerte:5,beja:6,jendouba:7,kef:8,siliana:9,nabeul:10,zaghouan:11,sousse:12,monastir:13,mahdia:14,sfax:15,kairouan:16,kasserine:17,"sidi bouzid":18,gabes:19,medenine:20,tataouine:21,gafsa:22,tozeur:23,kebili:24},d=t=>{if(!t)return 1;const e=t.toLowerCase().trim();if(a[e])return a[e];for(const[s,o]of Object.entries(a))if(e.includes(s)||s.includes(e))return o;return 1},f=async(t,e)=>{try{const s=await fetch(`${c}/user/colis/add`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)}),o=await s.json();return console.log("JAX API Response:",o),s.ok?{...o,success:!0,ean:o.code||o.ean}:{success:!1,error:o.message||`JAX API error: ${s.status}`}}catch(s){return console.error("JAX API Error:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}},_=()=>{const e=new Date().getDay();return p.includes(e)},w=()=>{const t=new Date,e=t.getDay();let s=(3-e+7)%7,o=(0-e+7)%7;s===0&&(s=0),o===0&&(o=0);let i;s===0||o===0?i=0:i=Math.min(s,o);const n=new Date(t);return n.setDate(t.getDate()+i),n},J=t=>{const s=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][t.getDay()],o=t.toLocaleDateString("fr-TN",{day:"numeric",month:"long",year:"numeric"});return`${s} ${o}`},m=async(t,e)=>{try{const s=await fetch(`${c}/client/createByean`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)}),o=await s.json();return console.log("JAX Pickup Response:",o),s.ok?{...o,success:!0}:{success:!1,error:o.message||`JAX API error: ${s.status}`}}catch(s){return console.error("JAX Pickup Error:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}},k=async(t,e,s,o,i)=>{if(e.length===0)return{success:!1,error:"Aucun colis à ramasser"};const n={adresse:s,nbrColis:e.length.toString(),colis_statut:"10",colis_list:e,note:i||"Pickup scheduled via SWAPP",gouvernorat_id:o};return m(t,n)};class r extends Error{constructor(e){super(e),this.name="JaxValidationError"}}const A=(t,e)=>{if(!(t!=null&&t.exchange_code))throw new r("Code d'échange manquant");if(!(t!=null&&t.client_name))throw new r("Nom du client manquant");if(!(t!=null&&t.client_phone))throw new r("Téléphone du client manquant");if(!(t!=null&&t.client_address))throw new r("Adresse du client manquante");if(!(t!=null&&t.client_governorate_id)&&!(t!=null&&t.client_city))throw new r("Gouvernorat du client manquant");const s=(t==null?void 0:t.client_delegation)||(t==null?void 0:t.client_postal_code);if(!s)throw new r("Délégation du client manquante");const o=(e==null?void 0:e.business_name)||(e==null?void 0:e.name);if(!o)throw new r("Nom commercial du marchand manquant (Paramètres > Marque)");if(!(e!=null&&e.phone))throw new r("Téléphone du marchand manquant");if(!(e!=null&&e.business_address))throw new r("Adresse du marchand manquante (Paramètres > Marque)");const i=t.client_governorate_id||d(t.client_city||""),n=d(e.business_city||""),u=t.client_phone.replace(/\s/g,""),l=e.phone.replace(/\s/g,"");return{referenceExterne:t.exchange_code,nomContact:t.client_name,tel:u,tel2:u,adresseLivraison:t.client_address,governorat:i.toString(),delegation:s,description:`Échange: ${t.product_name||"Produit"} - ${t.reason||"Échange"}`,cod:(t.payment_amount||0).toString(),echange:1,gouvernorat_pickup:n,adresse_pickup:e.business_address,expediteur_phone:parseInt(l,10),expediteur_name:o}};export{y as D,r as J,d as a,A as b,f as c,J as f,w as g,_ as i,k as s};
